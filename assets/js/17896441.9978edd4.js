"use strict";(self.webpackChunkvis_engine_docs=self.webpackChunkvis_engine_docs||[]).push([[7918],{889:(t,e,i)=>{i.r(e),i.d(e,{BlendType:()=>Wt,Box:()=>Ce,BufferAttribute:()=>Rt,Camera:()=>ai,Clock:()=>et,Color:()=>Tt,DataTexture:()=>xe,Euler:()=>At,EventEmitter:()=>ut,Geometry:()=>It,Matrix3:()=>yt,Matrix4:()=>wt,Mesh:()=>zt,Object3D:()=>_t,OrthographicCamera:()=>li,PerspectiveCamera:()=>hi,Plane:()=>_e,Program:()=>qe,ProjectionMatrix:()=>St,Quaternion:()=>pt,Raf:()=>ht,RenderBuffer:()=>ve,RenderTarget:()=>Te,Renderer:()=>ue,Resource:()=>me,Scene:()=>Vt,State:()=>qt,Texture:()=>ye,Texture3D:()=>Je,Vector2:()=>dt,Vector3:()=>vt,Vector4:()=>gt,getPlaneBuffer:()=>Se,highPrecision:()=>_,utils:()=>J});var n=i(9824),r=i(4244),s=i(5327),o=i(6958),a=i(5015),h=i(1031),l=i(7897),u=i(663),c=i(1606),d=i(4717),f=i(9196),m=i(5316),p=i(6518),v=i(1354);function g(t,e,i){return void 0===e&&(e=[]),void 0===i&&(i=[]),t.replace(/#defines/,e.join("\n")).replace(/#includes/,i.join("\n"))}function b(t,e){void 0===e&&(e="unnamed");var i=t.match(/#define\s*SHADER_NAME\s*([A-Za-z0-9_-]+)\s*/);return i?i[1]:e}function y(t,e,i,n){var r=new Set;if(n)for(var s=0,o=i;s<o;s+=3)for(var a=n[s],h=n[s+1],l=n[s+2],u=[a,h,h,l,l,a],c=0;c<u.length;c+=2)x(3*u[c],3*u[c+1],t,r)&&e.push(u[c],u[c+1]);else for(var d=0,f=i;d<f;d+=3)for(var m=d+1,p=d+2,v=[d,m,m,p,p,d],g=0;g<v.length;g+=2)x(3*v[g],3*v[g+1],t,r)&&e.push(v[g],v[g+1]);return e}function x(t,e,i,n){var r=i[t]+","+i[t+1]+","+i[t+2]+"-"+i[e]+","+i[e+1]+","+i[e+2],s=i[e]+","+i[e+1]+","+i[e+2]+"-"+i[t]+","+i[t+1]+","+i[t+2];return!0!==n.has(r)&&!0!==n.has(s)&&(n.add(r),n.add(s),!0)}var w=Math.PI/180,Z=180/Math.PI;function E(t){return t*w}function A(t){return t*Z}function M(t,e,i){return Math.min(Math.max(t,e),i)}function T(t){return Math.log(t)/Math.LN2%1==0}var S=Float32Array;function _(t,e){void 0===e&&(e=!0),S=t?Float64Array:Float32Array,e&&l.ZR(S)}function C(){return S}function R(t){return"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext||("undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||(!(null==t||!t.gl||!(t.gl instanceof WebGLRenderingContext||t.gl instanceof WebGL2RenderingContext))||Boolean(t&&Number.isFinite(t._version))))}function F(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||(!!(null!=t&&t.gl&&t.gl instanceof WebGL2RenderingContext)||Boolean(t&&2===t._version))}function O(t,e,i){void 0===e&&(e={}),void 0===i&&(i=!1);var n=["webgl2","webgl","experimental-webgl"];i||n.shift();var r=null;function s(t){console.error(t.statusMessage)}null==t||null==t.addEventListener||t.addEventListener("webglcontextcreationerror",s,!1);for(var o=0;o<n.length;++o){try{r=t.getContext(n[o],e)}catch(a){}if(r)break}return null==t||null==t.removeEventListener||t.removeEventListener("webglcontextcreationerror",s,!1),r}var P=function(){return("undefined"==typeof performance?Date:performance).now()};function L(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function N(t){return"string"===L(t)}function I(t){return"undefined"===L(t)}function B(t){return N(t)&&t.includes("%")}function k(t){return"number"===L(t)}function U(t){return"regexp"===L(t)}function D(t){return null==t}function G(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}var j={};function z(t){return void 0===t&&(t="id"),j[t]=j[t]||1,t+"-"+j[t]++}function V(t,e){return void 0===e&&(e=[]),Object.keys(t).filter((function(t){return e.indexOf(t)<0})).reduce((function(e,i){var n;return Object.assign(e,((n={})[i]=t[i],n))}),{})}var W=[],H=1e3/60,q=performance.now();function X(){var t=P(),e=t-q;if(e>=H){q=t-e%H;var i=W.slice();W.length=0;for(var n=0;n<i.length;n++)i[n]&&i[n](t,e)}else setImmediate(X)}function Y(t){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):(e=t,W.push(e),1===W.length&&setImmediate(X),W.length-1);var e}function K(t){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):void(W[t]=void 0)}var J=Object.freeze({__proto__:null,DEG_TO_RAD:w,RAD_TO_DEG:Z,cancelAnimationFrame:K,clamp:M,defineShader:function(t,e){return void 0===e&&(e={}),Object.keys(e).reduce((function(t,i){return e[i]?"#define "+i+" "+e[i]+"\n"+t:t}),t)},degToRad:E,getContext:O,getFloatArrayConstructor:C,getShaderName:b,getWireframeIndex:y,hasValue:function(t,e){return G(t)?!D(t.value)&&(D(e)||t.value===e):!D(t)&&(D(e)||t===e)},highPrecision:_,isHex:B,isNull:D,isNumber:k,isObject:G,isPowerOfTwo:T,isRegexp:U,isString:N,isUndef:I,isUniqueEdge:x,isWebGL:R,isWebGL2:F,now:P,omit:V,parseShader:g,pick:function(t,e){return void 0===e&&(e=[]),Object.keys(t).filter((function(t){return e.indexOf(t)>-1})).reduce((function(e,i){var n;return Object.assign(e,((n={})[i]=t[i],n))}),{})},radToDeg:A,requestAnimationFrame:Y,typeOf:L,uid:z}),$=(0,h.Z)("lastTime"),Q=(0,h.Z)("elapsedTime"),tt=(0,h.Z)("start"),et=function(){function t(t){void 0===t&&(t=!0),Object.defineProperty(this,$,{writable:!0,value:0}),Object.defineProperty(this,Q,{writable:!0,value:0}),Object.defineProperty(this,tt,{writable:!0,value:!1}),this.running=void 0,this.running=t}var e=t.prototype;return e.start=function(){(0,a.Z)(this,tt)[tt]||(this.reset(),(0,a.Z)(this,tt)[tt]=!0)},e.stop=function(){this.getElapsedTime(),(0,a.Z)(this,tt)[tt]=!1,this.running=!1},e.reset=function(){(0,a.Z)(this,$)[$]=P(),(0,a.Z)(this,Q)[Q]=0},e.getElapsedTime=function(){return this.getDelta(),(0,a.Z)(this,Q)[Q]},e.getDelta=function(){var t=0;if(this.running&&!(0,a.Z)(this,tt)[tt])return this.start(),0;if((0,a.Z)(this,tt)[tt]){var e=P();t=(e-(0,a.Z)(this,$)[$])/1e3,(0,a.Z)(this,$)[$]=e,(0,a.Z)(this,Q)[Q]=(0,a.Z)(this,Q)[Q]+t}return t},t}(),it={autoStart:!0},nt=(0,h.Z)("raf"),rt=(0,h.Z)("animating"),st=(0,h.Z)("isVisible"),ot=(0,h.Z)("clock"),at=(0,h.Z)("callback"),ht=function(){function t(t,e){var i=this;void 0===e&&(e={}),this.options=void 0,Object.defineProperty(this,nt,{writable:!0,value:void 0}),Object.defineProperty(this,rt,{writable:!0,value:void 0}),Object.defineProperty(this,st,{writable:!0,value:void 0}),Object.defineProperty(this,ot,{writable:!0,value:void 0}),Object.defineProperty(this,at,{writable:!0,value:void 0}),this.options=Object.assign({},e,it),(0,a.Z)(this,ot)[ot]=new et,this.reset(),this.onVisibilityChange=this.onVisibilityChange.bind(this),(0,a.Z)(this,at)[at]=function(){var e=(0,a.Z)(i,ot)[ot].getElapsedTime();t&&t(e)},this.options.autoStart&&this.start()}var e=t.prototype;return e.reset=function(){(0,a.Z)(this,rt)[rt]=!1,(0,a.Z)(this,st)[st]=!0,void 0!==(0,a.Z)(this,nt)[nt]&&K((0,a.Z)(this,nt)[nt])},e.start=function(){(0,a.Z)(this,rt)[rt]||((0,a.Z)(this,rt)[rt]=!0,(0,a.Z)(this,ot)[ot].start(),this.tick(),"undefined"!=typeof window&&window.document&&window.document.addEventListener("visibilitychange",this.onVisibilityChange,!1))},e.stop=function(){(0,a.Z)(this,ot)[ot].stop(),this.reset(),"undefined"!=typeof window&&window.document&&window.document.removeEventListener("visibilitychange",this.onVisibilityChange,!1)},e.tick=function(){var t=this;(0,a.Z)(this,rt)[rt]&&(0,a.Z)(this,st)[st]&&((0,a.Z)(this,nt)[nt]=Y((function(){t.tick()})),(0,a.Z)(this,at)[at]())},e.onVisibilityChange=function(){"undefined"!=typeof window&&window.document&&((0,a.Z)(this,st)[st]=!window.document.hidden),(0,a.Z)(this,st)[st]&&(this.reset(),this.start())},(0,o.Z)(t,[{key:"visible",get:function(){return(0,a.Z)(this,st)[st]}},{key:"animating",get:function(){return(0,a.Z)(this,rt)[rt]}},{key:"elapsedTime",get:function(){return(0,a.Z)(this,ot)[ot].getElapsedTime()}}]),t}(),lt=function(t,e){var i=this;void 0===e&&(e={}),this.type=void 0,this.type=t,(Object.getOwnPropertyNames(e)||[]).forEach((function(t){i[t]=e[t]}))},ut=function(){function t(t){var e=(void 0===t?{}:t).validEventTypes,i=void 0===e?[/.*/]:e;this.fns=void 0,this.validateEventTypes=void 0,this.fns=new Map,this.validateEventTypes=i}var e=t.prototype;return e.validateEventType=function(t){var e=this.validateEventTypes;Array.isArray(this.validateEventTypes)||(e=[this.validateEventTypes]);var i=!0;if(e.forEach((function(e){U(e)&&!e.test(t)&&(i=!1)})),!i)throw new Error("Invalid Event Type: '"+t+"'.\nEvent type should be any of: "+e+".")},e.on=function(t,e,i){var n=this;if(this.validateEventType(t),N(t)){var r=t.split(" ");if(r.length>1)return r.forEach((function(t){n.on(t,e,i)})),this}return this.has(t)||this.fns.set(t,[]),this.fns.get(t).push(e),this},e.once=function(t,e,i){var n=this;if(this.validateEventType(t),N(t)){var r=t.split(" ");if(r.length>1)return r.forEach((function(t){n.once(t,e,i)})),this}return this.on(t,(function r(){n.off(t,r);for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];e.call.apply(e,[i||n].concat(o))}),i)},e.off=function(t,e,i){var n=this;if(this.validateEventType(t),N(t)){var r=t.split(" ");if(r.length>1)return r.forEach((function(t){n.off(t,e,i)})),this}var s=this.has(t);if(s)if(e){var o=s.filter((function(t){return t!==e}));this.fns.set(t,o)}else this.fns.delete(t);return this},e.emit=function(t,e){var i=this,n=t instanceof lt?t:new lt(t,e);this.validateEventType(n.type);var r=this.has(n.type);if(r)return r.map((function(t){return t.call(i,n)}))},e.has=function(t){return this.fns.get(t)},e.clear=function(){return this.fns.clear(),this},t}(),ct=function(){function t(){this.elements=new(C())(2)}var e=t.prototype;return e.fromArray=function(t,e){void 0===e&&(e=0);for(var i=0;i<this.elements.length;i++)this.elements[i]=t[e+i];return this},e.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var i=0;i<this.elements.length;i++)t[e+i]=this.elements[i];return t},t}(),dt=function(t){function e(e,i){var n;void 0===e&&(e=0),void 0===i&&(i=0),(n=t.call(this)||this).elements=new(C())(2);var r=n.elements;return r[0]=e,r[1]=i,n}(0,s.Z)(e,t);var i=e.prototype;return i.fromObject=function(t){var e=t.x,i=t.y;return void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),this},i.toObject=function(){return{x:this.x,y:this.y}},i.set=function(t,e){return this.x=t,this.y=e,this},i.setScalar=function(t){return this.set(t,t)},i.add=function(t){return(0,u.IH)(this.elements,this.elements,t.elements),this},i.addScalar=function(t){return(0,u.IH)(this.elements,this.elements,[t,t]),this},i.subtract=function(t){return(0,u.$X)(this.elements,this.elements,t.elements),this},i.subtractScalar=function(t){return(0,u.$X)(this.elements,this.elements,[t,t]),this},i.multiply=function(t){return(0,u.Jp)(this.elements,this.elements,t.elements),this},i.multiplyScalar=function(t){return(0,u.Jp)(this.elements,this.elements,[t,t]),this},i.divide=function(t){return(0,u.cs)(this.elements,this.elements,t.elements),this},i.divideScalar=function(t){return(0,u.cs)(this.elements,this.elements,[t,t]),this},i.scale=function(t){return(0,u.bA)(this.elements,this.elements,t),this},i.distanceTo=function(t){return(0,u.TE)(this.elements,t.elements)},i.length=function(){return(0,u.kE)(this.elements)},i.distanceToSquared=function(t){return(0,u.bI)(t.elements,this.elements)},i.angle=function(){return(0,u.EU)(this.elements,[1,0])},i.angleTo=function(t){return(0,u.EU)(this.elements,t.elements)},i.dot=function(t){return(0,u.AK)(this.elements,t.elements)},i.equals=function(t){return(0,u.fS)(this.elements,t.elements)},i.cross=function(t){return(0,u.kC)(this.elements,this.elements,t.elements),this},i.negate=function(){return(0,u.tk)(this.elements,this.elements),this},i.inverse=function(){return(0,u.SO)(this.elements,this.elements),this},i.lerp=function(t,e){return(0,u.t7)(this.elements,this.elements,t.elements,e),this},i.normalize=function(){return(0,u.Fv)(this.elements,this.elements),this},i.applyMatrix3=function(t){return(0,u.kK)(this.elements,this.elements,t.elements),this},i.applyMatrix4=function(t){return(0,u.fF)(this.elements,this.elements,t.elements),this},i.copy=function(t){return this.x=t.x,this.y=t.y,this},i.clone=function(){return new e(this.x,this.y)},i.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,o.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t}}]),e}(ct),ft=[],mt=(0,h.Z)("changeCallbacks"),pt=function(t){function e(e,i,n,s){var o;void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),(o=t.call(this)||this).elements=new(C())(4),Object.defineProperty((0,r.Z)(o),mt,{writable:!0,value:[]});var a=o.elements;return a[0]=e,a[1]=i,a[2]=n,a[3]=s,o}(0,s.Z)(e,t);var i=e.prototype;return i.fromObject=function(t){var e=t.x,i=t.y,n=t.z,r=t.w;return void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==n&&(this.z=n),void 0!==r&&(this.w=r),this.triggerChange(),this},i.toObject=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}},i.fromAxisAngle=function(t,e){return(0,d.yY)(this.elements,t.elements,e),this.triggerChange(),this},i.getAxisAngle=function(t){void 0===t&&(t=new vt);var e=(0,d.Bh)(ft,this.elements);return t.set(ft[0],ft[1],ft[2]),e},i.fromEuler=function(t){return(0,d.Su)(this.elements,A(t.x),A(t.y),A(t.z)),this.triggerChange(),this},i.fromMat3=function(t){return(0,d.bz)(this.elements,t),this},i.set=function(t,e,i,n){return(0,d.t8)(this.elements,t,e,i,n),this.triggerChange(),this},i.length=function(){return(0,d.kE)(this.elements)},i.multiply=function(t,e){return e?(0,d.Jp)(this.elements,t.elements,e.elements):(0,d.Jp)(this.elements,this.elements,t.elements),this.triggerChange(),this},i.slerp=function(t,e){return(0,d.ZA)(this.elements,this.elements,t.elements,e),this.triggerChange(),this},i.invert=function(){return(0,d.U_)(this.elements,this.elements),this.triggerChange(),this},i.conjugate=function(){return(0,d.Kx)(this.elements,this.elements),this.triggerChange(),this},i.normalize=function(){return(0,d.Fv)(this.elements,this.elements),this.triggerChange(),this},i.dot=function(t){return(0,d.AK)(this.elements,t.elements)},i.angleTo=function(t){return(0,d._O)(this.elements,t.elements)},i.clone=function(){return(new e).copy(this)},i.copy=function(t){return(0,d.JG)(this.elements,t.elements),this.triggerChange(),this},i.equals=function(t){return(0,f.fS)(this.elements,t.elements)},i.onChange=function(t){(0,a.Z)(this,mt)[mt].includes(t)||(0,a.Z)(this,mt)[mt].push(t)},i.triggerChange=function(){(0,a.Z)(this,mt)[mt].forEach((function(t){return t()}))},i.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,o.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t,this.triggerChange()}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t,this.triggerChange()}},{key:"z",get:function(){return this.elements[2]},set:function(t){this.elements[2]=t,this.triggerChange()}},{key:"w",get:function(){return this.elements[3]},set:function(t){this.elements[3]=t,this.triggerChange()}}]),e}(ct),vt=function(t){function e(e,i,n){var r;void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),(r=t.call(this)||this).elements=new(C())(3);var s=r.elements;return s[0]=e,s[1]=i,s[2]=n,r}(0,s.Z)(e,t);var i=e.prototype;return i.fromObject=function(t){var e=t.x,i=t.y,n=t.z;return void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==n&&(this.z=n),this},i.toObject=function(){return{x:this.x,y:this.y,z:this.z}},i.set=function(t,e,i){return(0,c.t8)(this.elements,t,e,i),this},i.setScalar=function(t){return this.set(t,t,t)},i.length=function(){return(0,c.kE)(this.elements)},i.add=function(t){return(0,c.IH)(this.elements,this.elements,t.elements),this},i.addScalar=function(t){return(0,c.IH)(this.elements,this.elements,[t,t,t]),this},i.subtract=function(t){return(0,c.$X)(this.elements,this.elements,t.elements),this},i.subtractScalar=function(t){return(0,c.$X)(this.elements,this.elements,[t,t,t]),this},i.subVectors=function(t,e){return(0,c.$X)(this.elements,t.elements,e.elements),this},i.multiply=function(t){return(0,c.Jp)(this.elements,this.elements,t.elements),this},i.multiplyScalar=function(t){return(0,c.Jp)(this.elements,this.elements,[t,t,t]),this},i.divide=function(t){return(0,c.cs)(this.elements,this.elements,t.elements),this},i.divideScalar=function(t){return(0,c.cs)(this.elements,this.elements,[t,t,t]),this},i.scale=function(t){return(0,c.bA)(this.elements,this.elements,t),this},i.scaleAndAdd=function(t,e){return(0,c.od)(this.elements,this.elements,t.elements,e),this},i.distanceTo=function(t){return(0,c.TE)(this.elements,t.elements)},i.distanceToSquared=function(t){return(0,c.bI)(this.elements,t.elements)},i.angle=function(t){return(0,c.EU)(this.elements,[1,0,0])},i.angleTo=function(t){return(0,c.EU)(this.elements,t.elements)},i.dot=function(t){return(0,c.AK)(this.elements,t.elements)},i.equals=function(t){return(0,c.fS)(this.elements,t.elements)},i.cross=function(t){return(0,c.kC)(this.elements,this.elements,t.elements),this},i.negate=function(){return(0,c.tk)(this.elements,this.elements),this},i.inverse=function(){return(0,c.SO)(this.elements,this.elements),this},i.lerp=function(t,e){return(0,c.t7)(this.elements,this.elements,t.elements,e),this},i.normalize=function(){return(0,c.Fv)(this.elements,this.elements),this},i.applyEuler=function(t){var e=(new pt).fromEuler(t);return this.applyQuaternion(e)},i.applyMatrix3=function(t){return(0,c.kK)(this.elements,this.elements,t.elements),this},i.applyMatrix4=function(t){return(0,c.fF)(this.elements,this.elements,t.elements),this},i.applyQuaternion=function(t){return(0,c.VC)(this.elements,this.elements,t.elements),this},i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.clone=function(){return new e(this.x,this.y,this.z)},i.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,o.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t}},{key:"z",get:function(){return this.elements[2]},set:function(t){this.elements[2]=t}}]),e}(ct),gt=function(t){function e(e,i,n,r){var s;void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),(s=t.call(this)||this).elements=new(C())(4);var o=s.elements;return o[0]=e,o[1]=i,o[2]=n,o[3]=r,s}(0,s.Z)(e,t);var i=e.prototype;return i.fromObject=function(t){var e=t.x,i=t.y,n=t.z,r=t.w;return void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==n&&(this.z=n),void 0!==r&&(this.w=r),this},i.toObject=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}},i.set=function(t,e,i,n){return(0,f.t8)(this.elements,t,e,i,n),this},i.setScalar=function(t){return this.set(t,t,t,t)},i.add=function(t){return(0,f.IH)(this.elements,this.elements,t.elements),this},i.addScalar=function(t){return(0,f.IH)(this.elements,this.elements,[t,t,t,t]),this},i.subtract=function(t){return(0,f.$X)(this.elements,this.elements,t.elements),this},i.subtractScalar=function(t){return(0,f.$X)(this.elements,this.elements,[t,t,t,t]),this},i.subVectors=function(t,e){return(0,f.$X)(this.elements,t.elements,e.elements),this},i.multiply=function(t){return(0,f.Jp)(this.elements,this.elements,t.elements),this},i.multiplyScalar=function(t){return(0,f.Jp)(this.elements,this.elements,[t,t,t,t]),this},i.divide=function(t){return(0,f.cs)(this.elements,this.elements,t.elements),this},i.divideScalar=function(t){return(0,f.cs)(this.elements,this.elements,[t,t,t,t]),this},i.scale=function(t){return(0,f.bA)(this.elements,this.elements,t),this},i.scaleAndAdd=function(t,e){return(0,f.od)(this.elements,this.elements,t.elements,e),this},i.distanceTo=function(t){return(0,f.TE)(this.elements,t.elements)},i.distanceToSquared=function(t){return(0,f.bI)(this.elements,t.elements)},i.length=function(){return(0,f.kE)(this.elements)},i.dot=function(t){return(0,f.AK)(this.elements,t.elements)},i.equals=function(t){return(0,f.fS)(this.elements,t.elements)},i.cross=function(t){return(0,f.kC)(this.elements,this.elements,t.elements),this},i.negate=function(){return(0,f.tk)(this.elements,this.elements),this},i.inverse=function(){return(0,f.SO)(this.elements,this.elements),this},i.lerp=function(t,e){return(0,f.t7)(this.elements,this.elements,t.elements,e),this},i.normalize=function(){return(0,f.Fv)(this.elements,this.elements),this},i.applyMatrix4=function(t){return(0,f.fF)(this.elements,this.elements,t.elements),this},i.applyQuaternion=function(t){return(0,f.VC)(this.elements,this.elements,t.elements),this},i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.clone=function(){return new e(this.x,this.y,this.z,this.w)},i.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,o.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t}},{key:"z",get:function(){return this.elements[2]},set:function(t){this.elements[2]=t}},{key:"w",get:function(){return this.elements[3]},set:function(t){this.elements[3]=t}}]),e}(ct),bt=function(){function t(){this.elements=new(C())(16)}var e=t.prototype;return e.fromArray=function(t,e){void 0===e&&(e=0);for(var i=0;i<this.elements.length;i++)this.elements[i]=t[e+i];return this},e.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var i=0;i<this.elements.length;i++)t[e+i]=this.elements[i];return t},t}(),yt=function(t){function e(e,i,n,r,s,o,a,h,l){var u;void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===h&&(h=0),void 0===l&&(l=1),(u=t.call(this)||this).elements=new(C())(9);var c=u.elements;return c[0]=e,c[1]=i,c[2]=n,c[3]=r,c[4]=s,c[5]=o,c[6]=a,c[7]=h,c[8]=l,u}(0,s.Z)(e,t);var i=e.prototype;return i.set=function(t,e,i,n,r,s,o,a,h){return(0,m.t8)(this.elements,t,e,i,n,r,s,o,a,h),this},i.transpose=function(){return(0,m.p4)(this.elements,this.elements),this},i.invert=function(t){return void 0===t&&(t=this),(0,m.U_)(this.elements,t.elements),this},i.adjoint=function(t){return void 0===t&&(t=this),(0,m.uj)(this.elements,t.elements),this},i.determinant=function(){return(0,m.GH)(this.elements)},i.multiply=function(t,e){return e?(0,m.Jp)(this.elements,t.elements,e.elements):(0,m.Jp)(this.elements,this.elements,t.elements),this},i.premultiply=function(t,e){return e?(0,m.Jp)(this.elements,e.elements,t.elements):(0,m.Jp)(this.elements,t.elements,this.elements),this},i.translate=function(t){return(0,m.Iu)(this.elements,this.elements,t.elements),this},i.rotate=function(t){return(0,m.U1)(this.elements,this.elements,t),this},i.scale=function(t){return(0,m.bA)(this.elements,this.elements,t.elements),this},i.fromTranslation=function(t){return(0,m.vc)(this.elements,t.elements),this},i.fromRotation=function(t){return(0,m.Us)(this.elements,t),this},i.fromScaling=function(t){return(0,m.xJ)(this.elements,t.elements),this},i.fromQuat=function(t){return(0,m.en)(this.elements,t.elements),this},i.normalFromMat4=function(t){return(0,m.XL)(this.elements,t.elements),this},i.fromMat4=function(t){return(0,m.xO)(this.elements,t.elements),this},i.frob=function(){return(0,m.Du)(this.elements)},i.add=function(t,e){return e?(0,m.IH)(this.elements,t.elements,e.elements):(0,m.IH)(this.elements,this.elements,t.elements),this},i.subtract=function(t,e){return e?(0,m.$X)(this.elements,t.elements,e.elements):(0,m.$X)(this.elements,this.elements,t.elements),this},i.equals=function(t,e){return e?(0,m.fS)(t.elements,e.elements):(0,m.fS)(this.elements,t.elements)},i.fromRotationTranslationScale=function(t,e,i,n,r){var s=Math.cos(t),o=Math.sin(t);return this.set(n*s,-r*o,0,n*o,r*s,0,e,i,1),this},i.getNormalMatrix=function(t){return(0,m.XL)(this.elements,t.elements),this},i.copy=function(t){return(0,m.JG)(this.elements,t.elements),this},i.clone=function(){return(new e).copy(this)},i.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,o.Z)(e,[{key:"x",get:function(){return this.elements[2]}},{key:"y",get:function(){return this.elements[5]}},{key:"z",get:function(){return this.elements[8]}}],[{key:"identity",get:function(){return(new e).fromArray((0,m.yR)([]))}}]),e}(bt),xt=[],wt=function(t){function e(e,i,n,r,s,o,a,h,l,u,c,d,f,m,p,v){var g;void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=1),void 0===d&&(d=0),void 0===f&&(f=0),void 0===m&&(m=0),void 0===p&&(p=0),void 0===v&&(v=1),(g=t.call(this)||this).elements=new(C())(16);var b=g.elements;return b[0]=e,b[1]=i,b[2]=n,b[3]=r,b[4]=s,b[5]=o,b[6]=a,b[7]=h,b[8]=l,b[9]=u,b[10]=c,b[11]=d,b[12]=f,b[13]=m,b[14]=p,b[15]=v,g}(0,s.Z)(e,t);var i=e.prototype;return i.set=function(t,e,i,n,r,s,o,a,h,l,u,c,d,f,m,v){return(0,p.t8)(this.elements,t,e,i,n,r,s,o,a,h,l,u,c,d,f,m,v),this},i.transpose=function(){return(0,p.p4)(this.elements,this.elements),this},i.invert=function(t){return void 0===t&&(t=this),(0,p.U_)(this.elements,t.elements),this},i.adjoint=function(t){return void 0===t&&(t=this),(0,p.uj)(this.elements,t.elements),this},i.determinant=function(){return(0,p.GH)(this.elements)},i.add=function(t,e){return e?(0,p.IH)(this.elements,t.elements,e.elements):(0,p.IH)(this.elements,this.elements,t.elements),this},i.subtract=function(t,e){return e?(0,p.$X)(this.elements,t.elements,e.elements):(0,p.$X)(this.elements,this.elements,t.elements),this},i.multiply=function(t,e){return e?(0,p.Jp)(this.elements,t.elements,e.elements):(0,p.Jp)(this.elements,this.elements,t.elements),this},i.multiplyScalar=function(t,e){return void 0===t&&(t=this),(0,p.cf)(this.elements,t.elements,e),this},i.premultiply=function(t,e){return e?(0,p.Jp)(this.elements,e.elements,t.elements):(0,p.Jp)(this.elements,t.elements,this.elements),this},i.translate=function(t){return(0,p.Iu)(this.elements,this.elements,t.elements),this},i.rotate=function(t){return(0,p.U1)(this.elements,this.elements,t),this},i.scale=function(t){return(0,p.bA)(this.elements,this.elements,t.elements),this},i.scaleScalar=function(t){return(0,p.bA)(this.elements,this.elements,[t,t,t]),this},i.fromTranslation=function(t){return(0,p.vc)(this.elements,t.elements),this},i.fromRotation=function(t,e){return(0,p.Us)(this.elements,t,e),this},i.fromRotationX=function(t){return(0,p.aC)(this.elements,t),this},i.fromRotationY=function(t){return(0,p.gT)(this.elements,t),this},i.fromRotationZ=function(t){return(0,p.QO)(this.elements,t),this},i.fromScale=function(t){return(0,p.xJ)(this.elements,t.elements),this},i.fromRotationTranslation=function(t,e){return(0,p.yl)(this.elements,t.elements,e.elements),this},i.fromPerspective=function(t,e,i,n){return(0,p.G3)(this.elements,E(t),e,i,n),this},i.fromOrthogonal=function(t,e,i,n,r,s){return(0,p.M5)(this.elements,t,e,i,n,r,s),this},i.fromQuat=function(t){return(0,p.en)(this.elements,t.elements),this},i.equals=function(t){return(0,p.fS)(this.elements,t.value)},i.getRotation=function(t){return void 0===t&&(t=new pt),(0,p.j6)(xt,this.elements),t.set(xt[0],xt[1],xt[2],xt[3]),t},i.getScale=function(t){return void 0===t&&(t=new vt),(0,p.Q$)(xt,this.elements),t.set(xt[0],xt[1],xt[2]),t},i.getTranslation=function(t){return void 0===t&&(t=new vt),(0,p.i0)(xt,this.elements),t.set(xt[0],xt[1],xt[2]),t},i.rotateX=function(t){return(0,p.lM)(this.elements,this.elements,t),this},i.rotateY=function(t){return(0,p.uD)(this.elements,this.elements,t),this},i.rotateZ=function(t){return(0,p.jI)(this.elements,this.elements,t),this},i.compose=function(t,e,i){return(0,p.Iw)(this.elements,e.elements,t.elements,i.elements),this},i.decompose=function(){return{rotation:this.getRotation(),scale:this.getScale(),translation:this.getTranslation()}},i.copy=function(t){return(0,p.JG)(this.elements,t.elements),this},i.clone=function(){return(new e).copy(this)},i.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,o.Z)(e,[{key:"x",get:function(){return this.elements[12]}},{key:"y",get:function(){return this.elements[13]}},{key:"z",get:function(){return this.elements[14]}},{key:"w",get:function(){return this.elements[15]}}],[{key:"identity",get:function(){return(new e).fromArray((0,p.yR)([]))}}]),e}(bt),Zt=(0,h.Z)("changeCallbacks"),Et=(0,h.Z)("order"),At=function(t){function e(e,i,n,s){var o;void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s="xyz"),(o=t.call(this)||this).elements=new(C())(3),Object.defineProperty((0,r.Z)(o),Zt,{writable:!0,value:[]}),Object.defineProperty((0,r.Z)(o),Et,{writable:!0,value:"xyz"});var h=o.elements;return h[0]=e,h[1]=i,h[2]=n,(0,a.Z)((0,r.Z)(o),Et)[Et]=s,o}(0,s.Z)(e,t);var i=e.prototype;return i.fromObject=function(t){var e=t.x,i=t.y,n=t.z,r=t.order;return void 0!==e&&(this.x=e),void 0!==i&&(this.y=i),void 0!==n&&(this.z=n),void 0!==r&&(this.order=r),this.triggerChange(),this},i.toObject=function(){return{x:this.x,y:this.y,z:this.z,order:this.order}},i.fromRotationMatrix=function(t,e,i){void 0===e&&(e=(0,a.Z)(this,Et)[Et]),void 0===i&&(i=!0);var n=t.toArray(),r=n[0],s=n[4],o=n[8],h=n[1],l=n[5],u=n[9],c=n[2],d=n[6],f=n[10];switch(e){case"xyz":this.y=Math.asin(M(o,-1,1)),Math.abs(o)<.9999999?(this.x=Math.atan2(-u,f),this.z=Math.atan2(-s,r)):(this.x=Math.atan2(d,l),this.z=0);break;case"yxz":this.x=Math.asin(-M(u,-1,1)),Math.abs(u)<.9999999?(this.y=Math.atan2(o,f),this.z=Math.atan2(h,l)):(this.y=Math.atan2(-c,r),this.z=0);break;case"zxy":this.x=Math.asin(M(d,-1,1)),Math.abs(d)<.9999999?(this.y=Math.atan2(-c,f),this.z=Math.atan2(-s,l)):(this.y=0,this.z=Math.atan2(h,r));break;case"zyx":this.y=Math.asin(-M(c,-1,1)),Math.abs(c)<.9999999?(this.x=Math.atan2(d,f),this.z=Math.atan2(h,r)):(this.x=0,this.z=Math.atan2(-s,l));break;case"yzx":this.z=Math.asin(M(h,-1,1)),Math.abs(h)<.9999999?(this.x=Math.atan2(-u,l),this.y=Math.atan2(-c,r)):(this.x=0,this.y=Math.atan2(o,f));break;case"xzy":this.z=Math.asin(-M(s,-1,1)),Math.abs(s)<.9999999?(this.x=Math.atan2(d,l),this.y=Math.atan2(o,r)):(this.x=Math.atan2(-u,f),this.y=0);break;default:throw new Error("Unknown Euler angle order")}return(0,a.Z)(this,Et)[Et]=e,i&&this.triggerChange(),this},i.fromQuaternion=function(t){var i=t.elements,n=i[0],r=i[1],s=i[2],o=i[3],a=r*r,h=-2*(a+s*s)+1,l=2*(n*r+o*s),u=-2*(n*s-o*r),c=2*(r*s+o*n),d=-2*(n*n+a)+1;return u=(u=u>1?1:u)<-1?-1:u,new e(Math.atan2(c,d),Math.asin(u),Math.atan2(l,h),"zyx")},i.fromVector3=function(t,e){return void 0===e&&(e=(0,a.Z)(this,Et)[Et]),this.set(t.x,t.y,t.z,e)},i.toQuaternion=function(){var t=Math.cos(.5*this.yaw),e=Math.sin(.5*this.yaw),i=Math.cos(.5*this.roll),n=Math.sin(.5*this.roll),r=Math.cos(.5*this.pitch),s=Math.sin(.5*this.pitch);return new pt(t*n*r-e*i*s,t*i*s+e*n*r,e*i*r-t*n*s,t*i*r+e*n*s)},i.toVector3=function(){return new vt(this.x,this.y,this.z)},i.set=function(t,e,i,n){return void 0===n&&(n=(0,a.Z)(this,Et)[Et]),this.elements[0]=t,this.elements[1]=e,this.elements[2]=i,(0,a.Z)(this,Et)[Et]=n,this.triggerChange(),this},i.clone=function(){return(new e).copy(this)},i.copy=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]=t.elements[e];return(0,a.Z)(this,Et)[Et]=t.order,this.triggerChange(),this},i.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.order===t.order},i.onChange=function(t){(0,a.Z)(this,Zt)[Zt].includes(t)||(0,a.Z)(this,Zt)[Zt].push(t)},i.triggerChange=function(){(0,a.Z)(this,Zt)[Zt].forEach((function(t){return t()}))},i.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,o.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t,this.triggerChange()}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t,this.triggerChange()}},{key:"z",get:function(){return this.elements[2]},set:function(t){this.elements[2]=t,this.triggerChange()}},{key:"order",get:function(){return(0,a.Z)(this,Et)[Et]},set:function(t){(0,a.Z)(this,Et)[Et]=t,this.triggerChange()}},{key:"roll",get:function(){return this.x},set:function(t){this.x=t}},{key:"pitch",get:function(){return this.y},set:function(t){this.y=t}},{key:"yaw",get:function(){return this.z},set:function(t){this.z=t}}]),e}(ct);(0,v.l7)([function(t,e){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var r in i)n[i[r]]=r;var s={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,o,a=n[this.toHex()];if(a)return a;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,u="black";if(!s.length)for(var c in i)s[c]=new t(i[c]).toRgb();for(var d in i){var f=(r=h,o=s[d],Math.pow(r.r-o.r,2)+Math.pow(r.g-o.g,2)+Math.pow(r.b-o.b,2));f<l&&(l=f,u=d)}return u}},e.string.push([function(e){var n=e.toLowerCase(),r="transparent"===n?"#0000":i[n];return r?new t(r).toRgb():null},"name"])}]);var Mt=function(t,e,i){var n=B(t),r=i-e,s=M(Number.parseFloat(""+t),e,i);return n&&(s=Number.parseInt(""+t*i,10)/100),Math.abs(s-i)<1e-6?1:t%r/r},Tt=function(){function t(t,e,i,n,r){if(void 0===t&&(t=255),void 0===n&&(n=1),void 0===r&&(r=!1),this.r=void 0,this.g=void 0,this.b=void 0,this.a=void 0,this.r=1,this.g=1,this.b=1,this.a=1,I(e)&&I(i))if(k(t)&&t<=255)this.setRGBA(t,t,t,this.a,r);else{var s=(0,v.Vi)(t).toRgb();s?this.setRGBA(s.r,s.g,s.b,s.a):console.error("Unsupported color value {".concat(String(t),"} provided"))}else this.setRGBA(t,e,i,n)}var e=t.prototype;return e.fromColor=function(t){var e=(0,v.Vi)(t).toRgb();return this.setRGBA(e.r,e.g,e.b,e.a)},e.fromHSL=function(t,e,i,n){void 0===n&&(n=1);var r=(0,v.Vi)({h:t,s:e,l:i,a:n}).toRgb();return this.setRGBA(r.r,r.g,r.b,r.a)},e.fromHSV=function(t,e,i,n){void 0===n&&(n=1);var r=(0,v.Vi)({h:t,s:e,v:i,a:n}).toRgb();return this.setRGBA(r.r,r.g,r.b,r.a)},e.setRGB=function(t,e,i){return this.setRGBA(t,e,i,this.a),this},e.setRGBA=function(t,e,i,n,r){return this.r=r?t:Mt(t,0,255),this.g=r?e:Mt(e,0,255),this.b=r?i:Mt(i,0,255),this.setAlpha(n),this},e.setAlpha=function(t){return this.a=t>1?Mt(t,0,255):t,this},e.toHex=function(){return(0,v.Vi)(this.toObject()).toHex()},e.toHSL=function(){return(0,v.Vi)(this.toObject()).toHsl()},e.toHSV=function(){return(0,v.Vi)(this.toObject()).toHsv()},e.toObject=function(t){void 0===t&&(t=!1);var e=t?1:255;return{r:this.r*e,g:this.g*e,b:this.b*e,a:this.a}},e.toArray=function(){return[this.r,this.g,this.b,this.a]},e.toVector=function(){return(new gt).fromArray(this.toArray())},e.toVector3=function(){return(new vt).fromArray(this.toArray())},e.toString=function(){return this.constructor.name+"("+this.r+", "+this.g+", "+this.b+", "+this.a+")"},t}(),St=function(t){function e(){return t.apply(this,arguments)||this}(0,s.Z)(e,t);var i=e.prototype;return i.frustum=function(t,e,i,n,r,s,o){return(0,p.oy)(t.elements,e,i,r,n,s,o),this},i.orthographic=function(t,e,i,n,r,s){return(0,p.M5)(this.elements,t,e,n,i,r,s),this},i.perspective=function(t,e,i,n){return(0,p.G3)(this.elements,t,e,i,n),this},i.lookAt=function(t,e,i){return void 0===e&&(e=new vt(0,0,0)),void 0===i&&(i=new vt(0,1,0)),(0,p.zB)(this.elements,t.elements,e.elements,i.elements),this},i.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},e}(wt),_t=function(){function t(){var t=this;this.visible=void 0,this.localMatrix=void 0,this.worldMatrix=void 0,this.matrixAutoUpdate=void 0,this.position=void 0,this.scale=void 0,this.rotation=void 0,this.quaternion=void 0,this.up=void 0,this.children=void 0,this.parent=void 0,this.worldMatrixNeedsUpdate=void 0,this.visible=!0,this.localMatrix=new St,this.worldMatrix=new St,this.matrixAutoUpdate=!0,this.position=new vt,this.scale=new vt(1,1,1),this.rotation=new At,this.quaternion=new pt,this.up=new vt(0,1,0),this.parent=null,this.children=[],this.worldMatrixNeedsUpdate=!1,this.rotation.onChange((function(){t.quaternion.fromEuler(t.rotation)})),this.quaternion.onChange((function(){t.rotation.fromQuaternion(t.quaternion)}))}var e=t.prototype;return e.add=function(t,e){void 0===e&&(e=!0),this.contains(t)||this.children.push(t),e&&t.setParent(this,!1)},e.remove=function(t,e){void 0===e&&(e=!0),this.contains(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)},e.contains=function(t){return this.children.includes(t)},e.setParent=function(t,e){void 0===e&&(e=!0),this.parent&&t!==this.parent&&this.parent.remove(this,!1),this.parent=t,e&&t&&t.add(this,!1)},e.traverse=function(t){if(!t(this))for(var e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)},e.lookAt=function(t,e){e?this.localMatrix.lookAt(this.position,t,this.up):this.localMatrix.lookAt(t,this.position,this.up),this.localMatrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)},e.updateMatrixWorld=function(t){var e=t;this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(null===this.parent?this.worldMatrix.copy(this.localMatrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.localMatrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(var i=0,n=this.children.length;i<n;i++){this.children[i].updateMatrixWorld(e)}},e.updateMatrix=function(){this.localMatrix.compose(this.position,this.quaternion,this.scale),this.worldMatrixNeedsUpdate=!0},e.decompose=function(){this.localMatrix.getTranslation(this.position),this.localMatrix.getRotation(this.quaternion),this.localMatrix.getScale(this.scale),this.rotation.fromQuaternion(this.quaternion)},e.clone=function(){return(new t).copy(this,!1)},e.copy=function(t,e){if(this.visible=t.visible,this.position.copy(t.position),this.scale.copy(t.scale),this.rotation.copy(t.rotation),this.quaternion.copy(t.quaternion),this.up.copy(t.up),this.localMatrix.copy(t.localMatrix),this.worldMatrix.copy(t.worldMatrix),this.matrixAutoUpdate=t.matrixAutoUpdate,e)for(var i=0,n=t.children.length;i<n;i++){var r=t.children[i];this.add(r.clone())}return this},t}(),Ct=function(){function t(t){this.renderer=void 0,this.renderer=t}return(0,o.Z)(t,[{key:"gl",get:function(){return this.renderer.gl}},{key:"rendererState",get:function(){return this.renderer.state}}]),t}(),Rt=function(t,e){this.id=void 0,this.data=void 0,this.type=void 0,this.size=void 0,this.instanced=void 0,this.stride=void 0,this.offset=void 0,this.divisor=void 0,this.normalized=void 0,this.needsUpdate=void 0,this.count=void 0,this.usage=void 0,this.target=void 0,this.buffer=void 0;var i,n,r=Object.assign({},{size:1,normalized:!0,stride:0,offset:0,divisor:0,usage:t.gl.STATIC_DRAW},e);if(this.id=z("attribute"),this.needsUpdate=!1,!e.data||Array.isArray(e.data))throw new TypeError("BufferAttribute: data should be a typed array");this.data=r.data,this.size=r.size||1,this.type=r.type||(i=t.gl,(n=r.data)instanceof Float32Array||n instanceof Float64Array?i.FLOAT:n instanceof Uint16Array?i.UNSIGNED_SHORT:n instanceof Uint8Array||n instanceof Uint8ClampedArray?i.UNSIGNED_BYTE:n instanceof Uint32Array?i.UNSIGNED_INT:n instanceof Int8Array?i.BYTE:n instanceof Int16Array?i.SHORT:n instanceof Int32Array?i.INT:void 0),this.normalized=r.normalized||!1,this.stride=r.stride||0,this.offset=r.offset||0,this.divisor=r.divisor||0,this.instanced=r.divisor>0,this.usage=r.usage||t.gl.STATIC_DRAW,r.target&&(this.target=r.target);var s=r.count;void 0!==r.count&&null!==r.count||(s=r.stride?r.data.byteLength/r.stride:r.data.length/r.size),this.count=s},Ft=new vt,Ot=(0,h.Z)("id"),Pt=(0,h.Z)("attributes"),Lt=(0,h.Z)("VAOs"),Nt=(0,h.Z)("bounds"),It=function(t){function e(e,i){var n;for(var s in void 0===i&&(i={}),n=t.call(this,e)||this,Object.defineProperty((0,r.Z)(n),Ot,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Pt,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Lt,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Nt,{writable:!0,value:void 0}),n.drawRange=void 0,n.instancedCount=void 0,n.isInstanced=void 0,n.drawMode=void 0,n.drawRange={start:0,count:0},n.instancedCount=0,n.isInstanced=!1,(0,a.Z)((0,r.Z)(n),Pt)[Pt]=new Map,(0,a.Z)((0,r.Z)(n),Lt)[Lt]=new Map,(0,a.Z)((0,r.Z)(n),Ot)[Ot]=z("geometry"),n.drawMode=n.gl.TRIANGLES,e.bindVertexArray(null),e.state.setActiveGeometry(null),i){var o=i[s];if(o instanceof Rt)"index"===s?n.setIndex(o):n.addAttribute(s,o);else if(o.data){var h=new Rt(n.renderer,o);"index"===s?n.setIndex(h):n.addAttribute(s,h)}}return n}(0,s.Z)(e,t);var i=e.prototype;return i.addAttribute=function(t,e){if(e.target||(e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER),e.needsUpdate=!1,this.attributes.set(t,e),e.buffer||(e.buffer=this.gl.createBuffer(),this.updateAttribute(e)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor),console.warn("Geometry has multiple instanced buffers of different length - instancedCount: "+this.instancedCount+", count: "+e.count+", divisor: "+e.divisor+", attribute: "+t);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))},i.getAttribute=function(t){return this.attributes.get(t)},i.setAttributeData=function(t,e){var i=this.getAttribute(t);i&&(i.data=e,i.needsUpdate=!0)},i.updateAttribute=function(t){!t.buffer&&(t.buffer=this.gl.createBuffer()),this.rendererState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.rendererState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,t.usage),t.needsUpdate=!1},i.removeAttribute=function(t){this.attributes.delete(t)},i.setIndex=function(t){var e;if(t instanceof Rt)t.size=1,this.addAttribute("index",t);else{var i=new Rt(this.renderer,{data:t.length>65535?new Uint32Array(t):new Uint16Array(t),size:1});this.addAttribute("index",i)}this.drawRange.count=null==(e=this.index)?void 0:e.count},i.setVertices=function(t){for(var e=[],i=t.length,n=0;n<i;n++){var r=t[n];e.push(r[0],r[1],r[2])}this.addAttribute("position",new Rt(this.renderer,{data:new Float32Array(e),size:3}))},i.setNormals=function(t){this.addAttribute("normal",new Rt(this.renderer,{data:new Float32Array(t),size:2}))},i.setUVs=function(t){this.addAttribute("uv",new Rt(this.renderer,{data:new Float32Array(t),size:2}))},i.setColors=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];n&&(n instanceof vt||n instanceof gt)&&(n=n.toArray()),e.push(n[0],n[1],n[2],n[3]||1)}this.addAttribute("color",new Rt(this.renderer,{data:new Float32Array(e),size:4}))},i.setDrawRange=function(t,e){this.drawRange.start=t,this.drawRange.count=e},i.setInstancedCount=function(t){this.instancedCount=t},i.createVAO=function(t){var e=t.attributeOrder,i=this.renderer.createVertexArray();this.renderer.bindVertexArray(i),(0,a.Z)(this,Lt)[Lt].set(e,i),this.bindAttributes(t)},i.bindAttributes=function(t){var e=this;t.attributeLocations.forEach((function(t,i){var n=i.name,r=i.type,s=e.attributes.get(n);if(s){e.gl.bindBuffer(s.target,s.buffer),e.rendererState.boundBuffer=s.buffer;var o=1;r===e.gl.FLOAT_MAT2&&(o=2),r===e.gl.FLOAT_MAT3&&(o=3),r===e.gl.FLOAT_MAT4&&(o=4);for(var a=s.size/o,h=1===o?0:o*o*o,l=1===o?0:o*o,u=0;u<o;u++){var c=t+u;e.gl.vertexAttribPointer(c,a,s.type,s.normalized,s.stride+h,s.offset+l),e.gl.enableVertexAttribArray(c),e.renderer.vertexAttribDivisor(c,s.divisor)}}}));var i=this.attributes.get("index");i&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,i.buffer)},i.computeBoundingBox=function(t){var e=this.attributes.get("position"),i=e.data,n=e.offset,r=void 0===n?0:n,s=e.stride,o=e.size;(0,a.Z)(this,Nt)[Nt]||((0,a.Z)(this,Nt)[Nt]={min:new vt,max:new vt,center:new vt,scale:new vt,radius:Number.POSITIVE_INFINITY}),(0,a.Z)(this,Nt)[Nt].min.setScalar(+Number.POSITIVE_INFINITY),(0,a.Z)(this,Nt)[Nt].max.setScalar(Number.NEGATIVE_INFINITY);for(var h=t||i,l=s||o,u=r;u<h.length;u+=l){var c=h[u+0],d=h[u+1],f=h[u+2];(0,a.Z)(this,Nt)[Nt].min.x=Math.min(c,(0,a.Z)(this,Nt)[Nt].min.x),(0,a.Z)(this,Nt)[Nt].min.y=Math.min(d,(0,a.Z)(this,Nt)[Nt].min.y),(0,a.Z)(this,Nt)[Nt].min.z=Math.min(f,(0,a.Z)(this,Nt)[Nt].min.z),(0,a.Z)(this,Nt)[Nt].max.x=Math.max(c,(0,a.Z)(this,Nt)[Nt].max.x),(0,a.Z)(this,Nt)[Nt].max.y=Math.max(d,(0,a.Z)(this,Nt)[Nt].max.y),(0,a.Z)(this,Nt)[Nt].max.z=Math.max(f,(0,a.Z)(this,Nt)[Nt].max.z)}return(0,a.Z)(this,Nt)[Nt].scale.subVectors((0,a.Z)(this,Nt)[Nt].max,(0,a.Z)(this,Nt)[Nt].min),(0,a.Z)(this,Nt)[Nt].center.add((0,a.Z)(this,Nt)[Nt].min).add((0,a.Z)(this,Nt)[Nt].max).divideScalar(2),(0,a.Z)(this,Nt)[Nt]},i.computeBoundingSphere=function(t){var e=this.attributes.get("position"),i=e.data,n=e.offset,r=void 0===n?0:n,s=e.stride,o=e.size;(0,a.Z)(this,Nt)[Nt]||this.computeBoundingBox(t);for(var h=t||i,l=0,u=s||o,c=h.length,d=r;d<c;d+=u)Ft.fromArray(h,d),l=Math.max(l,(0,a.Z)(this,Nt)[Nt].center.distanceToSquared(Ft));(0,a.Z)(this,Nt)[Nt].radius=Math.sqrt(l)},i.draw=function(t,e){var i=this;void 0===e&&(e=this.drawMode);var n=this.drawRange,r=n.start,s=n.count,o=this.id+"_"+t.attributeOrder;this.rendererState.activeGeometryId!==o&&((0,a.Z)(this,Lt)[Lt].get(t.attributeOrder)||this.createVAO(t),this.renderer.bindVertexArray((0,a.Z)(this,Lt)[Lt].get(t.attributeOrder)),this.rendererState.activeGeometryId=o);if(t.attributeLocations.forEach((function(t,e){var n=e.name,r=i.getAttribute(n);r&&r.needsUpdate&&i.updateAttribute(r)})),this.isInstanced)if(this.index){var h=this.index.offset+2*r;this.renderer.drawElementsInstanced(e,s,this.index.type,h,this.instancedCount)}else this.renderer.drawArraysInstanced(e,r,s,this.instancedCount);else if(this.index){var l=this.index.offset+2*r;this.gl.drawElements(e,s,this.index.type,l)}else this.gl.drawArrays(e,r,s)},i.copy=function(t){var e=t.attributesData;for(var i in e){var n=e[i];if(n instanceof Rt)"index"===i?this.setIndex(n):this.addAttribute(i,n);else if(n.data){var r=new Rt(this.renderer,n);"index"===i?this.setIndex(r):this.addAttribute(i,r)}}return t.bounds&&(this.bounds={min:(new vt).copy(t.bounds.min),max:(new vt).copy(t.bounds.max),center:(new vt).copy(t.bounds.center),scale:(new vt).copy(t.bounds.scale),radius:t.bounds.radius}),this},i.clone=function(){var t=new e(this.renderer,{}).copy(this);return t.drawMode=this.drawMode,t},i.destroy=function(){var t=this;(0,a.Z)(this,Lt)[Lt].forEach((function(e){t.renderer.deleteVertexArray(e)})),(0,a.Z)(this,Lt)[Lt].clear(),(0,a.Z)(this,Pt)[Pt].forEach((function(e){t.gl.deleteBuffer(e.buffer)})),(0,a.Z)(this,Pt)[Pt].clear()},(0,o.Z)(e,[{key:"id",get:function(){return(0,a.Z)(this,Ot)[Ot]}},{key:"attributes",get:function(){return(0,a.Z)(this,Pt)[Pt]}},{key:"attributesData",get:function(){for(var t={},e=(0,a.Z)(this,Pt)[Pt].entries(),i=0;i<(0,a.Z)(this,Pt)[Pt].size;i++){var n=e.next().value;t[n[0]]=V(n[1],["id","buffer"])}return t}},{key:"index",get:function(){return this.attributes.get("index")}},{key:"bounds",get:function(){return(0,a.Z)(this,Nt)[Nt]},set:function(t){(0,a.Z)(this,Nt)[Nt]=t}}]),e}(Ct),Bt=(0,h.Z)("id"),kt=(0,h.Z)("lastMode"),Ut=(0,h.Z)("geometry"),Dt=(0,h.Z)("program"),Gt=(0,h.Z)("wireframe"),jt=(0,h.Z)("wireframeGeometry"),zt=function(t){function e(e,i){var n;void 0===i&&(i={}),(n=t.call(this)||this).gl=void 0,n.modelViewMatrix=void 0,n.normalMatrix=void 0,n.renderOrder=void 0,n.zDepth=void 0,n.frustumCulled=void 0,n.mode=void 0,n.renderer=void 0,Object.defineProperty((0,r.Z)(n),Bt,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),kt,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Ut,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Dt,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Gt,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),jt,{writable:!0,value:void 0});var s=Object.assign({},{mode:e.gl.TRIANGLES,frustumCulled:!0,renderOrder:0},i);return n.renderer=e,n.gl=n.renderer.gl,n.modelViewMatrix=new wt,n.normalMatrix=new yt,n.renderOrder=s.renderOrder,n.frustumCulled=s.frustumCulled,n.zDepth=0,(0,a.Z)((0,r.Z)(n),Bt)[Bt]=s.id||z("mesh"),(0,a.Z)((0,r.Z)(n),Ut)[Ut]=s.geometry,(0,a.Z)((0,r.Z)(n),Dt)[Dt]=s.program,(0,a.Z)((0,r.Z)(n),Gt)[Gt]=Boolean(s.wireframe),n.mode=s.mode,(0,a.Z)((0,r.Z)(n),kt)[kt]=s.mode,(0,a.Z)((0,r.Z)(n),Gt)[Gt]&&(n.mode=n.gl.LINES,n.updateWireframeGeometry((0,a.Z)((0,r.Z)(n),Gt)[Gt])),n}(0,s.Z)(e,t);var i=e.prototype;return i.draw=function(t){var e,i,n=this;void 0===t&&(t={});var r=t,s=r.camera,o=r.target,a={};s?(Object.assign(a,{projectionMatrix:s.projectionMatrix,cameraPosition:s.worldPosition,viewMatrix:s.viewMatrix}),this.modelViewMatrix.multiply(s.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix)):this.modelViewMatrix.copy(this.worldMatrix),Object.assign(a,{resolution:new dt((null==(e=this.renderer.state)||null==(e=e.viewport)?void 0:e.width)||1,(null==(i=this.renderer.state)||null==(i=i.viewport)?void 0:i.height)||1),modelMatrix:this.worldMatrix,modelViewMatrix:this.modelViewMatrix,normalMatrix:this.normalMatrix}),Object.keys(a).forEach((function(t){Object.hasOwn(n.program.uniforms,t)||(n.program.uniforms[t]={value:null}),n.program.uniforms[t].value=a[t]})),o&&o.bind(),this.program.use(),this.geometry.draw(this.program,this.mode),o&&o.unbind()},i.updateWireframeGeometry=function(t,e){if(void 0===e&&(e=!1),(0,a.Z)(this,Ut)[Ut]&&(e||!(0,a.Z)(this,jt)[jt])){var i,n;(0,a.Z)(this,jt)[jt]&&(0,a.Z)(this,jt)[jt].destroy();var r=null==(i=(0,a.Z)(this,Ut)[Ut].attributes.get("position"))?void 0:i.data,s=null==(n=(0,a.Z)(this,Ut)[Ut].index)?void 0:n.data,o=s?s.length:Math.floor(r.length/3),h=[];(0,a.Z)(this,Ut)[Ut].index?s&&y(r,h,o,s):y(r,h,o);var l=h.length>65536?new Uint32Array(h):new Uint16Array(h);(0,a.Z)(this,jt)[jt]=new It(this.renderer,Object.assign({},(0,a.Z)(this,Ut)[Ut].attributesData,{index:{data:l}}))}},i.updateGeometry=function(t,e){void 0===e&&(e=!0),e&&(0,a.Z)(this,Ut)[Ut]&&(0,a.Z)(this,Ut)[Ut].destroy(),(0,a.Z)(this,Ut)[Ut]=t,this.updateWireframeGeometry((0,a.Z)(this,Gt)[Gt],!0)},i.updateProgram=function(t,e){void 0===e&&(e=!0),e&&(0,a.Z)(this,Dt)[Dt]&&(0,a.Z)(this,Dt)[Dt].destroy(),(0,a.Z)(this,Dt)[Dt]=t},i.destroy=function(){this.program.destroy(),this.geometry.destroy()},i.clone=function(){return new e(this.gl,{geometry:this.geometry,program:this.program,frustumCulled:this.frustumCulled,mode:this.mode,renderOrder:this.renderOrder}).copy(this)},i.copy=function(e,i){return void 0===i&&(i=!0),t.prototype.copy.call(this,e,i),this.modelViewMatrix.copy(e.modelViewMatrix),this.normalMatrix.copy(e.normalMatrix),this.mode=e.mode,this.renderOrder=e.renderOrder,this.zDepth=e.zDepth,this},(0,o.Z)(e,[{key:"id",get:function(){return(0,a.Z)(this,Bt)[Bt]}},{key:"geometry",get:function(){return(0,a.Z)(this,Gt)[Gt]?(0,a.Z)(this,jt)[jt]:(0,a.Z)(this,Ut)[Ut]}},{key:"program",get:function(){return(0,a.Z)(this,Dt)[Dt]}},{key:"wireframe",get:function(){return(0,a.Z)(this,Gt)[Gt]},set:function(t){this.mode=t?this.gl.LINES:(0,a.Z)(this,kt)[kt],(0,a.Z)(this,Gt)[Gt]=t,this.updateWireframeGeometry((0,a.Z)(this,Gt)[Gt])}}]),e}(_t),Vt=function(t){function e(){return t.apply(this,arguments)||this}(0,s.Z)(e,t);var i=e.prototype;return i.clone=function(){return(new e).copy(this,!1)},i.copy=function(e,i){return t.prototype.copy.call(this,e,i),this.matrixAutoUpdate=e.matrixAutoUpdate,this},e}(_t),Wt=function(t){return t[t.NoBlending=0]="NoBlending",t[t.NormalBlending=1]="NormalBlending",t[t.AdditiveBlending=2]="AdditiveBlending",t[t.SubtractiveBlending=3]="SubtractiveBlending",t[t.MultiplyBlending=4]="MultiplyBlending",t[t.CustomBlending=5]="CustomBlending",t}(Wt||{}),Ht=(0,h.Z)("state"),qt=function(t){function e(e,i){var n;n=t.call(this,e)||this,Object.defineProperty((0,r.Z)(n),Ht,{writable:!0,value:void 0});var s=e.gl;return(0,a.Z)((0,r.Z)(n),Ht)[Ht]={viewport:{x:0,y:0,width:0,height:0}},n.apply(i||{frontFace:s.CCW,depthTest:!1,depthWrite:!0,depthMask:!0,depthFunc:s.LESS,blending:1,blendFunc:{src:s.ONE,dst:s.ZERO},blendEquation:{modeRGB:s.FUNC_ADD},premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,framebuffer:null,textureUnits:[],activeTextureUnit:-1,activeGeometryId:-1,currentProgramId:-1,clearAlpha:1,clearColor:new Tt(0),stencil:{func:{},opFront:{},opBack:{}}}),n}(0,s.Z)(e,t);var i=e.prototype;return i.apply=function(t){if(void 0!==t.blending&&null!==t.blending)this.setBlending(t.blending,t);else{if(t.blendFunc){var e=t.blendFunc,i=e.src,n=e.dst,r=e.srcAlpha,s=e.dstAlpha;this.setBlendFunc(i,n,r,s),this.enable(this.gl.BLEND)}else this.disable(this.gl.BLEND);if(t.blendEquation){var o=t.blendEquation,h=o.modeRGB,l=o.modeAlpha;this.setBlendEquation(h,l)}}I(t.cullFace)||D(t.cullFace)||this.setCullFace(t.cullFace),I(t.frontFace)||D(t.frontFace)||this.setFrontFace(t.frontFace),t.depthTest?this.enable(this.gl.DEPTH_TEST):this.disable(this.gl.DEPTH_TEST),I(t.depthMask)||D(t.depthMask)||this.setDepthMask(t.depthMask),I(t.depthWrite)||D(t.depthWrite)||this.setDepthMask(t.depthWrite),I(t.depthFunc)||D(t.depthFunc)||this.setDepthFunc(t.depthFunc),I(t.lineWidth)||D(t.lineWidth)||this.setLineWidth(t.lineWidth),(0,a.Z)(this,Ht)[Ht]=Object.assign((0,a.Z)(this,Ht)[Ht],t)},i.enable=function(t){!0!==(0,a.Z)(this,Ht)[Ht][t]&&(this.gl.enable(t),(0,a.Z)(this,Ht)[Ht][t]=!0)},i.disable=function(t){!1!==(0,a.Z)(this,Ht)[Ht][t]&&(this.gl.disable(t),(0,a.Z)(this,Ht)[Ht][t]=!1)},i.setViewport=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),(0,a.Z)(this,Ht)[Ht].viewport.width===t&&(0,a.Z)(this,Ht)[Ht].viewport.height===e||(this.gl.viewport(i,n,t,e),(0,a.Z)(this,Ht)[Ht].viewport={width:t,height:e,x:i,y:n})},i.setMask=function(t){(0,a.Z)(this,Ht)[Ht].colorMask!==t&&(this.gl.colorMask(t,t,t,t),(0,a.Z)(this,Ht)[Ht].colorMask=t)},i.setBlending=function(t,e){if((0,a.Z)(this,Ht)[Ht].blending=t,0!==t)if(this.enable(this.gl.BLEND),2===t)(0,a.Z)(this,Ht)[Ht].premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ONE,this.gl.ONE,this.gl.ONE,this.gl.ONE)):(this.setBlendEquation(this.gl.FUNC_ADD),this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE));else if(3===t)(0,a.Z)(this,Ht)[Ht].premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.ZERO,this.gl.ONE_MINUS_SRC_COLOR,this.gl.ONE_MINUS_SRC_ALPHA)):(this.setBlendEquation(this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_COLOR));else if(4===t)(0,a.Z)(this,Ht)[Ht].premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.SRC_COLOR,this.gl.ZERO,this.gl.SRC_ALPHA)):(this.setBlendEquation(this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.SRC_COLOR));else if(1===t)(0,a.Z)(this,Ht)[Ht].premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)):(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA));else if(5===t){if(null!=e&&e.blendFunc){var i=e.blendFunc,n=i.src,r=i.dst,s=i.srcAlpha,o=i.dstAlpha;this.setBlendFunc(n,r,s,o),this.enable(this.gl.BLEND)}if(null!=e&&e.blendEquation){var h=e.blendEquation,l=h.modeRGB,u=h.modeAlpha;this.setBlendEquation(l,u)}}else console.error("State: Invalid blending: ",t);else this.disable(this.gl.BLEND)},i.setBlendFunc=function(t,e,i,n){var r,s,o,h;t===(null==(r=(0,a.Z)(this,Ht)[Ht].blendFunc)?void 0:r.src)&&e===(null==(s=(0,a.Z)(this,Ht)[Ht].blendFunc)?void 0:s.dst)&&i===(null==(o=(0,a.Z)(this,Ht)[Ht].blendFunc)?void 0:o.srcAlpha)&&n===(null==(h=(0,a.Z)(this,Ht)[Ht].blendFunc)?void 0:h.dstAlpha)||((0,a.Z)(this,Ht)[Ht].blendFunc={src:t,dst:e,srcAlpha:i,dstAlpha:n},I(i)||D(i)||I(n)||D(n)?this.gl.blendFunc(t,e):this.gl.blendFuncSeparate(t,e,i,n))},i.setBlendEquation=function(t,e){var i,n;t===(null==(i=(0,a.Z)(this,Ht)[Ht].blendEquation)?void 0:i.modeRGB)&&e===(null==(n=(0,a.Z)(this,Ht)[Ht].blendEquation)?void 0:n.modeAlpha)||((0,a.Z)(this,Ht)[Ht].blendEquation={modeRGB:t,modeAlpha:e},I(e)||D(e)?this.gl.blendEquation(t):this.gl.blendEquationSeparate(t,e))},i.setClearAlpha=function(t){(0,a.Z)(this,Ht)[Ht].clearAlpha!==t&&((0,a.Z)(this,Ht)[Ht].clearAlpha=t)},i.setClearColor=function(t,e){(0,a.Z)(this,Ht)[Ht].clearAlpha===e&&(0,a.Z)(this,Ht)[Ht].clearColor===t||((0,a.Z)(this,Ht)[Ht].clearColor=t,I(e)||D(e)?(0,a.Z)(this,Ht)[Ht].clearAlpha=t.a:(0,a.Z)(this,Ht)[Ht].clearAlpha=e,this.gl.clearColor(t.r,t.g,t.b,(0,a.Z)(this,Ht)[Ht].clearAlpha))},i.setCullFace=function(t){(0,a.Z)(this,Ht)[Ht].cullFace!==t&&(t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),(0,a.Z)(this,Ht)[Ht].cullFace=t,this.gl.cullFace(t))},i.setFrontFace=function(t){(0,a.Z)(this,Ht)[Ht].frontFace!==t&&((0,a.Z)(this,Ht)[Ht].frontFace=t,this.gl.frontFace(t))},i.setDepthMask=function(t){(0,a.Z)(this,Ht)[Ht].depthMask!==t&&((0,a.Z)(this,Ht)[Ht].depthMask=t,this.gl.depthMask(t))},i.setDepthFunc=function(t){(0,a.Z)(this,Ht)[Ht].depthFunc!==t&&((0,a.Z)(this,Ht)[Ht].depthFunc=t,this.gl.depthFunc(t))},i.setDepthTest=function(t){(0,a.Z)(this,Ht)[Ht].depthTest!==t&&((0,a.Z)(this,Ht)[Ht].depthTest=t,t?this.enable(this.gl.DEPTH_TEST):this.disable(this.gl.DEPTH_TEST))},i.setStencilFunc=function(t,e,i,n){var r,s,o,h,l;(null==(r=(0,a.Z)(this,Ht)[Ht])||null==(r=r.stencil)||null==(r=r.func)?void 0:r.cmp)===t&&(null==(s=(0,a.Z)(this,Ht)[Ht])||null==(s=s.stencil)||null==(s=s.func)?void 0:s.ref)===e&&(null==(o=(0,a.Z)(this,Ht)[Ht])||null==(o=o.stencil)||null==(o=o.func)?void 0:o.mask)===i||(null!=(h=(0,a.Z)(this,Ht)[Ht])&&h.stencil||((0,a.Z)(this,Ht)[Ht].stencil={}),null!=(l=(0,a.Z)(this,Ht)[Ht])&&null!=(l=l.stencil)&&l.func||((0,a.Z)(this,Ht)[Ht].stencil.func={}),(0,a.Z)(this,Ht)[Ht].stencil.func={ref:e,mask:i,cmp:t},n?this.gl.stencilFuncSeparate(n,t,e,i):this.gl.stencilFunc(t,e,i))},i.setStencilOp=function(t,e,i,n){var r,s,o,h,l,u,c,d,f,m,p,v,g;return null!=(r=(0,a.Z)(this,Ht)[Ht])&&r.stencil||((0,a.Z)(this,Ht)[Ht].stencil={}),n&&n!==this.gl.FRONT_AND_BACK?n===this.gl.FRONT?(null==(d=(0,a.Z)(this,Ht)[Ht].stencil)||null==(d=d.opFront)?void 0:d.fail)!==t||(null==(f=(0,a.Z)(this,Ht)[Ht].stencil)||null==(f=f.opFront)?void 0:f.zFail)!==e||(null==(m=(0,a.Z)(this,Ht)[Ht].stencil)||null==(m=m.opFront)?void 0:m.zPass)!==i:n===this.gl.BACK?(null==(p=(0,a.Z)(this,Ht)[Ht].stencil)||null==(p=p.opBack)?void 0:p.fail)!==t||(null==(v=(0,a.Z)(this,Ht)[Ht].stencil)||null==(v=v.opBack)?void 0:v.zFail)!==e||(null==(g=(0,a.Z)(this,Ht)[Ht].stencil)||null==(g=g.opBack)?void 0:g.zPass)!==i:void 0:(null==(s=(0,a.Z)(this,Ht)[Ht].stencil)||null==(s=s.opFront)?void 0:s.fail)!==t||(null==(o=(0,a.Z)(this,Ht)[Ht].stencil)||null==(o=o.opFront)?void 0:o.zFail)!==e||(null==(h=(0,a.Z)(this,Ht)[Ht].stencil)||null==(h=h.opFront)?void 0:h.zPass)!==i||(null==(l=(0,a.Z)(this,Ht)[Ht].stencil)||null==(l=l.opBack)?void 0:l.fail)!==t||(null==(u=(0,a.Z)(this,Ht)[Ht].stencil)||null==(u=u.opBack)?void 0:u.zFail)!==e||(null==(c=(0,a.Z)(this,Ht)[Ht].stencil)||null==(c=c.opBack)?void 0:c.zPass)!==i},i.setStencilMask=function(t,e){var i;(null==(i=(0,a.Z)(this,Ht)[Ht].stencil)?void 0:i.mask)!==t&&((0,a.Z)(this,Ht)[Ht].stencil=Object.assign({},(0,a.Z)(this,Ht)[Ht].stencil,{mask:t}),e?this.gl.stencilMaskSeparate(e,t):this.gl.stencilMask(t))},i.setActiveTexture=function(t){(0,a.Z)(this,Ht)[Ht].activeTextureUnit!==t&&((0,a.Z)(this,Ht)[Ht].activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))},i.setLineWidth=function(t){(0,a.Z)(this,Ht)[Ht].lineWidth!==t&&((0,a.Z)(this,Ht)[Ht].lineWidth=t,this.gl.lineWidth(t))},i.setPolygonOffset=function(t,e,i){t?(this.enable(this.gl.POLYGON_OFFSET_FILL),(0,a.Z)(this,Ht)[Ht].polygonOffsetFactor===e&&(0,a.Z)(this,Ht)[Ht].polygonOffsetUnits===i||(this.gl.polygonOffset(e,i),(0,a.Z)(this,Ht)[Ht].polygonOffsetFactor=e,(0,a.Z)(this,Ht)[Ht].polygonOffsetUnits=i)):this.disable(this.gl.POLYGON_OFFSET_FILL)},i.bindFramebuffer=function(t){void 0===t&&(t={});var e=t,i=e.target,n=void 0===i?this.gl.FRAMEBUFFER:i,r=e.buffer,s=void 0===r?null:r;(0,a.Z)(this,Ht)[Ht].framebuffer!==s&&((0,a.Z)(this,Ht)[Ht].framebuffer=s,this.gl.bindFramebuffer(n,s))},i.setActiveGeometry=function(t){(0,a.Z)(this,Ht)[Ht].activeGeometryId=t},i.reset=function(t){var e=this;void 0===t&&(t=!0);var i=Object.keys((0,a.Z)(this,Ht)[Ht]);t?(i.filter((function(t){return["viewport","premultiplyAlpha"].indexOf(t)<0})).forEach((function(t){delete(0,a.Z)(e,Ht)[Ht][t]})),this.bindFramebuffer({buffer:null}),this.apply({frontFace:this.gl.CCW,depthTest:!1,depthWrite:!0,depthMask:!0,depthFunc:this.gl.LESS,blending:1,blendFunc:{src:this.gl.ONE,dst:this.gl.ZERO},blendEquation:{modeRGB:this.gl.FUNC_ADD},premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,framebuffer:null,textureUnits:[],activeTextureUnit:-1,activeGeometryId:-1,currentProgramId:-1,clearAlpha:1,clearColor:new Tt(0),stencil:{func:{},opFront:{},opBack:{}}})):(i.filter((function(t){return["flipY","framebuffer","textureUnits","activeTextureUnit","activeGeometryId","currentProgramId"].indexOf(t)>-1})).forEach((function(t){delete(0,a.Z)(e,Ht)[Ht][t]})),this.bindFramebuffer({buffer:null}),(0,a.Z)(this,Ht)[Ht].flipY=!1,(0,a.Z)(this,Ht)[Ht].activeGeometryId=-1,(0,a.Z)(this,Ht)[Ht].activeTextureUnit=-1,(0,a.Z)(this,Ht)[Ht].currentProgramId=-1,(0,a.Z)(this,Ht)[Ht].textureUnits=[],(0,a.Z)(this,Ht)[Ht].boundBuffer=null)},(0,o.Z)(e,[{key:"state",get:function(){return(0,a.Z)(this,Ht)[Ht]}},{key:"viewport",get:function(){return(0,a.Z)(this,Ht)[Ht].viewport}},{key:"textureUnits",get:function(){return(0,a.Z)(this,Ht)[Ht].textureUnits}},{key:"activeTextureUnit",get:function(){return(0,a.Z)(this,Ht)[Ht].activeTextureUnit},set:function(t){(0,a.Z)(this,Ht)[Ht].activeTextureUnit=t}},{key:"currentProgramId",get:function(){return(0,a.Z)(this,Ht)[Ht].currentProgramId},set:function(t){(0,a.Z)(this,Ht)[Ht].currentProgramId=t}},{key:"activeGeometryId",get:function(){return(0,a.Z)(this,Ht)[Ht].activeGeometryId},set:function(t){(0,a.Z)(this,Ht)[Ht].activeGeometryId=t}},{key:"flipY",get:function(){return(0,a.Z)(this,Ht)[Ht].flipY},set:function(t){(0,a.Z)(this,Ht)[Ht].flipY=t}},{key:"unpackAlignment",get:function(){return(0,a.Z)(this,Ht)[Ht].unpackAlignment},set:function(t){(0,a.Z)(this,Ht)[Ht].unpackAlignment=t}},{key:"premultiplyAlpha",get:function(){return(0,a.Z)(this,Ht)[Ht].premultiplyAlpha},set:function(t){(0,a.Z)(this,Ht)[Ht].premultiplyAlpha=t}},{key:"boundBuffer",get:function(){return(0,a.Z)(this,Ht)[Ht].boundBuffer},set:function(t){(0,a.Z)(this,Ht)[Ht].boundBuffer=t}},{key:"anisotropy",get:function(){return(0,a.Z)(this,Ht)[Ht].anisotropy},set:function(t){(0,a.Z)(this,Ht)[Ht].anisotropy=t}}]),e}(Ct),Xt=["WEBGL_depth_texture","OES_texture_half_float","OES_texture_float","OES_standard_derivatives","OES_element_index_uint","EXT_frag_depth","EXT_blend_minmax","EXT_shader_texture_lod","WEBGL_draw_buffers","WEBGL_color_buffer_float"],Yt=["EXT_color_buffer_float"],Kt=["WEBGL_lose_context","OES_texture_half_float_linear","OES_texture_float_linear","EXT_color_buffer_half_float","WEBGL_debug_renderer_info","EXT_texture_filter_anisotropic"],Jt=(0,h.Z)("gl"),$t=(0,h.Z)("state"),Qt=(0,h.Z)("extensions"),te=(0,h.Z)("autoClear"),ee=(0,h.Z)("depth"),ie=(0,h.Z)("alpha"),ne=(0,h.Z)("stencil"),re=(0,h.Z)("antialias"),se=(0,h.Z)("premultipliedAlpha"),oe=(0,h.Z)("preserveDrawingBuffer"),ae=(0,h.Z)("color"),he=(0,h.Z)("dpr"),le=(0,h.Z)("frustumCull"),ue=function(){function t(t,e){var i,n,r,s=this;void 0===e&&(e={}),Object.defineProperty(this,Jt,{writable:!0,value:void 0}),Object.defineProperty(this,$t,{writable:!0,value:void 0}),Object.defineProperty(this,Qt,{writable:!0,value:void 0}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,ee,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),Object.defineProperty(this,ae,{writable:!0,value:void 0}),Object.defineProperty(this,he,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:void 0}),this.vertexAttribDivisor=void 0,this.drawArraysInstanced=void 0,this.drawElementsInstanced=void 0,this.createVertexArray=void 0,this.bindVertexArray=void 0,this.deleteVertexArray=void 0,this.width=void 0,this.height=void 0;var o=Object.assign({},{autoClear:!0,depth:!0,alpha:!1,stencil:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,requestWebGl2:!0,extensions:[]},e);(0,a.Z)(this,te)[te]=Boolean(o.autoClear),(0,a.Z)(this,ee)[ee]=o.depth,(0,a.Z)(this,ie)[ie]=o.alpha,(0,a.Z)(this,ne)[ne]=o.stencil,(0,a.Z)(this,re)[re]=o.antialias,(0,a.Z)(this,se)[se]=o.premultipliedAlpha,(0,a.Z)(this,oe)[oe]=o.preserveDrawingBuffer,(0,a.Z)(this,Jt)[Jt]=R(t)||F(t)?t:O(t,{alpha:(0,a.Z)(this,ie)[ie],depth:(0,a.Z)(this,ee)[ee],stencil:(0,a.Z)(this,ne)[ne],antialias:(0,a.Z)(this,re)[re],powerPreference:o.powerPreference,premultipliedAlpha:(0,a.Z)(this,se)[se],preserveDrawingBuffer:(0,a.Z)(this,oe)[oe]},o.requestWebGl2);var h=null==(i=(0,a.Z)(this,Jt)[Jt])?void 0:i.getContextAttributes(),l=null==(n=(0,a.Z)(this,Jt)[Jt])?void 0:n.getParameter((0,a.Z)(this,Jt)[Jt].VIEWPORT),u=null==(r=(0,a.Z)(this,Jt)[Jt])?void 0:r.getParameter((0,a.Z)(this,Jt)[Jt].UNPACK_FLIP_Y_WEBGL);(0,a.Z)(this,$t)[$t]=new qt(this),h&&((0,a.Z)(this,ee)[ee]=Boolean(h.depth),(0,a.Z)(this,re)[re]=Boolean(h.antialias),(0,a.Z)(this,ie)[ie]=Boolean(h.alpha),(0,a.Z)(this,ne)[ne]=Boolean(h.stencil),(0,a.Z)(this,se)[se]=Boolean(h.premultipliedAlpha),(0,a.Z)(this,oe)[oe]=Boolean(h.preserveDrawingBuffer)),(0,a.Z)(this,$t)[$t].flipY=Boolean(u),(0,a.Z)(this,$t)[$t].setViewport(l[2],l[3],l[0],l[1]),(0,a.Z)(this,$t)[$t].premultiplyAlpha=(0,a.Z)(this,se)[se],(0,a.Z)(this,ae)[ae]=!0,(0,a.Z)(this,he)[he]=o.dpr||1,this.width=this.gl.canvas.width/(0,a.Z)(this,he)[he],this.height=this.gl.canvas.height/(0,a.Z)(this,he)[he],(0,a.Z)(this,le)[le]=!!o.frustumCull,(0,a.Z)(this,Qt)[Qt]={},this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),o.extensions&&(o.extensions.filter((function(t){return Xt.findIndex((function(e){return e===t}))>-1})).forEach((function(t){(0,a.Z)(s,Qt)[Qt][t]||s.isWebGL2||((0,a.Z)(s,Qt)[Qt][t]=s.gl.getExtension(t))})),o.extensions.filter((function(t){return Yt.findIndex((function(e){return e===t}))>-1})).forEach((function(t){!(0,a.Z)(s,Qt)[Qt][t]&&s.isWebGL2&&((0,a.Z)(s,Qt)[Qt][t]=s.gl.getExtension(t))})),o.extensions.filter((function(t){return Kt.findIndex((function(e){return e===t}))>-1})).forEach((function(t){(0,a.Z)(s,Qt)[Qt][t]||((0,a.Z)(s,Qt)[Qt][t]=s.gl.getExtension(t))})))}var e=t.prototype;return e.extension=function(t){return(0,a.Z)(this,Qt)[Qt][t]},e.setSize=function(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*(0,a.Z)(this,he)[he],this.gl.canvas.height=e*(0,a.Z)(this,he)[he]},e.setViewport=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),(0,a.Z)(this,$t)[$t].setViewport(t,e,i,n)},e.getExtension=function(t,e,i){var n=this.gl[e];if(e&&n)return n.bind(this.gl);(0,a.Z)(this,Qt)[Qt][t]||((0,a.Z)(this,Qt)[Qt][t]=this.gl.getExtension(t));var r=(0,a.Z)(this,Qt)[Qt][t];return e?r?r[i].bind(r):null:r},e.getRenderList=function(t){var e=this,i=t.scene,n=t.camera,r=[];return i.traverse((function(t){if(!t.visible)return!0;t.draw&&((0,a.Z)(e,le)[le]&&t.frustumCulled&&n&&!n.frustumIntersectsMesh(t)||r.push(t))})),r},e.render=function(t){var e=t.scene,i=t.camera,n=t.target,r=void 0===n?null:n,s=t.update,o=void 0===s||s,h=t.clear;null===r?((0,a.Z)(this,$t)[$t].bindFramebuffer({buffer:null}),this.setViewport(this.width*(0,a.Z)(this,he)[he],this.height*(0,a.Z)(this,he)[he])):(r.bind(),this.setViewport(r.width,r.height)),(h||(0,a.Z)(this,te)[te]&&!1!==h)&&(!(0,a.Z)(this,ee)[ee]||r&&!r.depth||((0,a.Z)(this,$t)[$t].enable(this.gl.DEPTH_TEST),(0,a.Z)(this,$t)[$t].setDepthMask(!0)),this.clear((0,a.Z)(this,ae)[ae],(0,a.Z)(this,ee)[ee],(0,a.Z)(this,ne)[ne])),o&&e.updateMatrixWorld(),i&&i.updateMatrixWorld();for(var l=this.getRenderList({scene:e,camera:i}),u=0,c=l.length;u<c;u++){l[u].draw({camera:i})}r&&r.unbind()},e.clear=function(t,e,i){void 0===t&&(t=(0,a.Z)(this,ae)[ae]),void 0===e&&(e=(0,a.Z)(this,ee)[ee]),void 0===i&&(i=(0,a.Z)(this,ne)[ne]);var n=0;t&&(n|=this.gl.COLOR_BUFFER_BIT),e&&(n|=this.gl.DEPTH_BUFFER_BIT),i&&(n|=this.gl.STENCIL_BUFFER_BIT),this.gl.clear(n)},e.resetState=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=null),(0,a.Z)(this,$t)[$t].reset(t),this.bindVertexArray(e)},(0,o.Z)(t,[{key:"gl",get:function(){return(0,a.Z)(this,Jt)[Jt]}},{key:"attributes",get:function(){return{dpr:(0,a.Z)(this,he)[he],flipY:(0,a.Z)(this,$t)[$t].flipY,depth:(0,a.Z)(this,ee)[ee],color:(0,a.Z)(this,ae)[ae],antialias:(0,a.Z)(this,re)[re],alpha:(0,a.Z)(this,ie)[ie],stencil:(0,a.Z)(this,ne)[ne],autoClear:(0,a.Z)(this,te)[te],frustumCull:(0,a.Z)(this,le)[le],premultipliedAlpha:(0,a.Z)(this,se)[se],preserveDrawingBuffer:(0,a.Z)(this,oe)[oe]}}},{key:"canvas",get:function(){return(0,a.Z)(this,Jt)[Jt].canvas}},{key:"isWebGL",get:function(){return R(this.gl)}},{key:"isWebGL2",get:function(){return F(this.gl)}},{key:"extensions",get:function(){return(0,a.Z)(this,Qt)[Qt]}},{key:"size",get:function(){return{width:"clientWidth"in this.canvas?this.canvas.clientWidth:this.canvas.width,height:"clientHeight"in this.canvas?this.canvas.clientHeight:this.canvas.height}}},{key:"state",get:function(){return(0,a.Z)(this,$t)[$t]}},{key:"premultipliedAlpha",get:function(){return(0,a.Z)(this,se)[se]}}]),t}(),ce="Resource subclass must define virtual methods",de=(0,h.Z)("handle"),fe=(0,h.Z)("lastHandle"),me=function(t){function e(e,i){var n,s,o,h,l;return void 0===i&&(i={}),l=t.call(this,e)||this,Object.defineProperty((0,r.Z)(l),de,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(l),fe,{writable:!0,value:void 0}),l.id=void 0,l.name=void 0,l.userData=void 0,l.byteLength=void 0,l.options=void 0,l.id=(null==(n=i)?void 0:n.id)||z(l.constructor.name),l.name=null==(s=i)?void 0:s.name,l.userData=null==(o=i)?void 0:o.userData,(0,a.Z)((0,r.Z)(l),de)[de]=null==(h=i)?void 0:h.handle,l.options=i,void 0===(0,a.Z)((0,r.Z)(l),de)[de]&&((0,a.Z)((0,r.Z)(l),de)[de]=l.createHandle()),l.byteLength=0,l}(0,s.Z)(e,t);var i=e.prototype;return i.swapHandle=function(t){(0,a.Z)(this,fe)[fe]=(0,a.Z)(this,de)[de],(0,a.Z)(this,de)[de]=t},i.restoreHandle=function(){(0,a.Z)(this,de)[de]=(0,a.Z)(this,fe)[fe]},i.destroy=function(){this.delete()},i.delete=function(t){var e=(void 0===t?{}:t).deleteChildren,i=void 0!==e&&e,n=this.handle&&this.deleteHandle(this.handle);return this.handle&&this.removeStats(),(0,a.Z)(this,de)[de]=null,n&&i&&n.filter(Boolean).forEach((function(t){return t.delete()})),this},i.bind=function(t){throw void 0===t&&(t=this.handle),new Error(ce)},i.unbind=function(){this.bind(null)},i.removeStats=function(){throw new Error(ce)},i.createHandle=function(){throw new Error(ce)},i.deleteHandle=function(){throw new Error(ce)},i.toString=function(){return this.constructor.name+"("+this.id+")"},(0,o.Z)(e,[{key:"handle",get:function(){return(0,a.Z)(this,de)[de]}}]),e}(Ct),pe=(0,h.Z)("internalFormat"),ve=function(t){function e(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,e,Object.assign({},i,{format:i.format||e.gl.DEPTH_COMPONENT16}))||this).width=void 0,n.height=void 0,Object.defineProperty((0,r.Z)(n),pe,{writable:!0,value:void 0}),(0,a.Z)((0,r.Z)(n),pe)[pe]=n.options.format,n.width=n.options.width,n.height=n.options.height,console.assert(n.width>0&&n.height>0,"Renderbuffer object requires valid width and height greater than zero"),n.bind(),e.gl.renderbufferStorage(e.gl.RENDERBUFFER,(0,a.Z)((0,r.Z)(n),pe)[pe],n.width,n.height),n}(0,s.Z)(e,t);var i=e.prototype;return i.resize=function(t,e){t===this.width&&e===this.height||(this.width=t,this.height=e,this.bind(),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,(0,a.Z)(this,pe)[pe],t,e),this.unbind())},i.bind=function(){this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.handle)},i.unbind=function(){this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)},i.removeStats=function(){},i.destroy=function(){this.unbind(),this.deleteHandle()},i.createHandle=function(){return this.gl.createRenderbuffer()},i.deleteHandle=function(){this.handle&&this.gl.deleteRenderbuffer(this.handle)},e}(me),ge=new Uint8Array(4),be=(0,h.Z)("state"),ye=function(t){function e(e,i,n){var s;void 0===i&&(i={}),void 0===n&&(n=!0);var o=e.gl,h={target:o.TEXTURE_2D,type:o.UNSIGNED_BYTE,format:o.RGBA,internalFormat:i.format||o.RGBA,wrapS:o.CLAMP_TO_EDGE,wrapT:o.CLAMP_TO_EDGE,generateMipmaps:!0,minFilter:o.LINEAR,magFilter:o.LINEAR,premultiplyAlpha:!1,unpackAlignment:4,anisotropy:0,flipY:!1,level:0},l=Object.assign({},h,i);return(s=t.call(this,e,l)||this).needsUpdate=!1,s.textureUnit=0,s.image=void 0,s.width=void 0,s.height=void 0,s.target=void 0,Object.defineProperty((0,r.Z)(s),be,{writable:!0,value:{}}),s.textureUnit=0,s.image=s.options.image,s.width=s.options.width,s.height=s.options.height,s.target=s.options.target,(0,a.Z)((0,r.Z)(s),be)[be].version=-1,s.needsUpdate=Boolean(n),s.needsUpdate&&s.update(),s}(0,s.Z)(e,t);var i=e.prototype;return i.setData=function(t,e,i){void 0===e&&(e=this.width),void 0===i&&(i=this.height),this.image=t,this.width=e,this.height=i,this.needsUpdate=!0},i.setOptions=function(t){this.options=Object.assign(this.options,t),this.width=this.options.width,this.height=this.options.height,this.needsUpdate=!0},i.fromSrc=function(t){var e=this;return new Promise((function(i,n){var r=new Image;r.onload=function(){e.setData(r,r.width,r.height),i(e)},r.onerror=function(t){n(t)},r.crossOrigin="*",r.src=t}))},i.update=function(t){void 0===t&&(t=0);var e=!(this.image===(0,a.Z)(this,be)[be].image&&!this.needsUpdate);if((e||this.rendererState.textureUnits[t]!==this.id||this.rendererState.activeTextureUnit!==t)&&(this.rendererState.setActiveTexture(t),this.bind(t)),e){if(this.needsUpdate=!1,this.options.wrapS!==(0,a.Z)(this,be)[be].wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.options.wrapS),(0,a.Z)(this,be)[be].wrapS=this.options.wrapS),this.options.wrapT!==(0,a.Z)(this,be)[be].wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.options.wrapT),(0,a.Z)(this,be)[be].wrapT=this.options.wrapT),this.options.minFilter!==(0,a.Z)(this,be)[be].minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.options.minFilter),(0,a.Z)(this,be)[be].minFilter=this.options.minFilter),this.options.magFilter!==(0,a.Z)(this,be)[be].magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.options.magFilter),(0,a.Z)(this,be)[be].magFilter=this.options.magFilter),this.options.flipY!==this.rendererState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.options.flipY),this.rendererState.flipY=this.options.flipY),this.options.premultiplyAlpha!==this.rendererState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),this.rendererState.premultiplyAlpha=this.options.premultiplyAlpha),this.options.unpackAlignment!==this.rendererState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.options.unpackAlignment),this.rendererState.unpackAlignment=this.options.unpackAlignment),this.options.anisotropy&&this.options.anisotropy!==this.rendererState.anisotropy){var i=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(i){var n=this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT),r=this.options.anisotropy;this.options.anisotropy>n&&(r=n,console.warn("[Texture]: Texture.anisotropy option exceeded the maximum allowed value "+n+" of the device")),this.gl.texParameterf(this.target,i.TEXTURE_MAX_ANISOTROPY_EXT,r)}this.rendererState.anisotropy=this.options.anisotropy}this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.renderer.isWebGL2&&k(this.options.offset)?this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,this.image,this.options.offset):ArrayBuffer.isView(this.image)?this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,this.image):this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.options.format,this.options.type,this.image),this.options.generateMipmaps&&(this.renderer.isWebGL2||T(this.image.width)&&T(this.image.height)?this.gl.generateMipmap(this.target):(this.options.generateMipmaps=!1,this.options.wrapS=this.gl.CLAMP_TO_EDGE,this.options.wrapT=this.options.wrapS,this.options.minFilter=this.gl.LINEAR))):this.renderer.isWebGL2&&k(this.options.offset)?this.width>0?this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,this.options.offset):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,ge,this.options.offset):this.width>0?this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,ge),(0,a.Z)(this,be)[be].image=this.image,(0,a.Z)(this,be)[be].version+=1}},i.bind=function(t){void 0===t&&(t=this.textureUnit),this.rendererState.textureUnits[this.rendererState.activeTextureUnit]!==this.id&&(this.textureUnit=t,this.rendererState.textureUnits[this.textureUnit]=this.id,this.gl.bindTexture(this.target,this.handle))},i.unbind=function(){this.gl.activeTexture(this.gl.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,null),delete this.rendererState.textureUnits[this.textureUnit]},i.destroy=function(){this.unbind(),t.prototype.destroy.call(this)},i.removeStats=function(){(0,a.Z)(this,be)[be]={version:-1}},i.createHandle=function(){return this.gl.createTexture()},i.deleteHandle=function(){this.handle&&this.gl.deleteTexture(this.handle)},i.toString=function(){return"Texture("+this.id+","+this.width+"x"+this.height+")"},e}(me),xe=function(t){function e(e,i){var n;return void 0===i&&(i={}),(n=t.call(this,e,Object.assign({},i,{image:i.data,premultiplyAlpha:!0,flipY:!1,unpackAlignment:1}))||this).needsUpdate=!0,n}return(0,s.Z)(e,t),e}(ye),we=(0,h.Z)("textures"),Ze=(0,h.Z)("renderBuffers"),Ee=(0,h.Z)("clearColors"),Ae=(0,h.Z)("clearDepth"),Me=(0,h.Z)("clearStencil"),Te=function(t){function e(e,i){var n;void 0===i&&(i={}),n=t.call(this,e,Object.assign({color:1,depth:!0,depthTexture:!1,stencil:!1},i))||this,Object.defineProperty((0,r.Z)(n),we,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Ze,{writable:!0,value:void 0}),n.depth=void 0,n.width=void 0,n.height=void 0,n.viewport=void 0,n.drawBuffersChanged=void 0,n.drawBuffers=void 0,Object.defineProperty((0,r.Z)(n),Ee,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Ae,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Me,{writable:!0,value:void 0}),(0,a.Z)((0,r.Z)(n),Ze)[Ze]=new Map,(0,a.Z)((0,r.Z)(n),we)[we]=new Map,n.depth=Boolean(i.depth),n.drawBuffers=[],n.drawBuffersChanged=!1,n.width=n.options.width,n.height=n.options.height,n.viewport=new gt(0,0,n.width,n.height),n.name=n.options.name;var s=n.options.attachments||[];if(0===s.length){for(var o=0;o<n.options.color;o++){var h=Object.assign({wrapS:n.gl.CLAMP_TO_EDGE,wrapT:n.gl.CLAMP_TO_EDGE,minFilter:n.gl.LINEAR,magFilter:n.gl.LINEAR,type:n.gl.UNSIGNED_BYTE,format:n.gl.RGBA,flipY:!1,generateMipmaps:!1},i),l=void 0;l=h.data?new xe(e,h):new ye(e,V(h,["data","name","attachments","depthTexture"])),s.push([n.gl.COLOR_ATTACHMENT0+o,l])}if(i.depthTexture&&(e.isWebGL2||!e.isWebGL2&&e.gl.getExtension("WEBGL_depth_texture"))){var u=new ye(e,{width:n.width,height:n.height,minFilter:n.gl.NEAREST,magFilter:n.gl.NEAREST,format:n.gl.DEPTH_COMPONENT,internalFormat:e.isWebGL2?n.gl.DEPTH_COMPONENT16:n.gl.DEPTH_COMPONENT,type:n.gl.UNSIGNED_INT});s.push([n.gl.DEPTH_ATTACHMENT,u])}else{var c=i,d=c.depth,f=c.stencil;if(d&&!f){var m=new ve(e,{format:n.gl.DEPTH_COMPONENT16,width:n.width,height:n.height});s.push([n.gl.DEPTH_ATTACHMENT,m])}else if(f&&!d){var p=new ve(e,{format:n.gl.STENCIL_INDEX8,width:n.width,height:n.height});s.push([n.gl.STENCIL_ATTACHMENT,p])}else if(d&&f){var v=new ve(e,{format:n.gl.DEPTH_STENCIL,width:n.width,height:n.height});s.push([n.gl.DEPTH_STENCIL_ATTACHMENT,v])}}}return n.create(s),n}(0,s.Z)(e,t);var i=e.prototype;return i.create=function(t){var e=this;(0,a.Z)(this,Ee)[Ee]=[],(0,a.Z)(this,Ae)[Ae]=1,(0,a.Z)(this,Me)[Me]=0;for(var i,r=(0,n.Z)(t);!(i=r()).done;){var s=i.value,o=s[0],h=s[1];h instanceof ve?(0,a.Z)(this,Ze)[Ze].set(o,h):h instanceof ye&&((0,a.Z)(this,we)[we].set(o,h),this.drawBuffers.push(o));var l=o-this.gl.COLOR_ATTACHMENT0;(0,a.Z)(this,Ee)[Ee][l]=[0,0,0,0]}if(this.options.color>1)if(this.renderer.isWebGL2)this.gl.drawBuffers(this.drawBuffers);else{var u=this.renderer.extension("WEBGL_draw_buffers");if(!u||!u.drawBuffersWEBGL)throw new Error("Please open the corresponding extension [WEBGL_draw_buffers](https://developer.mozilla.org/en-US/docs/Web/API/WEBGL_draw_buffers#browser_compatibility) and check whether the browser supports it");u.drawBuffersWEBGL(this.drawBuffers)}this.drawBuffersChanged=!0,this.bind(),(0,a.Z)(this,Ze)[Ze].forEach((function(t,i){e.gl.framebufferRenderbuffer(e.gl.FRAMEBUFFER,i,e.gl.RENDERBUFFER,t.handle)})),(0,a.Z)(this,we)[we].forEach((function(t,i){e.gl.framebufferTexture2D(e.gl.FRAMEBUFFER,i,e.gl.TEXTURE_2D,t.handle,0)})),this.unbind();var c=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(c!==this.gl.FRAMEBUFFER_COMPLETE)switch(c){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case this.gl.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}return this.handle},i.clear=function(){this.bind();var t=0;if(this.clearColors[0]){var e=this.clearColors[0];this.gl.clearColor(e[0],e[1],e[2],e[3]),t|=this.gl.COLOR_BUFFER_BIT}k((0,a.Z)(this,Ae)[Ae])&&(this.gl.clearDepth((0,a.Z)(this,Ae)[Ae]),t|=this.gl.DEPTH_BUFFER_BIT),k((0,a.Z)(this,Me)[Me])&&(this.gl.clearStencil((0,a.Z)(this,Me)[Me]),t|=this.gl.STENCIL_BUFFER_BIT),this.gl.clear(t),this.unbind()},i.getTexture=function(t){return(0,a.Z)(this,we)[we].get(t)},i.resize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,(0,a.Z)(this,we)[we].forEach((function(i){i.width===t&&i.height===e||(i.width=t,i.height=e,i.needsUpdate=!0,i.update())})),(0,a.Z)(this,Ze)[Ze].forEach((function(i){i.resize(t,e)})),this.viewport.set(0,0,t,e))},i.bind=function(t){void 0===t&&(t=this.gl.FRAMEBUFFER),this.gl.bindFramebuffer(t,this.handle)},i.unbind=function(t){void 0===t&&(t=this.gl.FRAMEBUFFER),this.gl.bindFramebuffer(t,null)},i.removeStats=function(){},i.destroy=function(){(0,a.Z)(this,we)[we].forEach((function(t){t.destroy()})),(0,a.Z)(this,Ze)[Ze].forEach((function(t){t.destroy()})),this.deleteHandle()},i.createHandle=function(){return this.gl.createFramebuffer()},i.deleteHandle=function(){this.handle&&this.gl.deleteFramebuffer(this.handle)},i.toString=function(){return"RenderTarget("+this.id+","+this.width+"x"+this.height+")"},(0,o.Z)(e,[{key:"texture",get:function(){return(0,a.Z)(this,we)[we].values().next().value}},{key:"clearColors",get:function(){return(0,a.Z)(this,Ee)[Ee]},set:function(t){(0,a.Z)(this,Ee)[Ee]=t}},{key:"clearDepth",get:function(){return(0,a.Z)(this,Ae)[Ae]},set:function(t){(0,a.Z)(this,Ae)[Ae]=t}},{key:"clearStencil",get:function(){return(0,a.Z)(this,Me)[Me]},set:function(t){(0,a.Z)(this,Me)[Me]=t}}]),e}(me);function Se(t,e,i,n,r,s,o,a,h,l,u,c,d,f,m,p){void 0===r&&(r=1),void 0===s&&(s=1),void 0===o&&(o=0),void 0===a&&(a=1),void 0===h&&(h=1),void 0===l&&(l=0),void 0===u&&(u=1),void 0===c&&(c=2),void 0===d&&(d=1),void 0===f&&(f=-1),void 0===m&&(m=0),void 0===p&&(p=0);for(var v=m,g=r/2,b=s/2,y=o/2,x=Math.floor(a),w=Math.floor(h),Z=x+1,E=w+1,A=r/x,M=s/w,T=0;T<E;T++)for(var S=T*M-b,_=0;_<Z;_++)if(t[3*m+l]=(_*A-g)*d,t[3*m+u]=S*f,t[3*m+c]=y,e[3*m+l]=0,e[3*m+u]=0,e[3*m+c]=o>=0?1:-1,i[2*m]=_/x,i[2*m+1]=1-T/w,m++,T!==w&&_!==x){var C=v+_+Z*T,R=v+_+Z*(T+1),F=v+_+1+Z*(T+1),O=v+_+1+Z*T;n[6*p]=C,n[6*p+1]=R,n[6*p+2]=O,n[6*p+3]=R,n[6*p+4]=F,n[6*p+5]=O,p++}}var _e=function(t){function e(e,i){var n=void 0===i?{}:i,r=n.width,s=void 0===r?1:r,o=n.height,a=void 0===o?1:o,h=n.widthSegments,l=void 0===h?1:h,u=n.heightSegments,c=void 0===u?1:u,d=n.attributes,f=void 0===d?{}:d,m=Math.floor(l),p=Math.floor(c),v=(m+1)*(p+1),g=m*p*6,b=new Float32Array(3*v),y=new Float32Array(3*v),x=new Float32Array(2*v),w=v>65536?new Uint32Array(g):new Uint16Array(g);return Se(b,y,x,w,s,a,0,l,c),t.call(this,e,Object.assign({},f,{position:{size:3,data:b},normal:{size:3,data:y},uv:{size:2,data:x},index:{data:w}}))||this}return(0,s.Z)(e,t),e}(It),Ce=function(t){function e(e,i){var n=void 0===i?{}:i,r=n.width,s=void 0===r?1:r,o=n.height,a=void 0===o?1:o,h=n.depth,l=void 0===h?1:h,u=n.widthSegments,c=void 0===u?1:u,d=n.heightSegments,f=void 0===d?1:d,m=n.depthSegments,p=void 0===m?1:m,v=n.attributes,g=void 0===v?{}:v,b=Math.floor(c),y=Math.floor(f),x=Math.floor(p),w=b+1,Z=y+1,E=x+1,A=w*Z*2+w*E*2+Z*E*2,M=6*(b*y*2+b*x*2+y*x*2),T=new Float32Array(3*A),S=new Float32Array(3*A),_=new Float32Array(2*A),C=A>65536?new Uint32Array(M):new Uint16Array(M),R=0,F=0,O=E*Z,P=w*E,L=w*Z,N=x*y,I=b*x,B=b*y;return Se(T,S,_,C,l,a,s,p,f,2,1,0,-1,-1,R,F),Se(T,S,_,C,l,a,-s,p,f,2,1,0,1,-1,R+=O,F+=N),Se(T,S,_,C,s,l,a,p,c,0,2,1,1,1,R+=O,F+=N),Se(T,S,_,C,s,l,-a,p,c,0,2,1,1,-1,R+=P,F+=I),Se(T,S,_,C,s,a,-l,c,f,0,1,2,-1,-1,R+=P,F+=I),Se(T,S,_,C,s,a,l,c,f,0,1,2,1,-1,R+=L,F+=B),t.call(this,e,Object.assign({},g,{position:{size:3,data:T},normal:{size:3,data:S},uv:{size:2,data:_},index:{data:C}}))||this}return(0,s.Z)(e,t),e}(It),Re={};function Fe(t){void 0===t&&(t="id"),Re[t]=Re[t]||1;var e=Re[t];return Re[t]+=1,"".concat(t,"-").concat(e)}var Oe=function(t,e){switch(e){case t.VERTEX_SHADER:return"vertex-shader";case t.FRAGMENT_SHADER:return"fragment-shader";default:return"unknown"}};var Pe=(0,h.Z)("shaderType"),Le=(0,h.Z)("includes"),Ne=function(t){function e(e,i,n,s){var o;void 0===s&&(s={});var h=function(t,e){switch(e){case"fragment":return t.FRAGMENT_SHADER;case"vertex":return t.VERTEX_SHADER;default:return}}(e.gl,n);return o=t.call(this,e,{name:b(i)||Fe(Oe(e,h))})||this,Object.defineProperty((0,r.Z)(o),Pe,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(o),Le,{writable:!0,value:void 0}),o.sourceCode=void 0,console.assert("string"==typeof i,"Shader: GLSL source code must be a JavaScript string"),(0,a.Z)((0,r.Z)(o),Le)[Le]=s,(0,a.Z)((0,r.Z)(o),Pe)[Pe]=h,o.sourceCode=o.injectShaderModule(i,s||{}).replace(/\n\n+/gm,"\n\n"),o.createShader(o.sourceCode),o}(0,s.Z)(e,t);var i=e.prototype;return i.injectShaderModule=function(t,e){var i=this;void 0===e&&(e={});return t.replace(/^[\t ]*#glsl_include +<([\w.]+)>/gm,(function(t,n){var r=e[n];if(void 0===r)throw new Error("Cannot resolve #include <".concat(n,">"));return r=r.replace(/#include </g,"#glsl_include <"),i.injectShaderModule(r,e)}))},i.createShader=function(t){void 0===t&&(t=this.source);var e=t.replace(/#include </g,"#glsl_include <");if(e=this.injectShaderModule(e,(0,a.Z)(this,Le)[Le]||{}).replace(/\n\n+/gm,"\n\n"),this.gl.shaderSource(this.handle,e),this.gl.compileShader(this.handle),!this.gl.getShaderParameter(this.handle,this.gl.COMPILE_STATUS)){var i=this.gl.getShaderInfoLog(this.handle)||"";throw this.gl.deleteShader(this.handle),new Error(this.toString()+"\n"+i+"\n"+function(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}(e))}},i.getSource=function(){return this.gl.getShaderSource(this.handle)},i.setSource=function(t){var e=b(t);e&&(this.name=Fe(e)),this.createShader(t)},i.removeStats=function(){},i.deleteHandle=function(){this.gl.deleteShader(this.handle)},i.toString=function(){return Oe(this.gl,this.shaderType)+":"+this.id},(0,o.Z)(e,[{key:"source",get:function(){return this.sourceCode}},{key:"shaderType",get:function(){return(0,a.Z)(this,Pe)[Pe]}}]),e}(me),Ie=function(t){function e(e,i,n){return t.call(this,e,i,"vertex",n)||this}return(0,s.Z)(e,t),e.prototype.createHandle=function(){return this.gl.createShader(this.gl.VERTEX_SHADER)},e}(Ne),Be=function(t){function e(e,i,n){return t.call(this,e,i,"fragment",n)||this}return(0,s.Z)(e,t),e.prototype.createHandle=function(){return this.gl.createShader(this.gl.FRAGMENT_SHADER)},e}(Ne),ke={};function Ue(t,e,i,n){var r=(n=n.length?function(t){var e=t.length,i=t[0].length;if(void 0===i)return t;var n=e*i,r=ke[n];r||(ke[n]=r=new Float32Array(n));for(var s=0;s<e;s++)r.set(t[s],s*i);return r}(n):n).length;switch(e){case WebGLRenderingContext.FLOAT:return r?t.uniform1fv(i,n):t.uniform1f(i,n);case WebGLRenderingContext.FLOAT_VEC2:return t.uniform2fv(i,n);case WebGLRenderingContext.FLOAT_VEC3:return t.uniform3fv(i,n);case WebGLRenderingContext.FLOAT_VEC4:return t.uniform4fv(i,n);case WebGLRenderingContext.BOOL:case WebGLRenderingContext.INT:case WebGLRenderingContext.SAMPLER_2D:case WebGLRenderingContext.SAMPLER_CUBE:return r?t.uniform1iv(i,n):t.uniform1i(i,n);case WebGLRenderingContext.BOOL_VEC2:case WebGLRenderingContext.INT_VEC2:return t.uniform2iv(i,n);case WebGLRenderingContext.BOOL_VEC3:case WebGLRenderingContext.INT_VEC3:return t.uniform3iv(i,n);case WebGLRenderingContext.BOOL_VEC4:case WebGLRenderingContext.INT_VEC4:return t.uniform4iv(i,n);case WebGLRenderingContext.FLOAT_MAT2:return t.uniformMatrix2fv(i,!1,n);case WebGLRenderingContext.FLOAT_MAT3:return t.uniformMatrix3fv(i,!1,n);case WebGLRenderingContext.FLOAT_MAT4:return t.uniformMatrix4fv(i,!1,n)}}var De=(0,h.Z)("uniformLocations"),Ge=(0,h.Z)("attributeLocations"),je=(0,h.Z)("vs"),ze=(0,h.Z)("fs"),Ve=(0,h.Z)("renderState"),We=(0,h.Z)("assignUniforms"),He=(0,h.Z)("assignAttributes"),qe=function(t){function e(e,i){var n;void 0===i&&(i={}),n=t.call(this,e,i)||this,Object.defineProperty((0,r.Z)(n),He,{value:Ye}),Object.defineProperty((0,r.Z)(n),We,{value:Xe}),n.attributeOrder=void 0,n.uniforms=void 0,Object.defineProperty((0,r.Z)(n),De,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Ge,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),je,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),ze,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(n),Ve,{writable:!0,value:void 0});var s=i,o=s.id,h=s.vertexShader,l=s.fragmentShader,u=s.uniforms,c=void 0===u?{}:u,d=s.transparent,f=void 0!==d&&d,m=s.defines,p=void 0===m?[]:m,v=s.includes,b=void 0===v?{}:v,y=s.cullFace,x=s.frontFace,w=void 0===x?e.gl.CCW:x,Z=s.depthTest,E=void 0===Z||Z,A=s.depthWrite,M=void 0===A||A,T=s.depthFunc,S=void 0===T?e.gl.LESS:T,_=s.blending,C=void 0===_?1:_,R=s.blendFunc,F=s.blendEquation;n.id=o||z("program");var O=[].concat((Object.assign({},i,c),[].map((function(t){return"#define ".concat(t)}))),p).map((function(t){return t.startsWith("#define ")?t:"#define ".concat(t)}));if(!h||!l)throw new Error("Program: "+n.id+"\uff1amust provide vertexShader and fragmentShader");if((0,a.Z)((0,r.Z)(n),je)[je]="string"==typeof h?new Ie(e,g(h,O),b):h,(0,a.Z)((0,r.Z)(n),ze)[ze]="string"==typeof l?new Be(e,g(l,O),b):l,n.gl.attachShader(n.handle,(0,a.Z)((0,r.Z)(n),je)[je].handle),n.gl.attachShader(n.handle,(0,a.Z)((0,r.Z)(n),ze)[ze].handle),n.gl.linkProgram(n.handle),n.gl.validateProgram(n.handle),!n.gl.getProgramParameter(n.handle,n.gl.LINK_STATUS))throw new Error("Program:".concat(n.id,": Error linking ").concat(n.gl.getProgramInfoLog(n.handle)));return n.uniforms=c,(0,a.Z)((0,r.Z)(n),Ve)[Ve]={blending:C,cullFace:y,frontFace:w,depthTest:E,depthWrite:M,depthFunc:S,blendFunc:R,blendEquation:F},(0,a.Z)((0,r.Z)(n),De)[De]=new Map,(0,a.Z)((0,r.Z)(n),Ge)[Ge]=new Map,(0,a.Z)((0,r.Z)(n),We)[We](c),(0,a.Z)((0,r.Z)(n),He)[He](),!f||null!=R&&R.src||(n.renderer.premultipliedAlpha?(0,a.Z)((0,r.Z)(n),Ve)[Ve].blendFunc=Object.assign({},R,{src:n.gl.ONE,dst:n.gl.ONE_MINUS_SRC_ALPHA}):(0,a.Z)((0,r.Z)(n),Ve)[Ve].blendFunc=Object.assign({},R,{src:n.gl.SRC_ALPHA,dst:n.gl.ONE_MINUS_SRC_ALPHA})),n}(0,s.Z)(e,t);var i=e.prototype;return i.use=function(){var t=this,e=this.rendererState.currentProgramId===this.id,i=-1;e||(this.gl.useProgram(this.handle),this.rendererState.currentProgramId=this.id),(0,a.Z)(this,De)[De].forEach((function(e,n){var r=n.name,s=t.uniforms[r];if(s)if(s&&(I(s.value)||D(s.value)))console.warn("Program:".concat(t.id,": Uniform ").concat(r," is missing a value parameter"));else{var o=null==s?void 0:s.value;if(o instanceof ye)return i+=1,s.value.update(i),Ue(t.gl,n.type,e.location,i);if((o instanceof bt||o instanceof ct||o instanceof Tt)&&(o=s.value.toArray()),o&&o.length>0&&o[0]instanceof ye){for(var a=[],h=0;h<s.value.length;h++){var l=o[h];i+=1,l.update(i),a.push(i)}return Ue(t.gl,n.type,e.location,a)}Ue(t.gl,n.type,e.location,o)}else console.warn("Program:".concat(t.id,": Active uniform ").concat(r," has not been supplied"))})),this.applyState()},i.setStates=function(t,e){void 0===e&&(e=!0),e?((0,a.Z)(this,Ve)[Ve]=Object.assign({},(0,a.Z)(this,Ve)[Ve],V(t,["blendFunc","blendEquation"])),t.blendFunc&&((0,a.Z)(this,Ve)[Ve].blendFunc=Object.assign({},(0,a.Z)(this,Ve)[Ve].blendFunc,t.blendFunc)),t.blendEquation&&((0,a.Z)(this,Ve)[Ve].blendEquation=Object.assign({},(0,a.Z)(this,Ve)[Ve].blendEquation,t.blendEquation))):(0,a.Z)(this,Ve)[Ve]=t},i.applyState=function(){this.rendererState.apply((0,a.Z)(this,Ve)[Ve])},i.setUniform=function(t,e){this.uniforms[t]&&(this.uniforms[t].value=e)},i.bind=function(){this.gl.useProgram(this.handle)},i.unbind=function(){this.gl.useProgram(null)},i.createHandle=function(){return this.gl.createProgram()},i.deleteHandle=function(){this.gl.deleteProgram(this.handle)},i.destroy=function(){this.unbind(),this.deleteHandle()},(0,o.Z)(e,[{key:"uniformLocations",get:function(){return(0,a.Z)(this,De)[De]}},{key:"attributeLocations",get:function(){return(0,a.Z)(this,Ge)[Ge]}},{key:"vertexShader",get:function(){return(0,a.Z)(this,je)[je]}},{key:"fragmentShader",get:function(){return(0,a.Z)(this,ze)[ze]}}]),e}(me);function Xe(t){void 0===t&&(t={});for(var e=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_UNIFORMS),i=0;i<e;i++){var n,r=this.gl.getActiveUniform(this.handle,i);if(!r)break;var s=r.name,o=s.match(/(\w+)/g),h={location:this.gl.getUniformLocation(this.handle,s),type:r.type,name:o[0],isStruct:!1};3===o.length?(h.isStructArray=!0,h.structIndex=Number(o[1]),h.structProperty=o[2]):2===o.length&&isNaN(Number(o[1]))&&(h.isStruct=!0,h.structProperty=o[1]);var l=null==(n=t[s])?void 0:n.value;I(l)||D(l)||(h.value=t[s].value),this.uniforms[s]=h,(0,a.Z)(this,De)[De].set(r,h)}}function Ye(){for(var t=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_ATTRIBUTES),e=[],i=0;i<t;i++){var n=this.gl.getActiveAttrib(this.handle,i);if(!n)break;var r=this.gl.getAttribLocation(this.handle,n.name);e[r]=n.name,(0,a.Z)(this,Ge)[Ge].set(n,r)}this.attributeOrder=e.join("")}var Ke=(0,h.Z)("state"),Je=function(t){function e(e,i){var n;void 0===i&&(i={});var s=e.gl,o={target:s.TEXTURE_3D,type:s.UNSIGNED_BYTE,format:s.RGBA,internalFormat:i.format||s.RGBA,wrapS:s.CLAMP_TO_EDGE,wrapT:s.CLAMP_TO_EDGE,wrapR:s.CLAMP_TO_EDGE,generateMipmaps:!0,minFilter:s.LINEAR,magFilter:s.LINEAR,premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,level:0,depth:0},h=Object.assign({},o,i);return(n=t.call(this,e,h,!1)||this).needsUpdate=!1,n.textureUnit=0,n.depth=void 0,Object.defineProperty((0,r.Z)(n),Ke,{writable:!0,value:{}}),n.needsUpdate=!0,n.depth=n.options.depth,(0,a.Z)((0,r.Z)(n),Ke)[Ke].version=-1,n.update(),n}(0,s.Z)(e,t);var i=e.prototype;return i.setData=function(t,e,i,n){void 0===e&&(e=this.width),void 0===i&&(i=this.height),void 0===n&&(n=this.depth),this.image=t,this.width=e,this.height=i,this.depth=n,this.needsUpdate=!0},i.setOptions=function(t){this.options=Object.assign(this.options,t),this.width=this.options.width,this.height=this.options.height,this.depth=this.options.depth,this.needsUpdate=!0},i.update=function(t){void 0===t&&(t=0);var e=!(this.image===(0,a.Z)(this,Ke)[Ke].image&&!this.needsUpdate);if((e||this.rendererState.textureUnits[t]!==this.id||this.rendererState.activeTextureUnit!==t)&&(this.rendererState.setActiveTexture(t),this.bind(t)),e){if(this.needsUpdate=!1,this.options.wrapS!==(0,a.Z)(this,Ke)[Ke].wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.options.wrapS),(0,a.Z)(this,Ke)[Ke].wrapS=this.options.wrapS),this.options.wrapT!==(0,a.Z)(this,Ke)[Ke].wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.options.wrapT),(0,a.Z)(this,Ke)[Ke].wrapT=this.options.wrapT),this.options.wrapR!==(0,a.Z)(this,Ke)[Ke].wrapR&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_R,this.options.wrapR),(0,a.Z)(this,Ke)[Ke].wrapR=this.options.wrapR),this.options.minFilter!==(0,a.Z)(this,Ke)[Ke].minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.options.minFilter),(0,a.Z)(this,Ke)[Ke].minFilter=this.options.minFilter),this.options.magFilter!==(0,a.Z)(this,Ke)[Ke].magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.options.magFilter),(0,a.Z)(this,Ke)[Ke].magFilter=this.options.magFilter),this.options.flipY!==this.rendererState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.options.flipY),this.rendererState.flipY=this.options.flipY),this.options.premultiplyAlpha!==this.rendererState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),this.rendererState.premultiplyAlpha=this.options.premultiplyAlpha),this.options.unpackAlignment!==this.rendererState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.options.unpackAlignment),this.rendererState.unpackAlignment=this.options.unpackAlignment),this.options.anisotropy&&this.options.anisotropy!==this.rendererState.anisotropy){var i=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(i){var n=this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT),r=this.options.anisotropy;this.options.anisotropy>n&&(r=n,console.warn("[Texture]: Texture.anisotropy option exceeded the maximum allowed value "+n+" of the device")),this.gl.texParameterf(this.target,i.TEXTURE_MAX_ANISOTROPY_EXT,r)}this.rendererState.anisotropy=this.options.anisotropy}this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.renderer.isWebGL2&&k(this.options.offset)?this.gl.texImage3D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,this.depth,0,this.options.format,this.options.type,this.image,this.options.offset):(ArrayBuffer.isView(this.image),this.gl.texImage3D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,this.depth,0,this.options.format,this.options.type,this.image)),this.options.generateMipmaps&&(this.renderer.isWebGL2||T(this.image.width)&&T(this.image.height)?this.gl.generateMipmap(this.target):(this.options.generateMipmaps=!1,this.options.wrapS=this.gl.CLAMP_TO_EDGE,this.options.wrapT=this.options.wrapS,this.options.minFilter=this.gl.LINEAR))):this.width>0?this.gl.texImage3D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,this.depth,0,this.options.format,this.options.type,null):this.gl.texImage3D(this.target,0,this.gl.RGBA,1,1,this.depth,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,ge),(0,a.Z)(this,Ke)[Ke].image=this.image,(0,a.Z)(this,Ke)[Ke].version+=1}},i.removeStats=function(){(0,a.Z)(this,Ke)[Ke]={version:-1}},i.toString=function(){return"Texture3D("+this.id+","+this.width+"x"+this.height+")"},(0,o.Z)(e,[{key:"gl",get:function(){return this.renderer.gl}}]),e}(ye),$e=new wt,Qe=new vt,ti=new vt,ei=(0,h.Z)("near"),ii=(0,h.Z)("far"),ni=(0,h.Z)("fov"),ri=(0,h.Z)("aspect"),si=(0,h.Z)("zoom"),oi=(0,h.Z)("bounds"),ai=function(t){function e(e){var i,n=void 0===e?{}:e,s=n.near,o=void 0===s?.1:s,h=n.far,l=void 0===h?100:h,u=n.fov,c=void 0===u?45:u,d=n.aspect,f=void 0===d?1:d,m=n.bounds,p=n.zoom,v=void 0===p?1:p;(i=t.call(this)||this).cameraType=void 0,i.projectionMatrix=void 0,i.viewMatrix=void 0,i.projectionViewMatrix=void 0,i.worldPosition=void 0,Object.defineProperty((0,r.Z)(i),ei,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(i),ii,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(i),ni,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(i),ri,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(i),si,{writable:!0,value:void 0}),Object.defineProperty((0,r.Z)(i),oi,{writable:!0,value:void 0}),i.frustum=void 0,i.cameraType="perspective",i.projectionMatrix=new St,i.viewMatrix=new wt,i.projectionViewMatrix=new St,i.worldPosition=new vt,i.frustum=new wt,(0,a.Z)((0,r.Z)(i),ei)[ei]=o,(0,a.Z)((0,r.Z)(i),ii)[ii]=l,(0,a.Z)((0,r.Z)(i),ni)[ni]=c,(0,a.Z)((0,r.Z)(i),ri)[ri]=f,(0,a.Z)((0,r.Z)(i),oi)[oi]=m,(0,a.Z)((0,r.Z)(i),si)[si]=v;var g=m||{},b=g.left,y=g.right,x=g.top,w=g.bottom;return i.cameraType=b||y?"orthographic":"perspective","orthographic"===i.cameraType?i.orthographic(b,y,x,w,o,l,v):i.perspective(c,f,o,l),i}(0,s.Z)(e,t);var i=e.prototype;return i.perspective=function(t,e,i,n){void 0===t&&(t=this.fov),void 0===e&&(e=this.aspect),void 0===i&&(i=this.near),void 0===n&&(n=this.far),(0,a.Z)(this,ni)[ni]=t,(0,a.Z)(this,ri)[ri]=e,(0,a.Z)(this,ei)[ei]=i,(0,a.Z)(this,ii)[ii]=n,this.projectionMatrix.fromPerspective(t,e,i,n),this.cameraType="perspective"},i.orthographic=function(t,e,i,n,r,s,o){void 0===r&&(r=this.near),void 0===s&&(s=this.far),void 0===o&&(o=1),(0,a.Z)(this,oi)[oi]={left:t,right:e,top:i,bottom:n},this.near=r,this.far=s,this.projectionMatrix.orthographic(t/o,e/o,i/o,n/o,r,s),this.cameraType="orthographic",this.projectionMatrix.frustum(this.frustum,(0,a.Z)(this,oi)[oi].left,(0,a.Z)(this,oi)[oi].right,(0,a.Z)(this,oi)[oi].top,(0,a.Z)(this,oi)[oi].bottom,(0,a.Z)(this,ei)[ei],(0,a.Z)(this,ii)[ii])},i.lookAt=function(e){return t.prototype.lookAt.call(this,e,!0),this},i.updateMatrixWorld=function(){return t.prototype.updateMatrixWorld.call(this),this.viewMatrix.invert(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this},i.frustumIntersectsMesh=function(t,e){if(void 0===e&&(e=t.worldMatrix),!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;var i=Qe;i.copy(t.geometry.bounds.center),i.applyMatrix4(e);var n=t.geometry.bounds.radius*e.getMaxScaleOnAxis();return this.frustumIntersectsSphere(i,n)},i.frustumIntersectsSphere=function(t,e){for(var i=ti,n=0;n<6;n++){var r=this.frustum[n];if(i.copy(r).dot(t)+r.constant<-e)return!1}return!0},i.project=function(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this},i.unproject=function(t){return t.applyMatrix4($e.invert(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this},i.updateProjectionMatrix=function(){throw new Error("Camera subclass must define virtual methods")},(0,o.Z)(e,[{key:"near",get:function(){return(0,a.Z)(this,ei)[ei]},set:function(t){(0,a.Z)(this,ei)[ei]=t,this.updateProjectionMatrix()}},{key:"far",get:function(){return(0,a.Z)(this,ii)[ii]},set:function(t){(0,a.Z)(this,ii)[ii]=t,this.updateProjectionMatrix()}},{key:"fov",get:function(){return(0,a.Z)(this,ni)[ni]},set:function(t){(0,a.Z)(this,ni)[ni]=t,this.updateProjectionMatrix()}},{key:"aspect",get:function(){return(0,a.Z)(this,ri)[ri]},set:function(t){(0,a.Z)(this,ri)[ri]=t,this.updateProjectionMatrix()}},{key:"zoom",get:function(){return(0,a.Z)(this,si)[si]},set:function(t){(0,a.Z)(this,si)[si]=t,this.updateProjectionMatrix()}},{key:"bounds",get:function(){return(0,a.Z)(this,oi)[oi]},set:function(t){(0,a.Z)(this,oi)[oi]=t,this.updateProjectionMatrix()}}]),e}(_t),hi=function(t){function e(e,i,n,r){return t.call(this,{fov:e,aspect:i,near:n,far:r})||this}return(0,s.Z)(e,t),e.prototype.updateProjectionMatrix=function(){this.projectionMatrix.fromPerspective(this.fov,this.aspect,this.near,this.far)},e}(ai),li=function(t){function e(e,i,n,r,s,o,a){return void 0===a&&(a=1),t.call(this,{bounds:{left:e,right:i,top:n,bottom:r},near:s,far:o,zoom:a})||this}return(0,s.Z)(e,t),e.prototype.updateProjectionMatrix=function(){var t=this.bounds,e=t.left,i=t.right,n=t.top,r=t.bottom,s=this.zoom;this.projectionMatrix.orthographic(e/s,i/s,n/s,r/s,this.near,this.far)},e}(ai)},7672:(t,e,i)=>{i.d(e,{E:()=>m});var n=i(6446),r=i(2569),s=i(5935);const o=i.p+"assets/images/lut-237c8bbe432f273b62b7cb78e97cf490.png",a=i.p+"assets/images/sunset-diffuse-RGBM-07e34e095bbcd1e6bd98a0848bf366a9.png",h=i.p+"assets/images/sunset-specular-RGBM-8cc1b3dce731aaccef0b0625020e73dc.png";var l=i(889),u={5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array,"image/jpeg":Uint8Array,"image/png":Uint8Array},c={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},d={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},f={translation:"position",rotation:"quaternion",scale:"scale"};var m=function(){function t(){}return t.load=function(){var t=(0,s.Z)((0,r.Z)().mark((function t(e,i){var n,s;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.split("/").slice(0,-1).join("/")+"/",t.next=3,this.parseDesc(i);case 3:return s=t.sent,t.next=6,this.parse(e,s,n);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})));return function(e,i){return t.apply(this,arguments)}}(),t.parse=function(){var t=(0,s.Z)((0,r.Z)().mark((function t(e,i,n){var s,o,a,h,l,u,c,d,f,m,p,v;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(void 0===i.asset||i.asset.version[0]<2)&&console.warn("Only GLTF >=2.0 supported. Attempting to parse."),t.next=3,this.loadBuffers(i,n);case 3:for(s=t.sent,e.bindVertexArray(null),o=this.parseBufferViews(e,i,s),a=this.parseImages(e,i,n,o),h=this.parseTextures(e,i,a),l=this.parseMaterials(e,i,h),u=this.parseSkins(e,i,o),c=this.parseMeshes(e,i,o,l,u),d=this.parseNodes(e,i,c,u),this.populateSkins(u,d),f=this.parseAnimations(e,i,d,o),m=this.parseScenes(i,d),p=m[i.scene],v=d.length;v>=0;v--)d[v]||d.splice(v,1);return t.abrupt("return",{json:i,buffers:s,bufferViews:o,images:a,textures:h,materials:l,meshes:c,nodes:d,animations:f,scenes:m,scene:p});case 18:case"end":return t.stop()}}),t,this)})));return function(e,i,n){return t.apply(this,arguments)}}(),t.parseDesc=function(){var t=(0,s.Z)((0,r.Z)().mark((function t(e){var i=this;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.match(/\.glb/)){t.next=6;break}return t.next=3,fetch(e).then((function(t){return t.json()}));case 3:case 8:return t.abrupt("return",t.sent);case 6:return t.next=8,fetch(e).then((function(t){return t.arrayBuffer()})).then((function(t){return i.unpackGLB(t)}));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.unpackGLB=function(t){var e=new Uint32Array(t,0,3);if(1179937895!==e[0])throw new Error("Invalid glTF asset.");if(2!==e[1])throw new Error('Unsupported glTF binary version, "'+e[1]+'".');var i=new Uint32Array(t,12,2),n=i[0];if(1313821514!==i[1])throw new Error("Unexpected GLB layout.");var r=(new TextDecoder).decode(t.slice(20,20+n)),s=JSON.parse(r);if(20+n===t.byteLength)return s;var o=new Uint32Array(t,20+n,2);if(5130562!==o[1])throw new Error("Unexpected GLB layout.");var a=20+n+8,h=o[0],l=t.slice(a,a+h);return s.buffers[0].binary=l,s},t.resolveURI=function(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)},t.loadBuffers=function(){var t=(0,s.Z)((0,r.Z)().mark((function t(e,i){var n=this;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.buffers){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,Promise.all(e.buffers.map((function(t){if(t.binary)return t.binary;var e=n.resolveURI(t.uri,i);return fetch(e).then((function(t){return t.arrayBuffer()}))})));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),t.parseBufferViews=function(t,e,i){if(!e.bufferViews)return null;var n=e.bufferViews.map((function(t){return Object.assign({},t)}));return e.meshes&&e.meshes.forEach((function(i){i.primitives.forEach((function(i){var r=i.attributes,s=i.indices;for(var o in r)n[e.accessors[r[o]].bufferView].isAttribute=!0;void 0!==s&&(n[e.accessors[s].bufferView].isAttribute=!0,n[e.accessors[s].bufferView].target=t.gl.ELEMENT_ARRAY_BUFFER)}))})),e.accessors.forEach((function(t){var e=t.bufferView,i=t.componentType;n[e].componentType=i})),e.images&&e.images.forEach((function(t){t.uri;var e=t.bufferView,i=t.mimeType;void 0!==e&&(n[e].mimeType=i)})),n.forEach((function(e,r){var s=e.buffer,o=e.byteOffset,a=void 0===o?0:o,h=e.byteLength,l=(e.byteStride,e.target),c=(void 0===l&&t.gl.ARRAY_BUFFER,e.name,e.extensions,e.extras,e.componentType),d=e.mimeType,f=(e.isAttribute,u[c||d]),m=f.BYTES_PER_ELEMENT,p=new f(i[s],a,h/m);n[r].data=p,n[r].originalBuffer=i[s]})),n},t.parseImages=function(t,e,i,n){var r=this;return e.images?e.images.map((function(t){var e=t.uri,s=t.bufferView,o=t.mimeType,a=t.name,h=new Image;if(h.name=a,e)h.src=r.resolveURI(e,i);else if(void 0!==s){var l=n[s].data,u=new Blob([l],{type:o});h.src=URL.createObjectURL(u)}return h.ready=new Promise((function(t){h.onload=function(){return t()}})),h})):null},t.parseTextures=function(t,e,i){return e.textures?e.textures.map((function(n){var r=n.sampler,s=n.source,o=n.name,a=(n.extensions,n.extras,{flipY:!1,generateMipmaps:!0,wrapS:t.gl.REPEAT,wrapT:t.gl.REPEAT,minFilter:t.gl.NEAREST_MIPMAP_LINEAR}),h=void 0!==r?e.samplers[r]:null;h&&["magFilter","minFilter","wrapS","wrapT"].forEach((function(t){h[t]&&(a[t]=h[t])}));var u=new l.Texture(t,a);u.name=o;var c=i[s];return c.ready.then((function(){u.setData(c,c.width,c.height)})),u})):null},t.parseMaterials=function(t,e,i){return e.materials?e.materials.map((function(t){var e=t.name,n=(t.extensions,t.extras,t.pbrMetallicRoughness),r=void 0===n?{}:n,s=t.normalTexture,o=t.occlusionTexture,a=t.emissiveTexture,h=t.emissiveFactor,l=void 0===h?[0,0,0]:h,u=t.alphaMode,c=void 0===u?"OPAQUE":u,d=t.alphaCutoff,f=void 0===d?.5:d,m=t.doubleSided,p=void 0!==m&&m,v=r,g=v.baseColorFactor,b=void 0===g?[1,1,1,1]:g,y=v.baseColorTexture,x=v.metallicFactor,w=void 0===x?1:x,Z=v.roughnessFactor,E=void 0===Z?1:Z,A=v.metallicRoughnessTexture;return y&&(y.texture=i[y.index]),s&&(s.texture=i[s.index]),A&&(A.texture=i[A.index]),o&&(o.texture=i[o.index]),a&&(a.texture=i[a.index]),{name:e,baseColorFactor:b,baseColorTexture:y,metallicFactor:w,roughnessFactor:E,metallicRoughnessTexture:A,normalTexture:s,occlusionTexture:o,emissiveTexture:a,emissiveFactor:l,alphaMode:c,alphaCutoff:f,doubleSided:p}})):null},t.parseSkins=function(t,e,i){var n=this;return e.skins?e.skins.map((function(t){var r=t.inverseBindMatrices,s=t.skeleton,o=t.joints;return{inverseBindMatrices:n.parseAccessor(r,e,i),skeleton:s,joints:o}})):null},t.parseMeshes=function(t,e,i,n,r){var s=this;return e.meshes?e.meshes.map((function(r,o){var a=r.primitives,h=r.weights,u=r.name,c=(r.extensions,r.extras,0);return e.nodes&&e.nodes.forEach((function(t){var e=t.mesh,i=t.skin;e===o&&(c++,void 0!==i&&i)})),{primitives:a=s.parsePrimitives(t,a,e,i,n,c).map((function(e){var i=e.geometry,n=e.program,r=e.mode,s=new l.Mesh(t,{geometry:i,program:n,mode:r});return s.name=u,s.geometry.isInstanced&&(s.numInstances=c,s.frustumCulled=!1),s})),weights:h,name:u}})):null},t.parsePrimitives=function(t,e,i,n,r,s){var u=this;return e.map((function(e){var c=e.attributes,f=e.indices,m=e.material,p=e.mode,v=void 0===p?4:p,g=(e.targets,e.extensions,e.extras,new l.Geometry(t));for(var b in c)g.addAttribute(d[b],new l.BufferAttribute(t,u.parseAccessor(c[b],i,n)));void 0!==f&&g.setIndex(new l.BufferAttribute(t,u.parseAccessor(f,i,n))),s>1&&g.addAttribute("instanceMatrix",new l.BufferAttribute(t,{divisor:1,size:16,data:new Float32Array(16*s)}));var y={};void 0!==m&&(y=r[m]);var x=function(t,e,i,n){var r=[];e.attributes.get("uv")&&r.push("UV"),e.attributes.get("normal")&&r.push("NORMAL"),e.isInstanced&&r.push("INSTANCED"),i.boneTexture&&r.push("SKINNING"),"MASK"===i.alphaMode&&r.push("ALPHA_MASK"),i.baseColorTexture&&r.push("COLOR_MAP"),i.normalTexture&&r.push("NORMAL_MAP"),i.metallicRoughnessTexture&&r.push("RM_MAP"),i.occlusionTexture&&r.push("OCC_MAP"),i.emissiveTexture&&r.push("EMISSIVE_MAP");var s={wrapS:t.gl.CLAMP_TO_EDGE,wrapT:t.gl.CLAMP_TO_EDGE,format:t.gl.RGBA,internalFormat:t.gl.RGBA,generateMipmaps:!0,minFilter:t.gl.NEAREST_MIPMAP_LINEAR,magFilter:t.gl.LINEAR,premultiplyAlpha:!1,unpackAlignment:4,flipY:!0},u=new l.Texture(t,s),c=new l.Texture(t,s),d=new l.Texture(t,s);return u.fromSrc(o),c.fromSrc(a),d.fromSrc(h),new l.Program(t,{vertexShader:"#version 300 es\n#define GLSLIFY 1\n#define attribute in\n#define varying out\n#define texture2D texture\n\n#defines\n\nattribute vec3 position;\n\n#ifdef UV\nattribute vec2 uv;\n#else\nconst vec2 uv = vec2(0);\n#endif\n\n#ifdef NORMAL\nattribute vec3 normal;\n#else\nconst vec3 normal = vec3(0);\n#endif\n\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;\n#endif\n\n#ifdef SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nuniform mat3 normalMatrix;\n\n#ifdef SKINNING\nuniform sampler2D boneTexture;\nuniform int boneTextureSize;\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vMPos;\nvarying vec4 vMVPos;\n\n#ifdef SKINNING\n    mat4 getBoneMatrix(const in float i) {\n        float j = i * 4.0;\n        float x = mod(j, float(boneTextureSize));\n        float y = floor(j / float(boneTextureSize));\n\n        float dx = 1.0 / float(boneTextureSize);\n        float dy = 1.0 / float(boneTextureSize);\n\n        y = dy * (y + 0.5);\n\n        vec4 v1 = texture2D(boneTexture, vec2(dx * (x + 0.5), y));\n        vec4 v2 = texture2D(boneTexture, vec2(dx * (x + 1.5), y));\n        vec4 v3 = texture2D(boneTexture, vec2(dx * (x + 2.5), y));\n        vec4 v4 = texture2D(boneTexture, vec2(dx * (x + 3.5), y));\n\n        return mat4(v1, v2, v3, v4);\n    }\n\n    void skin(inout vec4 pos, inout vec3 nml) {\n        mat4 boneMatX = getBoneMatrix(skinIndex.x);\n        mat4 boneMatY = getBoneMatrix(skinIndex.y);\n        mat4 boneMatZ = getBoneMatrix(skinIndex.z);\n        mat4 boneMatW = getBoneMatrix(skinIndex.w);\n\n        // update normal\n        mat4 skinMatrix = mat4(0.0);\n        skinMatrix += skinWeight.x * boneMatX;\n        skinMatrix += skinWeight.y * boneMatY;\n        skinMatrix += skinWeight.z * boneMatZ;\n        skinMatrix += skinWeight.w * boneMatW;\n        nml = vec4(skinMatrix * vec4(nml, 0.0)).xyz;\n\n        // Update position\n        vec4 transformed = vec4(0.0);\n        transformed += boneMatX * pos * skinWeight.x;\n        transformed += boneMatY * pos * skinWeight.y;\n        transformed += boneMatZ * pos * skinWeight.z;\n        transformed += boneMatW * pos * skinWeight.w;\n        pos = transformed;\n    }\n#endif\n\nvoid main() {\n    vec4 pos = vec4(position, 1);\n    vec3 nml = normal;\n\n    #ifdef SKINNING\n    skin(pos, nml);\n    #endif\n\n    #ifdef INSTANCED\n    pos = instanceMatrix * pos;\n\n    mat3 m = mat3(instanceMatrix);\n    nml /= vec3(dot(m[0], m[0]), dot(m[1], m[1]), dot(m[2], m[2]));\n    nml = m * nml;\n    #endif\n\n    vUv = uv;\n    vNormal = normalize(nml);\n\n    vec4 mPos = modelMatrix * pos;\n    vMPos = mPos.xyz / mPos.w;\n    vMVPos = modelViewMatrix * pos;\n\n    gl_Position = projectionMatrix * vMVPos;\n}\n",fragmentShader:"#version 300 es\nprecision highp float;\n#define GLSLIFY 1\n#define varying in\n#define texture2D texture\n#define gl_FragColor FragColor\nout vec4 FragColor;\n\n#defines\n\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nuniform vec4 uBaseColorFactor;\nuniform sampler2D tBaseColor;\n\nuniform sampler2D tRM;\nuniform float uRoughness;\nuniform float uMetallic;\n\nuniform sampler2D tNormal;\nuniform float uNormalScale;\n\nuniform sampler2D tEmissive;\nuniform vec3 uEmissive;\n\nuniform sampler2D tOcclusion;\n\nuniform sampler2D tLUT;\nuniform sampler2D tEnvDiffuse;\nuniform sampler2D tEnvSpecular;\nuniform float uEnvDiffuse;\nuniform float uEnvSpecular;\n\nuniform vec3 uLightDirection;\nuniform vec3 uLightColor;\n\nuniform float uAlpha;\nuniform float uAlphaCutoff;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vMPos;\nvarying vec4 vMVPos;\n\nconst float PI = 3.14159265359;\nconst float RECIPROCAL_PI = 0.31830988618;\nconst float RECIPROCAL_PI2 = 0.15915494;\nconst float LN2 = 0.6931472;\n\nconst float ENV_LODS = 6.0;\n\nvec4 SRGBtoLinear(vec4 srgb) {\n    vec3 linOut = pow(srgb.xyz, vec3(2.2));\n    return vec4(linOut, srgb.w);\n}\n\nvec4 RGBMToLinear(in vec4 value) {\n    float maxRange = 6.0;\n    return vec4(value.xyz * value.w * maxRange, 1.0);\n}\n\nvec3 linearToSRGB(vec3 color) {\n    return pow(color, vec3(1.0 / 2.2));\n}\n\nvec3 getNormal() {\n    #ifdef NORMAL_MAP\n    vec3 pos_dx = dFdx(vMPos.xyz);\n    vec3 pos_dy = dFdy(vMPos.xyz);\n    vec2 tex_dx = dFdx(vUv);\n    vec2 tex_dy = dFdy(vUv);\n\n    // Tangent, Bitangent\n    vec3 t = normalize(pos_dx * tex_dy.t - pos_dy * tex_dx.t);\n    vec3 b = normalize(-pos_dx * tex_dy.s + pos_dy * tex_dx.s);\n    mat3 tbn = mat3(t, b, normalize(vNormal));\n\n    vec3 n = texture2D(tNormal, vUv).rgb * 2.0 - 1.0;\n    n.xy *= uNormalScale;\n    vec3 normal = normalize(tbn * n);\n\n    // Get world normal from view normal (normalMatrix * normal)\n    // return normalize((vec4(normal, 0.0) * viewMatrix).xyz);\n    return normalize(normal);\n    #else\n    return normalize(vNormal);\n    #endif\n}\n\nvec3 specularReflection(vec3 specularEnvR0, vec3 specularEnvR90, float VdH) {\n    return specularEnvR0 + (specularEnvR90 - specularEnvR0) * pow(clamp(1.0 - VdH, 0.0, 1.0), 5.0);\n}\n\nfloat geometricOcclusion(float NdL, float NdV, float roughness) {\n    float r = roughness;\n\n    float attenuationL = 2.0 * NdL / (NdL + sqrt(r * r + (1.0 - r * r) * (NdL * NdL)));\n    float attenuationV = 2.0 * NdV / (NdV + sqrt(r * r + (1.0 - r * r) * (NdV * NdV)));\n    return attenuationL * attenuationV;\n}\n\nfloat microfacetDistribution(float roughness, float NdH) {\n    float roughnessSq = roughness * roughness;\n    float f = (NdH * roughnessSq - NdH) * NdH + 1.0;\n    return roughnessSq / (PI * f * f);\n}\n\nvec2 cartesianToPolar(vec3 n) {\n    vec2 uv;\n    uv.x = atan(n.z, n.x) * RECIPROCAL_PI2 + 0.5;\n    uv.y = asin(n.y) * RECIPROCAL_PI + 0.5;\n    return uv;\n}\n\nvoid getIBLContribution(inout vec3 diffuse, inout vec3 specular, float NdV, float roughness, vec3 n, vec3 reflection, vec3 diffuseColor, vec3 specularColor) {\n    vec3 brdf = SRGBtoLinear(texture2D(tLUT, vec2(NdV, roughness))).rgb;\n\n    vec3 diffuseLight = RGBMToLinear(texture2D(tEnvDiffuse, cartesianToPolar(n))).rgb;\n    diffuseLight = mix(vec3(1), diffuseLight, uEnvDiffuse);\n\n    // Sample 2 levels and mix between to get smoother degradation\n    float blend = roughness * ENV_LODS;\n    float level0 = floor(blend);\n    float level1 = min(ENV_LODS, level0 + 1.0);\n    blend -= level0;\n\n    // Sample the specular env map atlas depending on the roughness value\n    vec2 uvSpec = cartesianToPolar(reflection);\n    uvSpec.y /= 2.0;\n\n    vec2 uv0 = uvSpec;\n    vec2 uv1 = uvSpec;\n\n    uv0 /= pow(2.0, level0);\n    uv0.y += 1.0 - exp(-LN2 * level0);\n\n    uv1 /= pow(2.0, level1);\n    uv1.y += 1.0 - exp(-LN2 * level1);\n\n    vec3 specular0 = RGBMToLinear(texture2D(tEnvSpecular, uv0)).rgb;\n    vec3 specular1 = RGBMToLinear(texture2D(tEnvSpecular, uv1)).rgb;\n    vec3 specularLight = mix(specular0, specular1, blend);\n\n    diffuse = diffuseLight * diffuseColor;\n\n    // Bit of extra reflection for smooth materials\n    float reflectivity = pow((1.0 - roughness), 2.0) * 0.05;\n    specular = specularLight * (specularColor * brdf.x + brdf.y + reflectivity);\n    specular *= uEnvSpecular;\n}\n\nvoid main() {\n    vec4 baseColor = uBaseColorFactor;\n    #ifdef COLOR_MAP\n    baseColor *= SRGBtoLinear(texture2D(tBaseColor, vUv));\n    #endif\n\n    // Get base alpha\n    float alpha = baseColor.a;\n\n    #ifdef ALPHA_MASK\n    if (alpha < uAlphaCutoff) discard;\n    #endif\n\n    // RM map packed as gb = [nothing, roughness, metallic, nothing]\n    vec4 rmSample = vec4(1);\n    #ifdef RM_MAP\n    rmSample *= texture2D(tRM, vUv);\n    #endif\n    float roughness = clamp(rmSample.g * uRoughness, 0.04, 1.0);\n    float metallic = clamp(rmSample.b * uMetallic, 0.04, 1.0);\n\n    vec3 f0 = vec3(0.04);\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallic);\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n    vec3 specularEnvR0 = specularColor;\n    vec3 specularEnvR90 = vec3(clamp(max(max(specularColor.r, specularColor.g), specularColor.b) * 25.0, 0.0, 1.0));\n\n    vec3 N = getNormal();\n    vec3 V = normalize(cameraPosition - vMPos);\n    vec3 L = normalize(uLightDirection);\n    vec3 H = normalize(L + V);\n    vec3 reflection = normalize(reflect(-V, N));\n\n    float NdL = clamp(dot(N, L), 0.001, 1.0);\n    float NdV = clamp(abs(dot(N, V)), 0.001, 1.0);\n    float NdH = clamp(dot(N, H), 0.0, 1.0);\n    float LdH = clamp(dot(L, H), 0.0, 1.0);\n    float VdH = clamp(dot(V, H), 0.0, 1.0);\n\n    vec3 F = specularReflection(specularEnvR0, specularEnvR90, VdH);\n    float G = geometricOcclusion(NdL, NdV, roughness);\n    float D = microfacetDistribution(roughness, NdH);\n\n    vec3 diffuseContrib = (1.0 - F) * (diffuseColor / PI);\n    vec3 specContrib = F * G * D / (4.0 * NdL * NdV);\n\n    // Shading based off lights\n    vec3 color = NdL * uLightColor * (diffuseContrib + specContrib);\n\n    // Add lights spec to alpha for reflections on transparent surfaces (glass)\n    alpha = max(alpha, max(max(specContrib.r, specContrib.g), specContrib.b));\n\n    // Calculate IBL lighting\n    vec3 diffuseIBL;\n    vec3 specularIBL;\n    getIBLContribution(diffuseIBL, specularIBL, NdV, roughness, N, reflection, diffuseColor, specularColor);\n\n    // Add IBL on top of color\n    color += diffuseIBL + specularIBL;\n\n    // Add IBL spec to alpha for reflections on transparent surfaces (glass)\n    alpha = max(alpha, max(max(specularIBL.r, specularIBL.g), specularIBL.b));\n\n    #ifdef OCC_MAP\n    // TODO: figure out how to apply occlusion\n    // color *= SRGBtoLinear(texture2D(tOcclusion, vUv)).rgb;\n    #endif\n\n    #ifdef EMISSIVE_MAP\n    vec3 emissive = SRGBtoLinear(texture2D(tEmissive, vUv)).rgb * uEmissive;\n    color += emissive;\n    #endif\n\n    // Convert to sRGB to display\n    gl_FragColor.rgb = linearToSRGB(color);\n\n    // Apply uAlpha uniform at the end to overwrite any specular additions on transparent surfaces\n    gl_FragColor.a = alpha * uAlpha;\n}\n",uniforms:{uBaseColorFactor:{value:(new l.Vector4).fromArray(i.baseColorFactor||[1,1,1,1])},tBaseColor:{value:i.baseColorTexture?i.baseColorTexture.texture:null},tRM:{value:i.metallicRoughnessTexture?i.metallicRoughnessTexture.texture:null},uRoughness:{value:void 0!==i.roughnessFactor?i.roughnessFactor:1},uMetallic:{value:void 0!==i.metallicFactor?i.metallicFactor:1},tNormal:{value:i.normalTexture?i.normalTexture.texture:null},uNormalScale:{value:i.normalTexture&&i.normalTexture.scale||1},tOcclusion:{value:i.occlusionTexture?i.occlusionTexture.texture:null},tEmissive:{value:i.emissiveTexture?i.emissiveTexture.texture:null},uEmissive:{value:(new l.Vector3).fromArray(i.emissiveFactor||[0,0,0])},tLUT:{value:u},tEnvDiffuse:{value:c},tEnvSpecular:{value:d},uEnvDiffuse:{value:.5},uEnvSpecular:{value:.5},uLightDirection:{value:new l.Vector3(0,1,1)},uLightColor:{value:new l.Vector3(2.5)},uAlpha:{value:1},uAlphaCutoff:{value:i.alphaCutoff}},defines:r,transparent:"BLEND"===i.alphaMode,cullFace:i.doubleSided?void 0:t.gl.BACK})}(t,g,y);return{geometry:g,program:x,mode:v}}))},t.parseAccessor=function(t,e,i){var n=e.accessors[t],r=n.bufferView,s=n.byteOffset,o=void 0===s?0:s,a=n.componentType,h=n.normalized,l=void 0!==h&&h,d=n.count,f=n.type,m=n.min,p=n.max,v=(n.sparse,i[r]),g=v.data,b=v.originalBuffer,y=v.byteOffset,x=void 0===y?0:y,w=v.byteStride,Z=void 0===w?0:w,E=(v.target,c[f]),A=u[a],M=g.BYTES_PER_ELEMENT;return{data:!!Z&&Z/M!==E?g:new A(b,o+x,d*E),size:E,type:a,normalized:l,stride:Z,offset:o,count:d,min:m,max:p}},t.parseNodes=function(t,e,i,n){if(!e.nodes)return null;var r=e.nodes.map((function(t){t.camera,t.children,t.skin;var e=t.matrix,n=t.mesh,r=t.rotation,s=t.scale,o=t.translation,a=(t.weights,t.name),h=(t.extensions,t.extras,new l.Object3D);a&&(h.name=a),e?(h.localMatrix.copy((new l.ProjectionMatrix).fromArray(e)),h.decompose()):(r&&h.quaternion.copy((new l.Quaternion).fromArray(r)),s&&h.scale.copy((new l.Vector3).fromArray(s)),o&&h.position.copy((new l.Vector3).fromArray(o)),h.updateMatrix());var u=!1,c=!0;if(void 0!==n&&i[n].primitives.forEach((function(t){t.geometry.isInstanced&&(u=!0,t.instanceCount?c=!1:t.instanceCount=0,h.matrix.toArray(t.geometry.attributes.instanceMatrix.data,16*t.instanceCount),t.instanceCount++,t.instanceCount===t.numInstances&&(delete t.numInstances,delete t.instanceCount,t.geometry.attributes.instanceMatrix.needsUpdate=!0)),u?c&&t.setParent(h):t.setParent(h)})),u){if(!c)return null;h.localMatrix=(new l.ProjectionMatrix).fromArray(l.Matrix4.identity.toArray()),h.decompose()}return h}));return e.nodes.forEach((function(t,e){var i=t.children;(void 0===i?[]:i).forEach((function(t){r[t]&&r[t].setParent(r[e])}))})),r},t.populateSkins=function(t,e){t&&t.forEach((function(t){t.joints=t.joints.map((function(i,r){var s=e[i];return s.bindInverse=(0,n.Z)(l.Matrix4,t.inverseBindMatrices.data.slice(16*r,16*(r+1))),s})),t.skeleton&&(t.skeleton=e[t.skeleton])}))},t.parseAnimations=function(t,e,i,n){var r=this;return e.animations?e.animations.map((function(t){var s=t.channels,o=t.samplers,a=t.name;s.map((function(t){var s=t.sampler,a=t.target,h=o[s],l=h.input,u=h.interpolation,c=void 0===u?"LINEAR":u,d=h.output,m=a.node,p=a.path;return{node:i[m],transform:f[p],interpolation:c,times:r.parseAccessor(l,e,n).data,values:r.parseAccessor(d,e,n).data}}));return{name:a,animation:{}}})):null},t.parseScenes=function(t,e){return t.scenes?t.scenes.map((function(t){var i=t.nodes,n=void 0===i?[]:i;t.name,t.extensions,t.extras;return n.reduce((function(t,i){return e[i]&&t.push(e[i]),t}),[])})):null},t}()},5473:(t,e,i)=>{i.d(e,{Z:()=>I});var n={};i.r(n),i.d(n,{CameraSync:()=>O,MAX_MERCATOR_LATITUDE:()=>M,MeshLayer:()=>P,altitudeFromMercatorZ:()=>Z,circumferenceAtLatitude:()=>v,earthCircumference:()=>m,earthRadius:()=>f,fromLngLat:()=>T,getTileCenter:()=>_,halfEarthCircumference:()=>p,latFromMercatorY:()=>w,lngFromMercatorX:()=>x,mercatorScale:()=>E,mercatorXfromLng:()=>g,mercatorYfromLat:()=>b,mercatorZfromAltitude:()=>y,meterInMercatorCoordinateUnits:()=>A,toLngLat:()=>S});var r=i(79),s=i(2799),o=i(9649),a=i(889),h=i(6426),l=i.n(h),u=i(6958),c=i(4964),d=c.P6.clamp,f=6371008.8,m=2*Math.PI*f,p=m/2;function v(t){return m*Math.cos(t*Math.PI/180)}function g(t){return(180+t)/360}function b(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function y(t,e){return t/v(e)}function x(t){return 360*t-180}function w(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}function Z(t,e){return t*v(w(e))}function E(t){return 1/Math.cos(t*Math.PI/180)}function A(t){return 1/m*E(w(t))}var M=85.051129;function T(t,e){void 0===e&&(e=0);var i=d(t.lat,-M,M);return{x:g(t.lng),y:b(i),z:y(e,i)}}function S(t){return{lng:x(t.x),lat:w(t.y)}}function _(t,e,i){var n=Math.pow(2,i);return{x:t*m/n-p,y:-(e*m/n-p)}}var C=c.P6.degToRad,R=c.P6.radToDeg,F=c.P6.clamp;(0,c.Gd)(!0);var O=function(){function t(t,e,i){this.worldMatrix=void 0,this.mercatorMatrix=void 0,this.labelPlaneMatrix=void 0,this.glCoordMatrix=void 0,this.map=void 0,this.scene=void 0,this.camera=void 0,this.halfFov=void 0,this.cameraToCenterDistance=void 0,this.acuteAngle=void 0,this.cameraTranslateZ=void 0,this.worldMatrix=new c.yG,this.mercatorMatrix=new c.yG,this.labelPlaneMatrix=new c.yG,this.glCoordMatrix=new c.yG;var n=t.transform,r=n.width,s=n.height,o=R(Math.atan(3/4)),a=1e21;this.map=t,this.scene=i,this.scene.matrixAutoUpdate=!1,this.scene.worldMatrixNeedsUpdate=!0,this.camera="orthographic"===e?new c.iK(-r/2,r/2,s/2,-s/2,.1,a):new c.cP(o,r/s,.1,a),this.camera.matrixAutoUpdate=!1,this.camera.position.z=600,this.setup()}var e=t.prototype;return e.setup=function(){var t=this.map.transform,e=t.width,i=t.height,n=C(this.map.transform.maxPitch);this.camera.aspect=e/i,this.halfFov=this.map.transform.fov/2,this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*i,this.acuteAngle=Math.PI/2-n,this.update()},e.update=function(){var t=this.map.transform,e=t.width,i=t.height,n=t.worldSize,r=t.elevation,s=t._camera,o=t._horizonShift,a=this.map.getCenter(),h=this.map.getPitch(),l=C(h),u=this.map.getBearing(),d=this.map.transform._fov,f=d/2,m=Math.cos(Math.PI/2-l),p=Math.PI/2+l;this.cameraToCenterDistance=.5/Math.tan(f)*i;var v,g=this.map.transform.project(a),b=(new c.yG).fromRotationZ(Math.PI),x=(new c.yG).fromScale(new c.P(-n,n,n)),w=(new c.yG).fromTranslation(new c.P(-g.x,g.y,0)),Z=i/50,E=Math.max(Z*m,Z),A=d*(.5+this.map.transform.centerOffset.y/i),M=Math.sin(A)*this.cameraToCenterDistance/Math.sin(F(Math.PI-p-A,.01,Math.PI-.01)),T=y(1,a.lat)*n||1;if(function(t,e){t=t.split("."),e=e.split(".");for(var i=Math.max(t.length,e.length);t.length<i;)t.push("0");for(;e.length<i;)e.push("0");for(var n=0;n<i;n++){var r=parseInt(t[n]),s=parseInt(e[n]);if(r>s)return 1;if(r<s)return-1}return 0}(this.map.version,"2.0.0")>=0){var S=r?r.getMinElevationBelowMSL()*T:0,_=(s.position[2]*n-S)/Math.cos(l),R=m*(M=Math.sin(A)*_/Math.sin(c.P6.clamp(Math.PI-p-A,.01,Math.PI-.01)))+_,O=_*(1/o);v=Math.min(1.01*R,O)}else{v=1.01*(m*M+this.cameraToCenterDistance)}this.mercatorMatrix=(new c.yG).scale(new c.P(n,n,n/T));var P=(new c.yG).fromTranslation(new c.P(0,0,this.cameraToCenterDistance));this.labelPlaneMatrix=new c.yG;var L=new c.yG;L.scale(new c.P(1,-1,1)),L.translate(new c.P(-1,-1,0)),L.scale(new c.P(2/e,2/i,1)),this.glCoordMatrix=L,this.camera.aspect=e/i,this.cameraTranslateZ=this.cameraToCenterDistance,this.camera instanceof c.iK?this.camera.projectionMatrix.orthographic(-e/2,e/2,i/2,-i/2,E,v):this.camera.projectionMatrix.perspective(d,e/i,E,v);var N=(new c.yG).premultiply(P).premultiply((new c.yG).fromRotationX(l)).premultiply((new c.yG).fromRotationZ(-C(u)));r&&(N.elements[14]=s.position[2]*n),this.camera.worldMatrix.copy(N),this.camera.updateMatrixWorld(),this.scene&&(this.scene.localMatrix=(new c.lB).premultiply(b).premultiply(x).premultiply(w))},t}(),P=function(){function t(t,e){this.id=void 0,this.type=void 0,this.renderingMode=void 0,this.meshes=void 0,this.sync=void 0,this.map=void 0,this.renderer=void 0,this.scene=void 0,this.id=t,this.type="custom",this.renderingMode=(null==e?void 0:e.renderingMode)||"2d",this.updateCamera=this.updateCamera.bind(this)}var e=t.prototype;return e.updateCamera=function(){this.sync.update()},e.projectToWorld=function(t){var e=T({lng:t[0],lat:t[1]},t[2]);return[e.x,e.y,e.z]},e.onAdd=function(t,e){this.map=t,this.renderer=new c.Th(e,{autoClear:!1}),this.scene=new c.xs,this.sync=new O(t,"perspective",this.scene),t.on("move",this.updateCamera),t.on("resize",this.updateCamera),this.updateCamera()},e.addMesh=function(t){t&&!this.meshes.has(null==t?void 0:t.id)&&(this.meshes.set(null==t?void 0:t.id,t),this.scene.add(t))},e.removeMesh=function(t){t&&this.meshes.has(null==t?void 0:t.id)&&(this.scene.remove(t),this.meshes.delete(null==t?void 0:t.id))},e.onRemove=function(){for(var t=this.meshes.entries(),e=0;e<this.meshes.size;e++){var i=t.next().value,n=i[0],r=i[1];this.scene.remove(r),this.meshes.delete(n)}this.map.on("move",this.updateCamera),this.map.on("resize",this.updateCamera)},e.render=function(){this.scene.worldMatrixNeedsUpdate=!0,this.renderer.render({scene:this.scene,camera:this.camera}),this.renderer.resetState()},(0,u.Z)(t,[{key:"camera",get:function(){return this.sync.camera}}]),t}(),L=i(6792),N=i(7672);const I=Object.assign({React:r},r,{useBaseUrl:o.Z,ve:a},a,{observe:L.N7,unobserve:L.p_,GLTFLoader:N.E,leva:s,Leva:s.Leva,LevaPanel:s.LevaPanel,mapboxgl:l(),mbve:n})},6792:(t,e,i)=>{i.d(e,{N7:()=>o,p_:()=>a});var n=i(9146),r=new Map;var s=new n.Z((function(t){t.forEach((function(t){var e,i=t.target;null==(e=r.get(i))||e.forEach((function(t){return t(i)}))}))}));function o(t,e){r.has(t)||(r.set(t,new Set),s.observe(t)),r.get(t).add(e)}function a(t,e){r.has(t)&&(r.get(t).delete(e),r.get(t).size||(s.unobserve(t),r.delete(t)))}}}]);