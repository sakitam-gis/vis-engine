"use strict";(self.webpackChunkvis_engine_docs=self.webpackChunkvis_engine_docs||[]).push([[3529],{3529:(e,t,r)=>{r.r(t),r.d(t,{VeLayer:()=>m,VeRenderer:()=>p});var n=r(4244),i=r(5327),a=r(5015),s=r(1031),o=r(238),c=r(4964);function h(e){return e.getGLRes?e.getGLRes():e.getGLZoom()}function d(e,t,r,n){return e.coordToPointAtRes?e.coordToPointAtRes(t,r,n):e.coordinateToPoint(t,r,n)}(0,c.Gd)(!0);var l=new o.Coordinate(0,0),u=new o.Point(0,0),v=(0,s.Z)("renderTarget"),f=(0,s.Z)("initRenderer"),g=(0,s.Z)("syncCamera"),p=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,Object.defineProperty((0,n.Z)(t),g,{value:w}),Object.defineProperty((0,n.Z)(t),f,{value:y}),t.scene=void 0,t.camera=void 0,t.canvas=void 0,t.layer=void 0,t.gl=void 0,t.context=void 0,t.matrix4=void 0,Object.defineProperty((0,n.Z)(t),v,{writable:!0,value:void 0}),t}(0,i.Z)(t,e);var r=t.prototype;return r.getPrepareParams=function(){return[this.scene,this.camera]},r.getDrawParams=function(){return[this.scene,this.camera]},r._drawLayer=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.prototype._drawLayer.apply(this,r)},r.hitDetect=function(){return!1},r.createCanvas=function(){e.prototype.createCanvas.call(this),this.createContext()},r.createContext=function(){if(this.canvas.gl&&this.canvas.gl.wrap)this.gl=this.canvas.gl.wrap();else{var e,t=this.layer,r=t.options.glOptions||{alpha:!0,depth:!0,antialias:!0,stencil:!0};r.preserveDrawingBuffer=!0,this.gl=this.gl||c.P6.getContext(this.canvas,r,null==(e=t.options)?void 0:e.requestWebGl2)}(0,a.Z)(this,f)[f](),this.layer.onCanvasCreate(this.context,this.scene,this.camera)},r.onCanvasCreate=function(){e.prototype.onCanvasCreate.call(this)},r.resizeCanvas=function(e){if(this.canvas){var t,r=this.getMap();t=e||r.getSize();var n=r.getDevicePixelRatio?r.getDevicePixelRatio():o.Browser.retina?2:1,i=this.canvas,a=o.Util.calCanvasSize(t,n),s=a.width,c=a.height,h=a.cssWidth,d=a.cssHeight;if(!this.layer._canvas||i.style.width===h&&i.style.height===d||(i.style.width=h,i.style.height=d),i.width===s&&i.height===c)return this;i.width=s,i.height=c,this.context.setSize(i.width,i.height)}},r.clearCanvas=function(){this.canvas&&this.context.clear()},r.prepareCanvas=function(){return this.canvas?this.clearCanvas():this.createCanvas(),this.layer.fire("renderstart",{context:this.context}),null},r.renderScene=function(e){if(this.scene.worldMatrixNeedsUpdate=!0,(0,a.Z)(this,g)[g](),e&&e.renderTarget){var t=e.renderTarget.fbo,r=t.width,n=t.height;(0,a.Z)(this,v)[v]?(0,a.Z)(this,v)[v].resize(r,n):((0,a.Z)(this,v)[v]=new c.AC(this.context,{width:r,height:n,depth:!1}),this.context.render({camera:this.camera,scene:this.scene,target:(0,a.Z)(this,v)[v]})),(0,a.Z)(this,v)[v].swapHandle(e.renderTarget.getFramebuffer(e.renderTarget.fbo)),this.context.render({camera:this.camera,scene:this.scene,target:(0,a.Z)(this,v)[v]}),(0,a.Z)(this,v)[v].restoreHandle()}else this.context.render({camera:this.camera,scene:this.scene});this.completeRender()},r.remove=function(){delete this._drawContext,(0,a.Z)(this,v)[v]&&((0,a.Z)(this,v)[v].destroy(),(0,a.Z)(this,v)[v]=void 0),e.prototype.remove.call(this)},t}(o.renderer.CanvasLayerRenderer);function y(){this.matrix4=new c.yG;var e=new c.Th(this.gl,{autoClear:!1});e.setSize(this.canvas.width,this.canvas.height),this.context=e,this.context.state.setClearColor({r:0,g:0,b:0,a:0}),this.scene=new c.xs;var t=this.layer.getMap(),r=t.getFov()*Math.PI/180;this.camera=new c.cP(r,t.width/t.height,t.cameraNear,t.cameraFar),this.camera.matrixAutoUpdate=!1,(0,a.Z)(this,g)[g]()}function w(){var e=this.getMap(),t=this.camera;t.localMatrix.fromArray(e.cameraWorldMatrix),t.projectionMatrix.fromArray(e.projMatrix),t.worldMatrixNeedsUpdate=!0,t.updateMatrixWorld()}var m=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).options=void 0,n.map=void 0,n.type=void 0,n._needsUpdate=!0,n.type="VeLayer",n}(0,i.Z)(t,e);var r=t.prototype;return r.prepareToDraw=function(){throw Error("must define virtual methods")},r.isRendering=function(){var e=this.getMap();return!!e&&(e.isInteracting()||e.isAnimating())},r.draw=function(e,t,r,n,i,a){this.renderScene(a,this)},r.drawOnInteracting=function(e,t,r,n,i,a,s){this.renderScene(s,this)},r.coordinateToVector3=function(e,t,r){void 0===t&&(t=0);var n=this.getMap();if(!n)return null;var i=Array.isArray(e);i?(l.x=e[0],l.y=e[1]):e instanceof o.Coordinate||(e=new o.Coordinate(e));var a=h(n),s=d(n,i?l:e,a,u);return r&&(r.x=s.x,r.y=s.y,r.z=t),new c.P(s.x,s.y,t)},r.coordinatiesToGLFloatArray=function(e,t){var r=this.getMap();if(!r)return null;for(var n=h(r),i=e.length,a=new Float32Array(2*i),s=new Float32Array(3*i),c=0;c<i;c++){var v=e[c],f=Array.isArray(v);f?(l.x=v[0],l.y=v[1]):v instanceof o.Coordinate||(v=new o.Coordinate(v));var g=d(r,f?l:v,n,u);g.x-=t.x,g.y-=t.y;var p=2*c;a[p]=g.x,a[p+1]=g.y;var y=3*c;s[y]=g.x,s[y+1]=g.y,s[y+2]=0}return{positions:s,positons2d:a}},r.coordinatiesToGLArray=function(e,t){var r=this.getMap();if(!r)return null;for(var n=h(r),i=e.length,a=new Array(i),s=0;s<i;s++){var c=e[s],v=Array.isArray(c);v?(l.x=c[0],l.y=c[1]):c instanceof o.Coordinate||(c=new o.Coordinate(c));var f=d(r,v?l:c,n,u);f.x-=t.x,f.y-=t.y,a[s]=[f.x,f.y]}return a},r.distanceToVector3=function(e,t,r){if(0===e&&0===t||!o.Util.isNumber(e)||!o.Util.isNumber(t))return new c.P(0,0,0);var n=this.getMap(),i=h(n),a=r||n.getCenter();a instanceof o.Coordinate||(a=new o.Coordinate(a));var s=n.locate(a,e,t),l=d(n,a,i),u=d(n,s,i),v=Math.abs(u.x-l.x)*o.Util.sign(e),f=Math.abs(u.y-l.y)*o.Util.sign(t);return new c.P(v,f,0)},r.altitudeToVector3=function(e,t,r,n){if(0===e||!o.Util.isNumber(e))return new c.P(0,0,0);var i=this.getMap();if(i.altitudeToPoint){var a=h(i),s=i.altitudeToPoint(e,a);return e<0&&s>0&&(s=-s),n?(n.x=s,n.y=s,n.z=0,n):new c.P(s,s,0)}return this.distanceToVector3(e,e,r)},r.getObjects=function(){var e=this.getScene();if(!e)return[];for(var t=[],r=0,n=e.children.length;r<n;r++){var i=e.children[r];i&&t.push(i)}return t},r.clear=function(){return this.clearObject()},r.clearObject=function(){var e=this.getScene();if(!e)return this;for(var t=e.children.length-1;t>=0;t--){var r=e.children[t];r&&e.remove(r)}return this},r.getCamera=function(){var e=this._getRenderer();return e?e.camera:null},r.getScene=function(){var e=this._getRenderer();return e?e.scene:null},r.renderScene=function(e,t){var r=this._getRenderer();return r&&(r.clearCanvas(),r.renderScene(e),t||r.setToRedraw()),this},r.getVeRenderer=function(){var e=this._getRenderer();return e?e.context:null},r.addMesh=function(e,t){if(void 0===t&&(t=!0),!e)return this;Array.isArray(e)||(e=[e]);var r=this.getScene();if(e.forEach((function(e){null==r||r.add(e)})),t){var n=this._getRenderer();n&&n.setToRedraw()}return this},r.removeMesh=function(e,t){if(void 0===t&&(t=!0),!e)return this;Array.isArray(e)||(e=[e]);var r=this.getScene();if(e.forEach((function(e){null==r||r.remove(e)})),t){var n=this._getRenderer();n&&n.setToRedraw()}return this},r.onAdd=function(){return e.prototype.onAdd.call(this),this.map||this.getMap()?(this._needsUpdate=!0,this):this},r.onRemove=function(){return e.prototype.onRemove.call(this),this.map||this.getMap()?(this.clear(),this):this},t}(o.CanvasLayer);m.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:void 0,forceRenderOnZooming:!0}),m.registerRenderer("gl",p)}}]);