"use strict";(self.webpackChunkvis_engine_docs=self.webpackChunkvis_engine_docs||[]).push([[8876,7918],{7266:(t,e,n)=>{n.r(e),n.d(e,{Box:()=>hn,BufferAttribute:()=>Dt,Camera:()=>ti,Clock:()=>K,Color:()=>It,DataTexture:()=>Je,Euler:()=>Rt,EventEmitter:()=>ut,Geometry:()=>jt,Matrix3:()=>wt,Matrix4:()=>Mt,Mesh:()=>ne,Object3D:()=>Ot,OrthographicCamera:()=>ni,PerspectiveCamera:()=>ei,Plane:()=>on,Program:()=>On,ProjectionMatrix:()=>Ut,Quaternion:()=>pt,Raf:()=>ot,RenderBuffer:()=>We,RenderTarget:()=>nn,Renderer:()=>_e,Resource:()=>Pe,Scene:()=>re,State:()=>he,Texture:()=>je,Texture3D:()=>Gn,Vector2:()=>ft,Vector3:()=>yt,Vector4:()=>bt,getPlaneBuffer:()=>rn,highPrecision:()=>A,utils:()=>j});var i=n(2198),r=n(4036),s=n(8187),a=n(8788),o=n(7897),h=n(663),l=n(1606),u=n(4717),c=n(9196),f=n(5316),d=n(6518),m=n(1354);function p(t,e,n){return void 0===e&&(e=[]),void 0===n&&(n=[]),t.replace(/#defines/,e.join("\n")).replace(/#includes/,n.join("\n"))}function g(t,e,n,i){var r=new Set;if(i)for(var s=0,a=n;s<a;s+=3)for(var o=i[s],h=i[s+1],l=i[s+2],u=[o,h,h,l,l,o],c=0;c<u.length;c+=2)v(3*u[c],3*u[c+1],t,r)&&e.push(u[c],u[c+1]);else for(var f=0,d=n;f<d;f+=3)for(var m=f+1,p=f+2,g=[f,m,m,p,p,f],y=0;y<g.length;y+=2)v(3*g[y],3*g[y+1],t,r)&&e.push(g[y],g[y+1]);return e}function v(t,e,n,i){var r=n[t]+","+n[t+1]+","+n[t+2]+"-"+n[e]+","+n[e+1]+","+n[e+2],s=n[e]+","+n[e+1]+","+n[e+2]+"-"+n[t]+","+n[t+1]+","+n[t+2];return!0!==i.has(r)&&!0!==i.has(s)&&(i.add(r),i.add(s),!0)}var y=Math.PI/180,b=180/Math.PI;function x(t){return t*y}function w(t){return t*b}function E(t,e,n){return Math.min(Math.max(t,e),n)}function M(t){return Math.log(t)/Math.LN2%1==0}var T=Float32Array;function A(t,e){void 0===e&&(e=!0),T=t?Float64Array:Float32Array,e&&o.ZR(T)}function S(){return T}function C(t){return"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext||("undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||(!(!(null==t?void 0:t.gl)||!(t.gl instanceof WebGLRenderingContext||t.gl instanceof WebGL2RenderingContext))||Boolean(t&&Number.isFinite(t._version))))}function R(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||(!!((null==t?void 0:t.gl)&&t.gl instanceof WebGL2RenderingContext)||Boolean(t&&2===t._version))}function _(t,e,n){var i,r;void 0===e&&(e={}),void 0===n&&(n=!1);var s=["webgl2","webgl","experimental-webgl"];n||s.shift();var a=null;function o(t){console.error(t.statusMessage)}null==(i=null==t?void 0:t.addEventListener)||i.call(t,"webglcontextcreationerror",o,!1);for(var h=0;h<s.length;++h){try{a=t.getContext(s[h],e)}catch(l){}if(a)break}return null==(r=null==t?void 0:t.removeEventListener)||r.call(t,"webglcontextcreationerror",o,!1),a}var k=function(){return("undefined"==typeof performance?Date:performance).now()};function L(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function F(t){return"string"===L(t)}function N(t){return"undefined"===L(t)}function I(t){return F(t)&&t.includes("%")}function U(t){return"number"===L(t)}function O(t){return"regexp"===L(t)}function P(t){return null==t}function D(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}var B={};function G(t){return void 0===t&&(t="id"),B[t]=B[t]||1,t+"-"+B[t]++}function W(t,e){return void 0===e&&(e=[]),Object.keys(t).filter((function(t){return e.indexOf(t)<0})).reduce((function(e,n){var i;return Object.assign(e,((i={})[n]=t[n],i))}),{})}var Z,z,V,j=Object.freeze({__proto__:null,DEG_TO_RAD:y,RAD_TO_DEG:b,clamp:E,defineShader:function(t,e){return void 0===e&&(e={}),Object.keys(e).reduce((function(t,n){return e[n]?"#define "+n+" "+e[n]+"\n"+t:t}),t)},degToRad:x,getContext:_,getFloatArrayConstructor:S,getShaderName:function(t,e){void 0===e&&(e="unnamed");var n=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:e},getWireframeIndex:g,hasValue:function(t,e){return D(t)?!P(t.value)&&(P(e)||t.value===e):!P(t)&&(P(e)||t===e)},highPrecision:A,isHex:I,isNull:P,isNumber:U,isObject:D,isPowerOfTwo:M,isRegexp:O,isString:F,isUndef:N,isUniqueEdge:v,isWebGL:C,isWebGL2:R,now:k,omit:W,parseShader:p,pick:function(t,e){return void 0===e&&(e=[]),Object.keys(t).filter((function(t){return e.indexOf(t)>-1})).reduce((function(e,n){var i;return Object.assign(e,((i={})[n]=t[n],i))}),{})},radToDeg:w,typeOf:L,uid:G}),H=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},X=function(t,e,n){return H(t,e,"read from private field"),n?n.call(t):e.get(t)},q=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Y=function(t,e,n,i){return H(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},K=function(){function t(t){void 0===t&&(t=!0),q(this,Z,0),q(this,z,0),q(this,V,!1),this.running=t}var e=t.prototype;return e.start=function(){X(this,V)||(this.reset(),Y(this,V,!0))},e.stop=function(){this.getElapsedTime(),Y(this,V,!1),this.running=!1},e.reset=function(){Y(this,Z,k()),Y(this,z,0)},e.getElapsedTime=function(){return this.getDelta(),X(this,z)},e.getDelta=function(){var t=0;if(this.running&&!X(this,V))return this.start(),0;if(X(this,V)){var e=k();t=(e-X(this,Z))/1e3,Y(this,Z,e),Y(this,z,X(this,z)+t)}return t},t}();Z=new WeakMap,z=new WeakMap,V=new WeakMap;var J,$,Q,tt,et,nt=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},it=function(t,e,n){return nt(t,e,"read from private field"),n?n.call(t):e.get(t)},rt=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},st=function(t,e,n,i){return nt(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},at={autoStart:!0},ot=function(){function t(t,e){var n=this;void 0===e&&(e={}),rt(this,J,void 0),rt(this,$,void 0),rt(this,Q,void 0),rt(this,tt,void 0),rt(this,et,void 0),this.options=Object.assign({},e,at),st(this,tt,new K),this.reset(),this.onVisibilityChange=this.onVisibilityChange.bind(this),st(this,et,(function(){var e=it(n,tt).getElapsedTime();t&&t(e)})),this.options.autoStart&&this.start()}var e=t.prototype;return e.reset=function(){st(this,$,!1),st(this,Q,!0),void 0!==it(this,J)&&cancelAnimationFrame(it(this,J))},e.start=function(){it(this,$)||(st(this,$,!0),it(this,tt).start(),this.tick(),document&&document.addEventListener("visibilitychange",this.onVisibilityChange,!1))},e.stop=function(){it(this,tt).stop(),this.reset(),document&&document.removeEventListener("visibilitychange",this.onVisibilityChange,!1)},e.tick=function(){var t=this;it(this,$)&&it(this,Q)&&(st(this,J,requestAnimationFrame((function(){t.tick()}))),it(this,et).call(this))},e.onVisibilityChange=function(){st(this,Q,!document.hidden),it(this,Q)&&(this.reset(),this.start())},(0,a.Z)(t,[{key:"visible",get:function(){return it(this,Q)}},{key:"animating",get:function(){return it(this,$)}},{key:"elapsedTime",get:function(){return it(this,tt).getElapsedTime()}}]),t}();J=new WeakMap,$=new WeakMap,Q=new WeakMap,tt=new WeakMap,et=new WeakMap;var ht,lt=function(t,e){var n=this;void 0===e&&(e={}),this.type=t,(Object.getOwnPropertyNames(e)||[]).forEach((function(t){n[t]=e[t]}))},ut=function(){function t(t){var e=(void 0===t?{}:t).validEventTypes,n=void 0===e?[/.*/]:e;this.fns=new Map,this.validateEventTypes=n}var e=t.prototype;return e.validateEventType=function(t){var e=this.validateEventTypes;Array.isArray(this.validateEventTypes)||(e=[this.validateEventTypes]);var n=!0;if(e.forEach((function(e){O(e)&&!e.test(t)&&(n=!1)})),!n)throw new Error("Invalid Event Type: '"+t+"'.\nEvent type should be any of: "+e+".")},e.on=function(t,e,n){var i=this;if(this.validateEventType(t),F(t)){var r=t.split(" ");if(r.length>1)return r.forEach((function(t){i.on(t,e,n)})),this}return this.has(t)||this.fns.set(t,[]),this.fns.get(t).push(e),this},e.once=function(t,e,n){var i=this;if(this.validateEventType(t),F(t)){var r=t.split(" ");if(r.length>1)return r.forEach((function(t){i.once(t,e,n)})),this}return this.on(t,(function r(){i.off(t,r);for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];e.call.apply(e,[n||i].concat(a))}),n)},e.off=function(t,e,n){var i=this;if(this.validateEventType(t),F(t)){var r=t.split(" ");if(r.length>1)return r.forEach((function(t){i.off(t,e,n)})),this}var s=this.has(t);if(s)if(e){var a=s.filter((function(t){return t!==e}));this.fns.set(t,a)}else this.fns.delete(t);return this},e.emit=function(t,e){var n=this,i=t instanceof lt?t:new lt(t,e);this.validateEventType(i.type);var r=this.has(i.type);if(r)return r.map((function(t){return t.call(n,i)}))},e.has=function(t){return this.fns.get(t)},e.clear=function(){return this.fns.clear(),this},t}(),ct=function(){function t(){this.elements=new(S())(2)}var e=t.prototype;return e.fromArray=function(t,e){void 0===e&&(e=0);for(var n=0;n<this.elements.length;n++)this.elements[n]=t[e+n];return this},e.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var n=0;n<this.elements.length;n++)t[e+n]=this.elements[n];return t},t}(),ft=function(t){function e(e,n){var i;void 0===e&&(e=0),void 0===n&&(n=0),(i=t.call(this)||this).elements=new(S())(2);var r=i.elements;return r[0]=e,r[1]=n,i}(0,s.Z)(e,t);var n=e.prototype;return n.fromObject=function(t){var e=t.x,n=t.y;return void 0!==e&&(this.x=e),void 0!==n&&(this.y=n),this},n.toObject=function(){return{x:this.x,y:this.y}},n.set=function(t,e){return this.x=t,this.y=e,this},n.setScalar=function(t){return this.set(t,t)},n.add=function(t){return(0,h.IH)(this.elements,this.elements,t.elements),this},n.addScalar=function(t){return(0,h.IH)(this.elements,this.elements,[t,t]),this},n.subtract=function(t){return(0,h.$X)(this.elements,this.elements,t.elements),this},n.subtractScalar=function(t){return(0,h.$X)(this.elements,this.elements,[t,t]),this},n.multiply=function(t){return(0,h.Jp)(this.elements,this.elements,t.elements),this},n.multiplyScalar=function(t){return(0,h.Jp)(this.elements,this.elements,[t,t]),this},n.divide=function(t){return(0,h.cs)(this.elements,this.elements,t.elements),this},n.divideScalar=function(t){return(0,h.cs)(this.elements,this.elements,[t,t]),this},n.scale=function(t){return(0,h.bA)(this.elements,this.elements,t),this},n.distanceTo=function(t){return(0,h.TE)(this.elements,t.elements)},n.length=function(){return(0,h.kE)(this.elements)},n.distanceToSquared=function(t){return(0,h.bI)(t.elements,this.elements)},n.angle=function(){return(0,h.EU)(this.elements,[1,0])},n.angleTo=function(t){return(0,h.EU)(this.elements,t.elements)},n.dot=function(t){return(0,h.AK)(this.elements,t.elements)},n.equals=function(t){return(0,h.fS)(this.elements,t.elements)},n.cross=function(t){return(0,h.kC)(this.elements,this.elements,t.elements),this},n.negate=function(){return(0,h.tk)(this.elements,this.elements),this},n.inverse=function(){return(0,h.SO)(this.elements,this.elements),this},n.lerp=function(t,e){return(0,h.t7)(this.elements,this.elements,t.elements,e),this},n.normalize=function(){return(0,h.Fv)(this.elements,this.elements),this},n.applyMatrix3=function(t){return(0,h.kK)(this.elements,this.elements,t.elements),this},n.applyMatrix4=function(t){return(0,h.fF)(this.elements,this.elements,t.elements),this},n.copy=function(t){return this.x=t.x,this.y=t.y,this},n.clone=function(){return new e(this.x,this.y)},n.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,a.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t}}]),e}(ct),dt=function(t,e,n){return function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)}(t,e,"read from private field"),n?n.call(t):e.get(t)},mt=[],pt=function(t){function e(e,n,i,s){var a;void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===s&&(s=0),(a=t.call(this)||this).elements=new(S())(4),function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)}((0,r.Z)(a),ht,[]);var o=a.elements;return o[0]=e,o[1]=n,o[2]=i,o[3]=s,a}(0,s.Z)(e,t);var n=e.prototype;return n.fromObject=function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return void 0!==e&&(this.x=e),void 0!==n&&(this.y=n),void 0!==i&&(this.z=i),void 0!==r&&(this.w=r),this.triggerChange(),this},n.toObject=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}},n.fromAxisAngle=function(t,e){return(0,u.yY)(this.elements,t.elements,e),this.triggerChange(),this},n.getAxisAngle=function(t){void 0===t&&(t=new yt);var e=(0,u.Bh)(mt,this.elements);return t.set(mt[0],mt[1],mt[2]),e},n.fromEuler=function(t){return(0,u.Su)(this.elements,w(t.x),w(t.y),w(t.z)),this.triggerChange(),this},n.fromMat3=function(t){return(0,u.bz)(this.elements,t),this},n.set=function(t,e,n,i){return(0,u.t8)(this.elements,t,e,n,i),this.triggerChange(),this},n.length=function(){return(0,u.kE)(this.elements)},n.multiply=function(t,e){return e?(0,u.Jp)(this.elements,t.elements,e.elements):(0,u.Jp)(this.elements,this.elements,t.elements),this.triggerChange(),this},n.slerp=function(t,e){return(0,u.ZA)(this.elements,this.elements,t.elements,e),this.triggerChange(),this},n.invert=function(){return(0,u.U_)(this.elements,this.elements),this.triggerChange(),this},n.conjugate=function(){return(0,u.Kx)(this.elements,this.elements),this.triggerChange(),this},n.normalize=function(){return(0,u.Fv)(this.elements,this.elements),this.triggerChange(),this},n.dot=function(t){return(0,u.AK)(this.elements,t.elements)},n.angleTo=function(t){return(0,u._O)(this.elements,t.elements)},n.clone=function(){return(new e).copy(this)},n.copy=function(t){return(0,u.JG)(this.elements,t.elements),this.triggerChange(),this},n.equals=function(t){return(0,c.fS)(this.elements,t.elements)},n.onChange=function(t){dt(this,ht).includes(t)||dt(this,ht).push(t)},n.triggerChange=function(){dt(this,ht).forEach((function(t){return t()}))},n.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,a.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t,this.triggerChange()}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t,this.triggerChange()}},{key:"z",get:function(){return this.elements[2]},set:function(t){this.elements[2]=t,this.triggerChange()}},{key:"w",get:function(){return this.elements[3]},set:function(t){this.elements[3]=t,this.triggerChange()}}]),e}(ct);ht=new WeakMap;var gt,vt,yt=function(t){function e(e,n,i){var r;void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),(r=t.call(this)||this).elements=new(S())(3);var s=r.elements;return s[0]=e,s[1]=n,s[2]=i,r}(0,s.Z)(e,t);var n=e.prototype;return n.fromObject=function(t){var e=t.x,n=t.y,i=t.z;return void 0!==e&&(this.x=e),void 0!==n&&(this.y=n),void 0!==i&&(this.z=i),this},n.toObject=function(){return{x:this.x,y:this.y,z:this.z}},n.set=function(t,e,n){return(0,l.t8)(this.elements,t,e,n),this},n.setScalar=function(t){return this.set(t,t,t)},n.length=function(){return(0,l.kE)(this.elements)},n.add=function(t){return(0,l.IH)(this.elements,this.elements,t.elements),this},n.addScalar=function(t){return(0,l.IH)(this.elements,this.elements,[t,t,t]),this},n.subtract=function(t){return(0,l.$X)(this.elements,this.elements,t.elements),this},n.subtractScalar=function(t){return(0,l.$X)(this.elements,this.elements,[t,t,t]),this},n.subVectors=function(t,e){return(0,l.$X)(this.elements,t.elements,e.elements),this},n.multiply=function(t){return(0,l.Jp)(this.elements,this.elements,t.elements),this},n.multiplyScalar=function(t){return(0,l.Jp)(this.elements,this.elements,[t,t,t]),this},n.divide=function(t){return(0,l.cs)(this.elements,this.elements,t.elements),this},n.divideScalar=function(t){return(0,l.cs)(this.elements,this.elements,[t,t,t]),this},n.scale=function(t){return(0,l.bA)(this.elements,this.elements,t),this},n.scaleAndAdd=function(t,e){return(0,l.od)(this.elements,this.elements,t.elements,e),this},n.distanceTo=function(t){return(0,l.TE)(this.elements,t.elements)},n.distanceToSquared=function(t){return(0,l.bI)(this.elements,t.elements)},n.angle=function(t){return(0,l.EU)(this.elements,[1,0,0])},n.angleTo=function(t){return(0,l.EU)(this.elements,t.elements)},n.dot=function(t){return(0,l.AK)(this.elements,t.elements)},n.equals=function(t){return(0,l.fS)(this.elements,t.elements)},n.cross=function(t){return(0,l.kC)(this.elements,this.elements,t.elements),this},n.negate=function(){return(0,l.tk)(this.elements,this.elements),this},n.inverse=function(){return(0,l.SO)(this.elements,this.elements),this},n.lerp=function(t,e){return(0,l.t7)(this.elements,this.elements,t.elements,e),this},n.normalize=function(){return(0,l.Fv)(this.elements,this.elements),this},n.applyEuler=function(t){var e=(new pt).fromEuler(t);return this.applyQuaternion(e)},n.applyMatrix3=function(t){return(0,l.kK)(this.elements,this.elements,t.elements),this},n.applyMatrix4=function(t){return(0,l.fF)(this.elements,this.elements,t.elements),this},n.applyQuaternion=function(t){return(0,l.VC)(this.elements,this.elements,t.elements),this},n.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},n.clone=function(){return new e(this.x,this.y,this.z)},n.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,a.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t}},{key:"z",get:function(){return this.elements[2]},set:function(t){this.elements[2]=t}}]),e}(ct),bt=function(t){function e(e,n,i,r){var s;void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),(s=t.call(this)||this).elements=new(S())(4);var a=s.elements;return a[0]=e,a[1]=n,a[2]=i,a[3]=r,s}(0,s.Z)(e,t);var n=e.prototype;return n.fromObject=function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return void 0!==e&&(this.x=e),void 0!==n&&(this.y=n),void 0!==i&&(this.z=i),void 0!==r&&(this.w=r),this},n.toObject=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}},n.set=function(t,e,n,i){return(0,c.t8)(this.elements,t,e,n,i),this},n.setScalar=function(t){return this.set(t,t,t,t)},n.add=function(t){return(0,c.IH)(this.elements,this.elements,t.elements),this},n.addScalar=function(t){return(0,c.IH)(this.elements,this.elements,[t,t,t,t]),this},n.subtract=function(t){return(0,c.$X)(this.elements,this.elements,t.elements),this},n.subtractScalar=function(t){return(0,c.$X)(this.elements,this.elements,[t,t,t,t]),this},n.subVectors=function(t,e){return(0,c.$X)(this.elements,t.elements,e.elements),this},n.multiply=function(t){return(0,c.Jp)(this.elements,this.elements,t.elements),this},n.multiplyScalar=function(t){return(0,c.Jp)(this.elements,this.elements,[t,t,t,t]),this},n.divide=function(t){return(0,c.cs)(this.elements,this.elements,t.elements),this},n.divideScalar=function(t){return(0,c.cs)(this.elements,this.elements,[t,t,t,t]),this},n.scale=function(t){return(0,c.bA)(this.elements,this.elements,t),this},n.scaleAndAdd=function(t,e){return(0,c.od)(this.elements,this.elements,t.elements,e),this},n.distanceTo=function(t){return(0,c.TE)(this.elements,t.elements)},n.distanceToSquared=function(t){return(0,c.bI)(this.elements,t.elements)},n.length=function(){return(0,c.kE)(this.elements)},n.dot=function(t){return(0,c.AK)(this.elements,t.elements)},n.equals=function(t){return(0,c.fS)(this.elements,t.elements)},n.cross=function(t){return(0,c.kC)(this.elements,this.elements,t.elements),this},n.negate=function(){return(0,c.tk)(this.elements,this.elements),this},n.inverse=function(){return(0,c.SO)(this.elements,this.elements),this},n.lerp=function(t,e){return(0,c.t7)(this.elements,this.elements,t.elements,e),this},n.normalize=function(){return(0,c.Fv)(this.elements,this.elements),this},n.applyMatrix4=function(t){return(0,c.fF)(this.elements,this.elements,t.elements),this},n.applyQuaternion=function(t){return(0,c.VC)(this.elements,this.elements,t.elements),this},n.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.clone=function(){return new e(this.x,this.y,this.z,this.w)},n.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,a.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t}},{key:"z",get:function(){return this.elements[2]},set:function(t){this.elements[2]=t}},{key:"w",get:function(){return this.elements[3]},set:function(t){this.elements[3]=t}}]),e}(ct),xt=function(){function t(){this.elements=new(S())(16)}var e=t.prototype;return e.fromArray=function(t,e){void 0===e&&(e=0);for(var n=0;n<this.elements.length;n++)this.elements[n]=t[e+n];return this},e.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var n=0;n<this.elements.length;n++)t[e+n]=this.elements[n];return t},t}(),wt=function(t){function e(e,n,i,r,s,a,o,h,l){var u;void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=1),(u=t.call(this)||this).elements=new(S())(9);var c=u.elements;return c[0]=e,c[1]=n,c[2]=i,c[3]=r,c[4]=s,c[5]=a,c[6]=o,c[7]=h,c[8]=l,u}(0,s.Z)(e,t);var n=e.prototype;return n.set=function(t,e,n,i,r,s,a,o,h){return(0,f.t8)(this.elements,t,e,n,i,r,s,a,o,h),this},n.transpose=function(){return(0,f.p4)(this.elements,this.elements),this},n.invert=function(t){return void 0===t&&(t=this),(0,f.U_)(this.elements,t.elements),this},n.adjoint=function(t){return void 0===t&&(t=this),(0,f.uj)(this.elements,t.elements),this},n.determinant=function(){return(0,f.GH)(this.elements)},n.multiply=function(t,e){return e?(0,f.Jp)(this.elements,t.elements,e.elements):(0,f.Jp)(this.elements,this.elements,t.elements),this},n.premultiply=function(t,e){return e?(0,f.Jp)(this.elements,e.elements,t.elements):(0,f.Jp)(this.elements,t.elements,this.elements),this},n.translate=function(t){return(0,f.Iu)(this.elements,this.elements,t.elements),this},n.rotate=function(t){return(0,f.U1)(this.elements,this.elements,t),this},n.scale=function(t){return(0,f.bA)(this.elements,this.elements,t.elements),this},n.fromTranslation=function(t){return(0,f.vc)(this.elements,t.elements),this},n.fromRotation=function(t){return(0,f.Us)(this.elements,t),this},n.fromScaling=function(t){return(0,f.xJ)(this.elements,t.elements),this},n.fromQuat=function(t){return(0,f.en)(this.elements,t.elements),this},n.normalFromMat4=function(t){return(0,f.XL)(this.elements,t.elements),this},n.fromMat4=function(t){return(0,f.xO)(this.elements,t.elements),this},n.frob=function(){return(0,f.Du)(this.elements)},n.add=function(t,e){return e?(0,f.IH)(this.elements,t.elements,e.elements):(0,f.IH)(this.elements,this.elements,t.elements),this},n.subtract=function(t,e){return e?(0,f.$X)(this.elements,t.elements,e.elements):(0,f.$X)(this.elements,this.elements,t.elements),this},n.equals=function(t,e){return e?(0,f.fS)(t.elements,e.elements):(0,f.fS)(this.elements,t.elements)},n.fromRotationTranslationScale=function(t,e,n,i,r){var s=Math.cos(t),a=Math.sin(t);return this.set(i*s,-r*a,0,i*a,r*s,0,e,n,1),this},n.getNormalMatrix=function(t){return(0,f.XL)(this.elements,t.elements),this},n.copy=function(t){return(0,f.JG)(this.elements,t.elements),this},n.clone=function(){return(new e).copy(this)},n.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,a.Z)(e,[{key:"x",get:function(){return this.elements[2]}},{key:"y",get:function(){return this.elements[5]}},{key:"z",get:function(){return this.elements[8]}}],[{key:"identity",get:function(){return(new e).fromArray((0,f.yR)([]))}}]),e}(xt),Et=[],Mt=function(t){function e(e,n,i,r,s,a,o,h,l,u,c,f,d,m,p,g){var v;void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=1),void 0===f&&(f=0),void 0===d&&(d=0),void 0===m&&(m=0),void 0===p&&(p=0),void 0===g&&(g=1),(v=t.call(this)||this).elements=new(S())(16);var y=v.elements;return y[0]=e,y[1]=n,y[2]=i,y[3]=r,y[4]=s,y[5]=a,y[6]=o,y[7]=h,y[8]=l,y[9]=u,y[10]=c,y[11]=f,y[12]=d,y[13]=m,y[14]=p,y[15]=g,v}(0,s.Z)(e,t);var n=e.prototype;return n.set=function(t,e,n,i,r,s,a,o,h,l,u,c,f,m,p,g){return(0,d.t8)(this.elements,t,e,n,i,r,s,a,o,h,l,u,c,f,m,p,g),this},n.transpose=function(){return(0,d.p4)(this.elements,this.elements),this},n.invert=function(t){return void 0===t&&(t=this),(0,d.U_)(this.elements,t.elements),this},n.adjoint=function(t){return void 0===t&&(t=this),(0,d.uj)(this.elements,t.elements),this},n.determinant=function(){return(0,d.GH)(this.elements)},n.add=function(t,e){return e?(0,d.IH)(this.elements,t.elements,e.elements):(0,d.IH)(this.elements,this.elements,t.elements),this},n.subtract=function(t,e){return e?(0,d.$X)(this.elements,t.elements,e.elements):(0,d.$X)(this.elements,this.elements,t.elements),this},n.multiply=function(t,e){return e?(0,d.Jp)(this.elements,t.elements,e.elements):(0,d.Jp)(this.elements,this.elements,t.elements),this},n.multiplyScalar=function(t,e){return void 0===t&&(t=this),(0,d.cf)(this.elements,t.elements,e),this},n.premultiply=function(t,e){return e?(0,d.Jp)(this.elements,e.elements,t.elements):(0,d.Jp)(this.elements,t.elements,this.elements),this},n.translate=function(t){return(0,d.Iu)(this.elements,this.elements,t.elements),this},n.rotate=function(t){return(0,d.U1)(this.elements,this.elements,t),this},n.scale=function(t){return(0,d.bA)(this.elements,this.elements,t.elements),this},n.scaleScalar=function(t){return(0,d.bA)(this.elements,this.elements,[t,t,t]),this},n.fromTranslation=function(t){return(0,d.vc)(this.elements,t.elements),this},n.fromRotation=function(t,e){return(0,d.Us)(this.elements,t,e),this},n.fromRotationX=function(t){return(0,d.aC)(this.elements,t),this},n.fromRotationY=function(t){return(0,d.gT)(this.elements,t),this},n.fromRotationZ=function(t){return(0,d.QO)(this.elements,t),this},n.fromScale=function(t){return(0,d.xJ)(this.elements,t.elements),this},n.fromRotationTranslation=function(t,e){return(0,d.yl)(this.elements,t.elements,e.elements),this},n.fromPerspective=function(t,e,n,i){return(0,d.G3)(this.elements,x(t),e,n,i),this},n.fromOrthogonal=function(t,e,n,i,r,s){return(0,d.M5)(this.elements,t,e,n,i,r,s),this},n.fromQuat=function(t){return(0,d.en)(this.elements,t.elements),this},n.equals=function(t){return(0,d.fS)(this.elements,t.value)},n.getRotation=function(t){return void 0===t&&(t=new pt),(0,d.j6)(Et,this.elements),t.set(Et[0],Et[1],Et[2],Et[3]),t},n.getScale=function(t){return void 0===t&&(t=new yt),(0,d.Q$)(Et,this.elements),t.set(Et[0],Et[1],Et[2]),t},n.getTranslation=function(t){return void 0===t&&(t=new yt),(0,d.i0)(Et,this.elements),t.set(Et[0],Et[1],Et[2]),t},n.rotateX=function(t){return(0,d.lM)(this.elements,this.elements,t),this},n.rotateY=function(t){return(0,d.uD)(this.elements,this.elements,t),this},n.rotateZ=function(t){return(0,d.jI)(this.elements,this.elements,t),this},n.compose=function(t,e,n){return(0,d.Iw)(this.elements,e.elements,t.elements,n.elements),this},n.decompose=function(){return{rotation:this.getRotation(),scale:this.getScale(),translation:this.getTranslation()}},n.copy=function(t){return(0,d.JG)(this.elements,t.elements),this},n.clone=function(){return(new e).copy(this)},n.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,a.Z)(e,[{key:"x",get:function(){return this.elements[12]}},{key:"y",get:function(){return this.elements[13]}},{key:"z",get:function(){return this.elements[14]}},{key:"w",get:function(){return this.elements[15]}}],[{key:"identity",get:function(){return(new e).fromArray((0,d.yR)([]))}}]),e}(xt),Tt=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},At=function(t,e,n){return Tt(t,e,"read from private field"),n?n.call(t):e.get(t)},St=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Ct=function(t,e,n,i){return Tt(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},Rt=function(t){function e(e,n,i,s){var a;void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===s&&(s="xyz"),(a=t.call(this)||this).elements=new(S())(3),St((0,r.Z)(a),gt,[]),St((0,r.Z)(a),vt,"xyz");var o=a.elements;return o[0]=e,o[1]=n,o[2]=i,Ct((0,r.Z)(a),vt,s),a}(0,s.Z)(e,t);var n=e.prototype;return n.fromObject=function(t){var e=t.x,n=t.y,i=t.z,r=t.order;return void 0!==e&&(this.x=e),void 0!==n&&(this.y=n),void 0!==i&&(this.z=i),void 0!==r&&(this.order=r),this.triggerChange(),this},n.toObject=function(){return{x:this.x,y:this.y,z:this.z,order:this.order}},n.fromRotationMatrix=function(t,e,n){void 0===e&&(e=At(this,vt)),void 0===n&&(n=!0);var i=t.toArray(),r=i[0],s=i[4],a=i[8],o=i[1],h=i[5],l=i[9],u=i[2],c=i[6],f=i[10];switch(e){case"xyz":this.y=Math.asin(E(a,-1,1)),Math.abs(a)<.9999999?(this.x=Math.atan2(-l,f),this.z=Math.atan2(-s,r)):(this.x=Math.atan2(c,h),this.z=0);break;case"yxz":this.x=Math.asin(-E(l,-1,1)),Math.abs(l)<.9999999?(this.y=Math.atan2(a,f),this.z=Math.atan2(o,h)):(this.y=Math.atan2(-u,r),this.z=0);break;case"zxy":this.x=Math.asin(E(c,-1,1)),Math.abs(c)<.9999999?(this.y=Math.atan2(-u,f),this.z=Math.atan2(-s,h)):(this.y=0,this.z=Math.atan2(o,r));break;case"zyx":this.y=Math.asin(-E(u,-1,1)),Math.abs(u)<.9999999?(this.x=Math.atan2(c,f),this.z=Math.atan2(o,r)):(this.x=0,this.z=Math.atan2(-s,h));break;case"yzx":this.z=Math.asin(E(o,-1,1)),Math.abs(o)<.9999999?(this.x=Math.atan2(-l,h),this.y=Math.atan2(-u,r)):(this.x=0,this.y=Math.atan2(a,f));break;case"xzy":this.z=Math.asin(-E(s,-1,1)),Math.abs(s)<.9999999?(this.x=Math.atan2(c,h),this.y=Math.atan2(a,r)):(this.x=Math.atan2(-l,f),this.y=0);break;default:throw new Error("Unknown Euler angle order")}return Ct(this,vt,e),n&&this.triggerChange(),this},n.fromQuaternion=function(t){var n=t.elements,i=n[0],r=n[1],s=n[2],a=n[3],o=r*r,h=-2*(o+s*s)+1,l=2*(i*r+a*s),u=-2*(i*s-a*r),c=2*(r*s+a*i),f=-2*(i*i+o)+1;return u=(u=u>1?1:u)<-1?-1:u,new e(Math.atan2(c,f),Math.asin(u),Math.atan2(l,h),"zyx")},n.fromVector3=function(t,e){return void 0===e&&(e=At(this,vt)),this.set(t.x,t.y,t.z,e)},n.toQuaternion=function(){var t=Math.cos(.5*this.yaw),e=Math.sin(.5*this.yaw),n=Math.cos(.5*this.roll),i=Math.sin(.5*this.roll),r=Math.cos(.5*this.pitch),s=Math.sin(.5*this.pitch);return new pt(t*i*r-e*n*s,t*n*s+e*i*r,e*n*r-t*i*s,t*n*r+e*i*s)},n.toVector3=function(){return new yt(this.x,this.y,this.z)},n.set=function(t,e,n,i){return void 0===i&&(i=At(this,vt)),this.elements[0]=t,this.elements[1]=e,this.elements[2]=n,Ct(this,vt,i),this.triggerChange(),this},n.clone=function(){return(new e).copy(this)},n.copy=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]=t.elements[e];return Ct(this,vt,t.order),this.triggerChange(),this},n.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.order===t.order},n.onChange=function(t){At(this,gt).includes(t)||At(this,gt).push(t)},n.triggerChange=function(){At(this,gt).forEach((function(t){return t()}))},n.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},(0,a.Z)(e,[{key:"x",get:function(){return this.elements[0]},set:function(t){this.elements[0]=t,this.triggerChange()}},{key:"y",get:function(){return this.elements[1]},set:function(t){this.elements[1]=t,this.triggerChange()}},{key:"z",get:function(){return this.elements[2]},set:function(t){this.elements[2]=t,this.triggerChange()}},{key:"order",get:function(){return At(this,vt)},set:function(t){Ct(this,vt,t),this.triggerChange()}},{key:"roll",get:function(){return this.x},set:function(t){this.x=t}},{key:"pitch",get:function(){return this.y},set:function(t){this.y=t}},{key:"yaw",get:function(){return this.z},set:function(t){this.z=t}}]),e}(ct);gt=new WeakMap,vt=new WeakMap,(0,m.l7)([function(t,e){var n={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in n)i[n[r]]=r;var s={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,a,o=i[this.toHex()];if(o)return o;if(null==e?void 0:e.closest){var h=this.toRgb(),l=1/0,u="black";if(!s.length)for(var c in n)s[c]=new t(n[c]).toRgb();for(var f in n){var d=(r=h,a=s[f],Math.pow(r.r-a.r,2)+Math.pow(r.g-a.g,2)+Math.pow(r.b-a.b,2));d<l&&(l=d,u=f)}return u}},e.string.push([function(e){var i=e.toLowerCase(),r="transparent"===i?"#0000":n[i];return r?new t(r).toRgb():null},"name"])}]);var _t,kt,Lt,Ft,Nt=function(t,e,n){var i=I(t),r=n-e,s=E(Number.parseFloat(""+t),e,n);return i&&(s=Number.parseInt(""+t*n,10)/100),Math.abs(s-n)<1e-6?1:t%r/r},It=function(){function t(t,e,n,i,r){if(void 0===t&&(t=255),void 0===i&&(i=1),void 0===r&&(r=!1),this.r=1,this.g=1,this.b=1,this.a=1,N(e)&&N(n))if(U(t)&&t<=255)this.setRGBA(t,t,t,this.a,r);else{var s=(0,m.Vi)(t).toRgb();s?this.setRGBA(s.r,s.g,s.b,s.a):console.error("Unsupported color value {".concat(String(t),"} provided"))}else this.setRGBA(t,e,n,i)}var e=t.prototype;return e.fromColor=function(t){var e=(0,m.Vi)(t).toRgb();return this.setRGBA(e.r,e.g,e.b,e.a)},e.fromHSL=function(t,e,n,i){void 0===i&&(i=1);var r=(0,m.Vi)({h:t,s:e,l:n,a:i}).toRgb();return this.setRGBA(r.r,r.g,r.b,r.a)},e.fromHSV=function(t,e,n,i){void 0===i&&(i=1);var r=(0,m.Vi)({h:t,s:e,v:n,a:i}).toRgb();return this.setRGBA(r.r,r.g,r.b,r.a)},e.setRGB=function(t,e,n){return this.setRGBA(t,e,n,this.a),this},e.setRGBA=function(t,e,n,i,r){return this.r=r?t:Nt(t,0,255),this.g=r?e:Nt(e,0,255),this.b=r?n:Nt(n,0,255),this.setAlpha(i),this},e.setAlpha=function(t){return this.a=t>1?Nt(t,0,255):t,this},e.toHex=function(){return(0,m.Vi)(this.toObject()).toHex()},e.toHSL=function(){return(0,m.Vi)(this.toObject()).toHsl()},e.toHSV=function(){return(0,m.Vi)(this.toObject()).toHsv()},e.toObject=function(t){void 0===t&&(t=!1);var e=t?1:255;return{r:this.r*e,g:this.g*e,b:this.b*e,a:this.a}},e.toArray=function(){return[this.r,this.g,this.b,this.a]},e.toVector=function(){return(new bt).fromArray(this.toArray())},e.toVector3=function(){return(new yt).fromArray(this.toArray())},e.toString=function(){return this.constructor.name+"("+this.r+", "+this.g+", "+this.b+", "+this.a+")"},t}(),Ut=function(t){function e(){return t.apply(this,arguments)||this}(0,s.Z)(e,t);var n=e.prototype;return n.frustum=function(t,e,n,i,r,s,a){return(0,d.oy)(t.elements,e,n,r,i,s,a),this},n.orthographic=function(t,e,n,i,r,s){return(0,d.M5)(this.elements,t,e,i,n,r,s),this},n.perspective=function(t,e,n,i){return(0,d.G3)(this.elements,t,e,n,i),this},n.lookAt=function(t,e,n){return void 0===e&&(e=new yt(0,0,0)),void 0===n&&(n=new yt(0,1,0)),(0,d.zB)(this.elements,t.elements,e.elements,n.elements),this},n.toString=function(){return this.constructor.name+"("+this.elements.join(", ")+")"},e}(Mt),Ot=function(){function t(){var t=this;this.visible=!0,this.localMatrix=new Ut,this.worldMatrix=new Ut,this.matrixAutoUpdate=!0,this.position=new yt,this.scale=new yt(1,1,1),this.rotation=new Rt,this.quaternion=new pt,this.up=new yt(0,1,0),this.parent=null,this.children=[],this.worldMatrixNeedsUpdate=!1,this.rotation.onChange((function(){t.quaternion.fromEuler(t.rotation)})),this.quaternion.onChange((function(){t.rotation.fromQuaternion(t.quaternion)}))}var e=t.prototype;return e.add=function(t,e){void 0===e&&(e=!0),this.contains(t)||this.children.push(t),e&&t.setParent(this,!1)},e.remove=function(t,e){void 0===e&&(e=!0),this.contains(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)},e.contains=function(t){return this.children.includes(t)},e.setParent=function(t,e){void 0===e&&(e=!0),this.parent&&t!==this.parent&&this.parent.remove(this,!1),this.parent=t,e&&t&&t.add(this,!1)},e.traverse=function(t){if(!t(this))for(var e=0,n=this.children.length;e<n;e++)this.children[e].traverse(t)},e.lookAt=function(t,e){e?this.localMatrix.lookAt(this.position,t,this.up):this.localMatrix.lookAt(t,this.position,this.up),this.localMatrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)},e.updateMatrixWorld=function(t){var e=t;this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(null===this.parent?this.worldMatrix.copy(this.localMatrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.localMatrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(var n=0,i=this.children.length;n<i;n++){this.children[n].updateMatrixWorld(e)}},e.updateMatrix=function(){this.localMatrix.compose(this.position,this.quaternion,this.scale),this.worldMatrixNeedsUpdate=!0},e.decompose=function(){this.localMatrix.getTranslation(this.position),this.localMatrix.getRotation(this.quaternion),this.localMatrix.getScale(this.scale),this.rotation.fromQuaternion(this.quaternion)},e.clone=function(){return(new t).copy(this,!1)},e.copy=function(t,e){if(this.visible=t.visible,this.position.copy(t.position),this.scale.copy(t.scale),this.rotation.copy(t.rotation),this.quaternion.copy(t.quaternion),this.up.copy(t.up),this.localMatrix.copy(t.localMatrix),this.worldMatrix.copy(t.worldMatrix),this.matrixAutoUpdate=t.matrixAutoUpdate,e)for(var n=0,i=t.children.length;n<i;n++){var r=t.children[n];this.add(r.clone())}return this},t}(),Pt=function(){function t(t){this.renderer=t}return(0,a.Z)(t,[{key:"gl",get:function(){return this.renderer.gl}},{key:"rendererState",get:function(){return this.renderer.state}}]),t}(),Dt=function(t,e){var n,i,r=Object.assign({},{size:1,normalized:!0,stride:0,offset:0,divisor:0,usage:t.gl.STATIC_DRAW},e);if(this.id=G("attribute"),this.needsUpdate=!1,!e.data||Array.isArray(e.data))throw new TypeError("BufferAttribute: data should be a typed array");this.data=r.data,this.size=r.size||1,this.type=r.type||(n=t.gl,(i=r.data)instanceof Float32Array||i instanceof Float64Array?n.FLOAT:i instanceof Uint16Array?n.UNSIGNED_SHORT:i instanceof Uint8Array||i instanceof Uint8ClampedArray?n.UNSIGNED_BYTE:i instanceof Uint32Array?n.UNSIGNED_INT:i instanceof Int8Array?n.BYTE:i instanceof Int16Array?n.SHORT:i instanceof Int32Array?n.INT:void 0),this.normalized=r.normalized||!1,this.stride=r.stride||0,this.offset=r.offset||0,this.divisor=r.divisor||0,this.instanced=r.divisor>0,this.usage=r.usage||t.gl.STATIC_DRAW,r.target&&(this.target=r.target);var s=r.count;void 0!==r.count&&null!==r.count||(s=r.stride?r.data.byteLength/r.stride:r.data.length/r.size),this.count=s},Bt=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},Gt=function(t,e,n){return Bt(t,e,"read from private field"),n?n.call(t):e.get(t)},Wt=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Zt=function(t,e,n,i){return Bt(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},zt=new yt,Vt=function(t){function e(e,n){var i;for(var s in void 0===n&&(n={}),i=t.call(this,e)||this,Wt((0,r.Z)(i),_t,void 0),Wt((0,r.Z)(i),kt,void 0),Wt((0,r.Z)(i),Lt,void 0),Wt((0,r.Z)(i),Ft,void 0),i.drawRange={start:0,count:0},i.instancedCount=0,i.isInstanced=!1,Zt((0,r.Z)(i),kt,new Map),Zt((0,r.Z)(i),Lt,new Map),Zt((0,r.Z)(i),_t,G("geometry")),i.drawMode=i.gl.TRIANGLES,e.bindVertexArray(null),e.state.setActiveGeometry(null),n){var a=n[s];if(a instanceof Dt)"index"===s?i.setIndex(a):i.addAttribute(s,a);else if(a.data){var o=new Dt(i.renderer,a);"index"===s?i.setIndex(o):i.addAttribute(s,o)}}return i}(0,s.Z)(e,t);var n=e.prototype;return n.addAttribute=function(t,e){if(e.target||(e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER),e.needsUpdate=!1,this.attributes.set(t,e),e.buffer||(e.buffer=this.gl.createBuffer(),this.updateAttribute(e)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor),console.warn("Geometry has multiple instanced buffers of different length - instancedCount: "+this.instancedCount+", count: "+e.count+", divisor: "+e.divisor+", attribute: "+t);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))},n.getAttribute=function(t){return this.attributes.get(t)},n.setAttributeData=function(t,e){var n=this.getAttribute(t);n&&(n.data=e,n.needsUpdate=!0)},n.updateAttribute=function(t){!t.buffer&&(t.buffer=this.gl.createBuffer()),this.rendererState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.rendererState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,t.usage),t.needsUpdate=!1},n.removeAttribute=function(t){this.attributes.delete(t)},n.setIndex=function(t){var e;if(t instanceof Dt)t.size=1,this.addAttribute("index",t);else{var n=new Dt(this.renderer,{data:t.length>65535?new Uint32Array(t):new Uint16Array(t),size:1});this.addAttribute("index",n)}this.drawRange.count=null==(e=this.index)?void 0:e.count},n.setVertices=function(t){for(var e=[],n=t.length,i=0;i<n;i++){var r=t[i];e.push(r[0],r[1],r[2])}this.addAttribute("position",new Dt(this.renderer,{data:new Float32Array(e),size:3}))},n.setNormals=function(t){this.addAttribute("normal",new Dt(this.renderer,{data:new Float32Array(t),size:2}))},n.setUVs=function(t){this.addAttribute("uv",new Dt(this.renderer,{data:new Float32Array(t),size:2}))},n.setColors=function(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];i&&(i instanceof yt||i instanceof bt)&&(i=i.toArray()),e.push(i[0],i[1],i[2],i[3]||1)}this.addAttribute("color",new Dt(this.renderer,{data:new Float32Array(e),size:4}))},n.setDrawRange=function(t,e){this.drawRange.start=t,this.drawRange.count=e},n.setInstancedCount=function(t){this.instancedCount=t},n.createVAO=function(t){var e=t.attributeOrder,n=this.renderer.createVertexArray();this.renderer.bindVertexArray(n),Gt(this,Lt).set(e,n),this.bindAttributes(t)},n.bindAttributes=function(t){var e=this;t.attributeLocations.forEach((function(t,n){var i=n.name,r=n.type,s=e.attributes.get(i);if(s){e.gl.bindBuffer(s.target,s.buffer),e.rendererState.boundBuffer=s.buffer;var a=1;r===e.gl.FLOAT_MAT2&&(a=2),r===e.gl.FLOAT_MAT3&&(a=3),r===e.gl.FLOAT_MAT4&&(a=4);for(var o=s.size/a,h=1===a?0:a*a*a,l=1===a?0:a*a,u=0;u<a;u++){var c=t+u;e.gl.vertexAttribPointer(c,o,s.type,s.normalized,s.stride+h,s.offset+l),e.gl.enableVertexAttribArray(c),e.renderer.vertexAttribDivisor(c,s.divisor)}}}));var n=this.attributes.get("index");n&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n.buffer)},n.computeBoundingBox=function(t){var e=this.attributes.get("position"),n=e.data,i=e.offset,r=void 0===i?0:i,s=e.stride,a=e.size;Gt(this,Ft)||Zt(this,Ft,{min:new yt,max:new yt,center:new yt,scale:new yt,radius:Number.POSITIVE_INFINITY}),Gt(this,Ft).min.setScalar(+Number.POSITIVE_INFINITY),Gt(this,Ft).max.setScalar(Number.NEGATIVE_INFINITY);for(var o=t||n,h=s||a,l=r;l<o.length;l+=h){var u=o[l+0],c=o[l+1],f=o[l+2];Gt(this,Ft).min.x=Math.min(u,Gt(this,Ft).min.x),Gt(this,Ft).min.y=Math.min(c,Gt(this,Ft).min.y),Gt(this,Ft).min.z=Math.min(f,Gt(this,Ft).min.z),Gt(this,Ft).max.x=Math.max(u,Gt(this,Ft).max.x),Gt(this,Ft).max.y=Math.max(c,Gt(this,Ft).max.y),Gt(this,Ft).max.z=Math.max(f,Gt(this,Ft).max.z)}return Gt(this,Ft).scale.subVectors(Gt(this,Ft).max,Gt(this,Ft).min),Gt(this,Ft).center.add(Gt(this,Ft).min).add(Gt(this,Ft).max).divideScalar(2),Gt(this,Ft)},n.computeBoundingSphere=function(t){var e=this.attributes.get("position"),n=e.data,i=e.offset,r=void 0===i?0:i,s=e.stride,a=e.size;Gt(this,Ft)||this.computeBoundingBox(t);for(var o=t||n,h=0,l=s||a,u=o.length,c=r;c<u;c+=l)zt.fromArray(o,c),h=Math.max(h,Gt(this,Ft).center.distanceToSquared(zt));Gt(this,Ft).radius=Math.sqrt(h)},n.draw=function(t,e){var n=this;void 0===e&&(e=this.drawMode);var i=this.drawRange,r=i.start,s=i.count,a=this.id+"_"+t.attributeOrder;this.rendererState.activeGeometryId!==a&&(Gt(this,Lt).get(t.attributeOrder)||this.createVAO(t),this.renderer.bindVertexArray(Gt(this,Lt).get(t.attributeOrder)),this.rendererState.activeGeometryId=a);if(t.attributeLocations.forEach((function(t,e){var i=e.name,r=n.getAttribute(i);r&&r.needsUpdate&&n.updateAttribute(r)})),this.isInstanced)if(this.index){var o=this.index.offset+2*r;this.renderer.drawElementsInstanced(e,s,this.index.type,o,this.instancedCount)}else this.renderer.drawArraysInstanced(e,r,s,this.instancedCount);else if(this.index){var h=this.index.offset+2*r;this.gl.drawElements(e,s,this.index.type,h)}else this.gl.drawArrays(e,r,s)},n.copy=function(t){var e=t.attributesData;for(var n in e){var i=e[n];if(i instanceof Dt)"index"===n?this.setIndex(i):this.addAttribute(n,i);else if(i.data){var r=new Dt(this.renderer,i);"index"===n?this.setIndex(r):this.addAttribute(n,r)}}return t.bounds&&(this.bounds={min:(new yt).copy(t.bounds.min),max:(new yt).copy(t.bounds.max),center:(new yt).copy(t.bounds.center),scale:(new yt).copy(t.bounds.scale),radius:t.bounds.radius}),this},n.clone=function(){var t=new e(this.renderer,{}).copy(this);return t.drawMode=this.drawMode,t},n.destroy=function(){var t=this;Gt(this,Lt).forEach((function(e){t.renderer.deleteVertexArray(e)})),Gt(this,Lt).clear(),Gt(this,kt).forEach((function(e){t.gl.deleteBuffer(e.buffer)})),Gt(this,kt).clear()},(0,a.Z)(e,[{key:"id",get:function(){return Gt(this,_t)}},{key:"attributes",get:function(){return Gt(this,kt)}},{key:"attributesData",get:function(){for(var t={},e=Gt(this,kt).entries(),n=0;n<Gt(this,kt).size;n++){var i=e.next().value;t[i[0]]=W(i[1],["id","buffer"])}return t}},{key:"index",get:function(){return this.attributes.get("index")}},{key:"bounds",get:function(){return Gt(this,Ft)},set:function(t){Zt(this,Ft,t)}}]),e}(Pt),jt=Vt;_t=new WeakMap,kt=new WeakMap,Lt=new WeakMap,Ft=new WeakMap;var Ht,Xt,qt,Yt,Kt,Jt,$t=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},Qt=function(t,e,n){return $t(t,e,"read from private field"),n?n.call(t):e.get(t)},te=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},ee=function(t,e,n,i){return $t(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},ne=function(t){function e(e,n){var i;void 0===n&&(n={}),i=t.call(this)||this,te((0,r.Z)(i),Ht,void 0),te((0,r.Z)(i),Xt,void 0),te((0,r.Z)(i),qt,void 0),te((0,r.Z)(i),Yt,void 0),te((0,r.Z)(i),Kt,void 0),te((0,r.Z)(i),Jt,void 0);var s=Object.assign({},{mode:e.gl.TRIANGLES,frustumCulled:!0,renderOrder:0},n);return i.renderer=e,i.gl=i.renderer.gl,i.modelViewMatrix=new Mt,i.normalMatrix=new wt,i.renderOrder=s.renderOrder,i.frustumCulled=s.frustumCulled,i.zDepth=0,ee((0,r.Z)(i),Ht,s.id||G("mesh")),ee((0,r.Z)(i),qt,s.geometry),ee((0,r.Z)(i),Yt,s.program),ee((0,r.Z)(i),Kt,Boolean(s.wireframe)),i.mode=s.mode,ee((0,r.Z)(i),Xt,s.mode),Qt((0,r.Z)(i),Kt)&&(i.mode=i.gl.LINES,i.updateWireframeGeometry(Qt((0,r.Z)(i),Kt))),i}(0,s.Z)(e,t);var n=e.prototype;return n.draw=function(t){var e=this;void 0===t&&(t={});var n=t,i=n.camera,r=n.target,s={};i?(Object.assign(s,{projectionMatrix:i.projectionMatrix,cameraPosition:i.worldPosition,viewMatrix:i.viewMatrix}),this.modelViewMatrix.multiply(i.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix)):this.modelViewMatrix.copy(this.worldMatrix),Object.assign(s,{resolution:new ft(this.gl.canvas.width,this.gl.canvas.height),modelMatrix:this.worldMatrix,modelViewMatrix:this.modelViewMatrix,normalMatrix:this.normalMatrix}),Object.keys(s).forEach((function(t){Object.hasOwn(e.program.uniforms,t)||(e.program.uniforms[t]={value:null}),e.program.uniforms[t].value=s[t]})),r&&r.bind(),this.program.use(),this.geometry.draw(this.program,this.mode),r&&r.unbind()},n.updateWireframeGeometry=function(t,e){var n,i;if(void 0===e&&(e=!1),Qt(this,qt)&&(e||!Qt(this,Jt))){Qt(this,Jt)&&Qt(this,Jt).destroy();var r=null==(n=Qt(this,qt).attributes.get("position"))?void 0:n.data,s=null==(i=Qt(this,qt).index)?void 0:i.data,a=s?s.length:Math.floor(r.length/3),o=[];Qt(this,qt).index?s&&g(r,o,a,s):g(r,o,a);var h=o.length>65536?new Uint32Array(o):new Uint16Array(o);ee(this,Jt,new jt(this.renderer,Object.assign({},Qt(this,qt).attributesData,{index:{data:h}})))}},n.updateGeometry=function(t,e){void 0===e&&(e=!0),e&&Qt(this,qt)&&Qt(this,qt).destroy(),ee(this,qt,t),this.updateWireframeGeometry(Qt(this,Kt),!0)},n.updateProgram=function(t,e){void 0===e&&(e=!0),e&&Qt(this,Yt)&&Qt(this,Yt).destroy(),ee(this,Yt,t)},n.destroy=function(){this.program.destroy(),this.geometry.destroy()},n.clone=function(){return new e(this.gl,{geometry:this.geometry,program:this.program,frustumCulled:this.frustumCulled,mode:this.mode,renderOrder:this.renderOrder}).copy(this)},n.copy=function(e,n){return void 0===n&&(n=!0),t.prototype.copy.call(this,e,n),this.modelViewMatrix.copy(e.modelViewMatrix),this.normalMatrix.copy(e.normalMatrix),this.mode=e.mode,this.renderOrder=e.renderOrder,this.zDepth=e.zDepth,this},(0,a.Z)(e,[{key:"id",get:function(){return Qt(this,Ht)}},{key:"geometry",get:function(){return Qt(this,Kt)?Qt(this,Jt):Qt(this,qt)}},{key:"program",get:function(){return Qt(this,Yt)}},{key:"wireframe",get:function(){return Qt(this,Kt)},set:function(t){this.mode=t?this.gl.LINES:Qt(this,Xt),ee(this,Kt,t),this.updateWireframeGeometry(Qt(this,Kt))}}]),e}(Ot);Ht=new WeakMap,Xt=new WeakMap,qt=new WeakMap,Yt=new WeakMap,Kt=new WeakMap,Jt=new WeakMap;var ie,re=function(t){function e(){return t.apply(this,arguments)||this}(0,s.Z)(e,t);var n=e.prototype;return n.clone=function(){return(new e).copy(this,!1)},n.copy=function(e,n){return t.prototype.copy.call(this,e,n),this.matrixAutoUpdate=e.matrixAutoUpdate,this},e}(Ot),se=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},ae=function(t,e,n){return se(t,e,"read from private field"),n?n.call(t):e.get(t)},oe=function(t,e,n,i){return se(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},he=function(t){function e(e,n){var i;i=t.call(this,e)||this,function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)}((0,r.Z)(i),ie,void 0);var s=e.gl;return oe((0,r.Z)(i),ie,{viewport:{x:0,y:0,width:0,height:0}}),i.apply(n||{frontFace:s.CCW,depthTest:!1,depthWrite:!0,depthMask:!0,depthFunc:s.LESS,blending:1,blendFunc:{src:s.ONE,dst:s.ZERO},blendEquation:{modeRGB:s.FUNC_ADD},premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,framebuffer:null,textureUnits:[],activeTextureUnit:-1,activeGeometryId:-1,currentProgramId:-1,clearAlpha:1,clearColor:new It(0)}),i}(0,s.Z)(e,t);var n=e.prototype;return n.apply=function(t){if(t.blending)this.setBlending(t.blending);else{if(t.blendFunc){var e=t.blendFunc,n=e.src,i=e.dst,r=e.srcAlpha,s=e.dstAlpha;this.setBlendFunc(n,i,r,s),this.enable(this.gl.BLEND)}else this.disable(this.gl.BLEND);if(t.blendEquation){var a=t.blendEquation,o=a.modeRGB,h=a.modeAlpha;this.setBlendEquation(o,h)}}N(t.cullFace)||P(t.cullFace)||this.setCullFace(t.cullFace),N(t.frontFace)||P(t.frontFace)||this.setFrontFace(t.frontFace),t.depthTest?this.enable(this.gl.DEPTH_TEST):this.disable(this.gl.DEPTH_TEST),N(t.depthMask)||P(t.depthMask)||this.setDepthMask(t.depthMask),N(t.depthWrite)||P(t.depthWrite)||this.setDepthMask(t.depthWrite),N(t.depthFunc)||P(t.depthFunc)||this.setDepthFunc(t.depthFunc),N(t.lineWidth)||P(t.lineWidth)||this.setLineWidth(t.lineWidth),oe(this,ie,Object.assign(ae(this,ie),t))},n.enable=function(t){!0!==ae(this,ie)[t]&&(this.gl.enable(t),ae(this,ie)[t]=!0)},n.disable=function(t){!1!==ae(this,ie)[t]&&(this.gl.disable(t),ae(this,ie)[t]=!1)},n.setViewport=function(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=0),ae(this,ie).viewport.width===t&&ae(this,ie).viewport.height===e||(this.gl.viewport(n,i,t,e),ae(this,ie).viewport={width:t,height:e,x:n,y:i})},n.setMask=function(t){ae(this,ie).colorMask!==t&&(this.gl.colorMask(t,t,t,t),ae(this,ie).colorMask=t)},n.setBlending=function(t){ae(this,ie).blending=t,0===t?this.disable(this.gl.BLEND):this.enable(this.gl.BLEND),2===t?ae(this,ie).premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ONE,this.gl.ONE,this.gl.ONE,this.gl.ONE)):(this.setBlendEquation(this.gl.FUNC_ADD),this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE)):3===t?ae(this,ie).premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.ZERO,this.gl.ONE_MINUS_SRC_COLOR,this.gl.ONE_MINUS_SRC_ALPHA)):(this.setBlendEquation(this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_COLOR)):4===t?ae(this,ie).premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.SRC_COLOR,this.gl.ZERO,this.gl.SRC_ALPHA)):(this.setBlendEquation(this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.SRC_COLOR)):1===t?ae(this,ie).premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)):(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)):5===t?console.info("TODO: \u9700\u8981\u5b9e\u73b0"):console.error("State: Invalid blending: ",t)},n.setBlendFunc=function(t,e,n,i){var r,s,a,o;t===(null==(r=ae(this,ie).blendFunc)?void 0:r.src)&&e===(null==(s=ae(this,ie).blendFunc)?void 0:s.dst)&&n===(null==(a=ae(this,ie).blendFunc)?void 0:a.srcAlpha)&&i===(null==(o=ae(this,ie).blendFunc)?void 0:o.dstAlpha)||(ae(this,ie).blendFunc={src:t,dst:e,srcAlpha:n,dstAlpha:i},N(n)||P(n)||N(i)||P(i)?this.gl.blendFunc(t,e):this.gl.blendFuncSeparate(t,e,n,i))},n.setBlendEquation=function(t,e){var n,i;t===(null==(n=ae(this,ie).blendEquation)?void 0:n.modeRGB)&&e===(null==(i=ae(this,ie).blendEquation)?void 0:i.modeAlpha)||(ae(this,ie).blendEquation={modeRGB:t,modeAlpha:e},N(e)||P(e)?this.gl.blendEquation(t):this.gl.blendEquationSeparate(t,e))},n.setClearAlpha=function(t){ae(this,ie).clearAlpha!==t&&(ae(this,ie).clearAlpha=t)},n.setClearColor=function(t,e){ae(this,ie).clearAlpha===e&&ae(this,ie).clearColor===t||(ae(this,ie).clearColor=t,N(e)||P(e)?ae(this,ie).clearAlpha=t.a:ae(this,ie).clearAlpha=e,this.gl.clearColor(t.r,t.g,t.b,ae(this,ie).clearAlpha))},n.setCullFace=function(t){ae(this,ie).cullFace!==t&&(t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),ae(this,ie).cullFace=t,this.gl.cullFace(t))},n.setFrontFace=function(t){ae(this,ie).frontFace!==t&&(ae(this,ie).frontFace=t,this.gl.frontFace(t))},n.setDepthMask=function(t){ae(this,ie).depthMask!==t&&(ae(this,ie).depthMask=t,this.gl.depthMask(t))},n.setDepthFunc=function(t){ae(this,ie).depthFunc!==t&&(ae(this,ie).depthFunc=t,this.gl.depthFunc(t))},n.setDepthTest=function(t){ae(this,ie).depthTest!==t&&(ae(this,ie).depthTest=t,t?this.enable(this.gl.DEPTH_TEST):this.disable(this.gl.DEPTH_TEST))},n.setStencil=function(t,e,n){ae(this,ie).stencil.func===t&&ae(this,ie).stencil.ref===e&&ae(this,ie).stencil.mask===n||(ae(this,ie).stencil={func:t,ref:e,mask:n},this.gl.stencilFunc(t,e,n))},n.setActiveTexture=function(t){ae(this,ie).activeTextureUnit!==t&&(ae(this,ie).activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))},n.setLineWidth=function(t){ae(this,ie).lineWidth!==t&&(ae(this,ie).lineWidth=t,this.gl.lineWidth(t))},n.setPolygonOffset=function(t,e,n){t?(this.enable(this.gl.POLYGON_OFFSET_FILL),ae(this,ie).polygonOffsetFactor===e&&ae(this,ie).polygonOffsetUnits===n||(this.gl.polygonOffset(e,n),ae(this,ie).polygonOffsetFactor=e,ae(this,ie).polygonOffsetUnits=n)):this.disable(this.gl.POLYGON_OFFSET_FILL)},n.bindFramebuffer=function(t){void 0===t&&(t={});var e=t,n=e.target,i=void 0===n?this.gl.FRAMEBUFFER:n,r=e.buffer,s=void 0===r?null:r;ae(this,ie).framebuffer!==s&&(ae(this,ie).framebuffer=s,this.gl.bindFramebuffer(i,s))},n.setActiveGeometry=function(t){ae(this,ie).activeGeometryId=t},n.reset=function(t){var e=this;void 0===t&&(t=!0);var n=Object.keys(ae(this,ie));t?(n.filter((function(t){return["viewport","premultiplyAlpha"].indexOf(t)<0})).forEach((function(t){delete ae(e,ie)[t]})),this.bindFramebuffer({buffer:null}),this.apply({frontFace:this.gl.CCW,depthTest:!1,depthWrite:!0,depthMask:!0,depthFunc:this.gl.LESS,blending:1,blendFunc:{src:this.gl.ONE,dst:this.gl.ZERO},blendEquation:{modeRGB:this.gl.FUNC_ADD},premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,framebuffer:null,textureUnits:[],activeTextureUnit:-1,activeGeometryId:-1,currentProgramId:-1,clearAlpha:1,clearColor:new It(0)})):(n.filter((function(t){return["flipY","framebuffer","textureUnits","activeTextureUnit","activeGeometryId","currentProgramId"].indexOf(t)>-1})).forEach((function(t){delete ae(e,ie)[t]})),this.bindFramebuffer({buffer:null}),ae(this,ie).flipY=!1,ae(this,ie).activeGeometryId=-1,ae(this,ie).activeTextureUnit=-1,ae(this,ie).currentProgramId=-1,ae(this,ie).textureUnits=[],ae(this,ie).boundBuffer=null)},(0,a.Z)(e,[{key:"state",get:function(){return ae(this,ie)}},{key:"viewport",get:function(){return ae(this,ie).viewport}},{key:"textureUnits",get:function(){return ae(this,ie).textureUnits}},{key:"activeTextureUnit",get:function(){return ae(this,ie).activeTextureUnit},set:function(t){ae(this,ie).activeTextureUnit=t}},{key:"currentProgramId",get:function(){return ae(this,ie).currentProgramId},set:function(t){ae(this,ie).currentProgramId=t}},{key:"activeGeometryId",get:function(){return ae(this,ie).activeGeometryId},set:function(t){ae(this,ie).activeGeometryId=t}},{key:"flipY",get:function(){return ae(this,ie).flipY},set:function(t){ae(this,ie).flipY=t}},{key:"unpackAlignment",get:function(){return ae(this,ie).unpackAlignment},set:function(t){ae(this,ie).unpackAlignment=t}},{key:"premultiplyAlpha",get:function(){return ae(this,ie).premultiplyAlpha},set:function(t){ae(this,ie).premultiplyAlpha=t}},{key:"boundBuffer",get:function(){return ae(this,ie).boundBuffer},set:function(t){ae(this,ie).boundBuffer=t}}]),e}(Pt);ie=new WeakMap;var le,ue,ce,fe,de,me,pe,ge,ve,ye,be,xe,we,Ee=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},Me=function(t,e,n){return Ee(t,e,"read from private field"),n?n.call(t):e.get(t)},Te=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Ae=function(t,e,n,i){return Ee(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},Se=["WEBGL_depth_texture","OES_texture_half_float","OES_texture_float","OES_standard_derivatives","OES_element_index_uint","EXT_frag_depth","EXT_blend_minmax","EXT_shader_texture_lod","WEBGL_draw_buffers","WEBGL_color_buffer_float"],Ce=["EXT_color_buffer_float"],Re=["WEBGL_lose_context","OES_texture_half_float_linear","OES_texture_float_linear","EXT_color_buffer_half_float","WEBGL_debug_renderer_info"],_e=function(){function t(t,e){var n,i,r,s=this;void 0===e&&(e={}),Te(this,le,void 0),Te(this,ue,void 0),Te(this,ce,void 0),Te(this,fe,void 0),Te(this,de,void 0),Te(this,me,void 0),Te(this,pe,void 0),Te(this,ge,void 0),Te(this,ve,void 0),Te(this,ye,void 0),Te(this,be,void 0),Te(this,xe,void 0),Te(this,we,void 0);var a=Object.assign({},{autoClear:!0,depth:!0,alpha:!1,stencil:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,requestWebGl2:!0,extensions:[]},e);Ae(this,fe,Boolean(a.autoClear)),Ae(this,de,a.depth),Ae(this,me,a.alpha),Ae(this,pe,a.stencil),Ae(this,ge,a.antialias),Ae(this,ve,a.premultipliedAlpha),Ae(this,ye,a.preserveDrawingBuffer),Ae(this,le,C(t)||R(t)?t:_(t,{alpha:Me(this,me),depth:Me(this,de),stencil:Me(this,pe),antialias:Me(this,ge),powerPreference:a.powerPreference,premultipliedAlpha:Me(this,ve),preserveDrawingBuffer:Me(this,ye)},a.requestWebGl2));var o=null==(n=Me(this,le))?void 0:n.getContextAttributes(),h=null==(i=Me(this,le))?void 0:i.getParameter(Me(this,le).VIEWPORT),l=null==(r=Me(this,le))?void 0:r.getParameter(Me(this,le).UNPACK_FLIP_Y_WEBGL);Ae(this,ue,new he(this)),o&&(Ae(this,de,Boolean(o.depth)),Ae(this,ge,Boolean(o.antialias)),Ae(this,me,Boolean(o.alpha)),Ae(this,pe,Boolean(o.stencil)),Ae(this,ve,Boolean(o.premultipliedAlpha)),Ae(this,ye,Boolean(o.preserveDrawingBuffer))),Me(this,ue).flipY=Boolean(l),Me(this,ue).setViewport(h[2],h[3],h[0],h[1]),Me(this,ue).premultiplyAlpha=Me(this,ve),Ae(this,be,!0),Ae(this,xe,a.dpr||1),this.width=this.gl.canvas.width/Me(this,xe),this.height=this.gl.canvas.height/Me(this,xe),Ae(this,we,!!a.frustumCull),Ae(this,ce,{}),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),a.extensions&&(a.extensions.filter((function(t){return Se.findIndex((function(e){return e===t}))>-1})).forEach((function(t){Me(s,ce)[t]||s.isWebGL2||(Me(s,ce)[t]=s.gl.getExtension(t))})),a.extensions.filter((function(t){return Ce.findIndex((function(e){return e===t}))>-1})).forEach((function(t){!Me(s,ce)[t]&&s.isWebGL2&&(Me(s,ce)[t]=s.gl.getExtension(t))})),a.extensions.filter((function(t){return Re.findIndex((function(e){return e===t}))>-1})).forEach((function(t){Me(s,ce)[t]||(Me(s,ce)[t]=s.gl.getExtension(t))})))}var e=t.prototype;return e.extension=function(t){return Me(this,ce)[t]},e.setSize=function(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*Me(this,xe),this.gl.canvas.height=e*Me(this,xe)},e.setViewport=function(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=0),Me(this,ue).setViewport(t,e,n,i)},e.getExtension=function(t,e,n){var i=this.gl[e];if(e&&i)return i.bind(this.gl);Me(this,ce)[t]||(Me(this,ce)[t]=this.gl.getExtension(t));var r=Me(this,ce)[t];return e?r?r[n].bind(r):null:r},e.getRenderList=function(t){var e=this,n=t.scene,i=t.camera,r=[];return n.traverse((function(t){if(!t.visible)return!0;t.draw&&(Me(e,we)&&t.frustumCulled&&i&&!i.frustumIntersectsMesh(t)||r.push(t))})),r},e.render=function(t){var e=t.scene,n=t.camera,i=t.target,r=void 0===i?null:i,s=t.update,a=void 0===s||s,o=t.clear;null===r?(Me(this,ue).bindFramebuffer({buffer:null}),this.setViewport(this.width*Me(this,xe),this.height*Me(this,xe))):(r.bind(),this.setViewport(r.width,r.height)),(o||Me(this,fe)&&!1!==o)&&(!Me(this,de)||r&&!r.depth||(Me(this,ue).enable(this.gl.DEPTH_TEST),Me(this,ue).setDepthMask(!0)),this.clear(Me(this,be),Me(this,de),Me(this,pe))),a&&e.updateMatrixWorld(),n&&n.updateMatrixWorld();for(var h=this.getRenderList({scene:e,camera:n}),l=0,u=h.length;l<u;l++){h[l].draw({camera:n})}r&&r.unbind()},e.clear=function(t,e,n){void 0===t&&(t=Me(this,be)),void 0===e&&(e=Me(this,de)),void 0===n&&(n=Me(this,pe));var i=0;t&&(i|=this.gl.COLOR_BUFFER_BIT),e&&(i|=this.gl.DEPTH_BUFFER_BIT),n&&(i|=this.gl.STENCIL_BUFFER_BIT),this.gl.clear(i)},e.resetState=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=null),Me(this,ue).reset(t),this.bindVertexArray(e)},(0,a.Z)(t,[{key:"gl",get:function(){return Me(this,le)}},{key:"attributes",get:function(){return{dpr:Me(this,xe),flipY:Me(this,ue).flipY,depth:Me(this,de),color:Me(this,be),antialias:Me(this,ge),alpha:Me(this,me),stencil:Me(this,pe),autoClear:Me(this,fe),frustumCull:Me(this,we),premultipliedAlpha:Me(this,ve),preserveDrawingBuffer:Me(this,ye)}}},{key:"canvas",get:function(){return Me(this,le).canvas}},{key:"isWebGL",get:function(){return C(this.gl)}},{key:"isWebGL2",get:function(){return R(this.gl)}},{key:"extensions",get:function(){return Me(this,ce)}},{key:"size",get:function(){return{width:"clientWidth"in this.canvas?this.canvas.clientWidth:this.canvas.width,height:"clientHeight"in this.canvas?this.canvas.clientHeight:this.canvas.height}}},{key:"state",get:function(){return Me(this,ue)}},{key:"premultipliedAlpha",get:function(){return Me(this,ve)}}]),t}();le=new WeakMap,ue=new WeakMap,ce=new WeakMap,fe=new WeakMap,de=new WeakMap,me=new WeakMap,pe=new WeakMap,ge=new WeakMap,ve=new WeakMap,ye=new WeakMap,be=new WeakMap,xe=new WeakMap,we=new WeakMap;var ke,Le,Fe=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},Ne=function(t,e,n){return Fe(t,e,"read from private field"),n?n.call(t):e.get(t)},Ie=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Ue=function(t,e,n,i){return Fe(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},Oe="Resource subclass must define virtual methods",Pe=function(t){function e(e,n){var i;return void 0===n&&(n={}),i=t.call(this,e)||this,Ie((0,r.Z)(i),ke,void 0),Ie((0,r.Z)(i),Le,void 0),i.id=(null==n?void 0:n.id)||G(i.constructor.name),i.name=null==n?void 0:n.name,i.userData=null==n?void 0:n.userData,Ue((0,r.Z)(i),ke,null==n?void 0:n.handle),i.options=n,void 0===Ne((0,r.Z)(i),ke)&&Ue((0,r.Z)(i),ke,i.createHandle()),i.byteLength=0,i}(0,s.Z)(e,t);var n=e.prototype;return n.swapHandle=function(t){Ue(this,Le,Ne(this,ke)),Ue(this,ke,t)},n.restoreHandle=function(){Ue(this,ke,Ne(this,Le))},n.destroy=function(){this.delete()},n.delete=function(t){var e=(void 0===t?{}:t).deleteChildren,n=void 0!==e&&e,i=this.handle&&this.deleteHandle(this.handle);return this.handle&&this.removeStats(),Ue(this,ke,null),i&&n&&i.filter(Boolean).forEach((function(t){return t.delete()})),this},n.bind=function(t){throw void 0===t&&(t=this.handle),new Error(Oe)},n.unbind=function(){this.bind(null)},n.removeStats=function(){throw new Error(Oe)},n.createHandle=function(){throw new Error(Oe)},n.deleteHandle=function(){throw new Error(Oe)},n.toString=function(){return this.constructor.name+"("+this.id+")"},(0,a.Z)(e,[{key:"handle",get:function(){return Ne(this,ke)}}]),e}(Pt);ke=new WeakMap,Le=new WeakMap;var De,Be=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},Ge=function(t,e,n){return Be(t,e,"read from private field"),n?n.call(t):e.get(t)},We=function(t){function e(e,n){var i,s,a,o,h;return void 0===n&&(n={}),i=t.call(this,e,Object.assign({},n,{format:n.format||e.gl.DEPTH_COMPONENT16}))||this,function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)}((0,r.Z)(i),De,void 0),s=(0,r.Z)(i),a=De,o=i.options.format,Be(s,a,"write to private field"),h?h.call(s,o):a.set(s,o),i.width=i.options.width,i.height=i.options.height,console.assert(i.width>0&&i.height>0,"Renderbuffer object requires valid width and height greater than zero"),i.bind(),e.gl.renderbufferStorage(e.gl.RENDERBUFFER,Ge((0,r.Z)(i),De),i.width,i.height),i}(0,s.Z)(e,t);var n=e.prototype;return n.resize=function(t,e){t===this.width&&e===this.height||(this.width=t,this.height=e,this.bind(),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,Ge(this,De),t,e),this.unbind())},n.bind=function(){this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.handle)},n.unbind=function(){this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)},n.removeStats=function(){},n.destroy=function(){this.unbind(),this.deleteHandle()},n.createHandle=function(){return this.gl.createRenderbuffer()},n.deleteHandle=function(){this.handle&&this.gl.deleteRenderbuffer(this.handle)},e}(Pe);De=new WeakMap;var Ze,ze=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},Ve=function(t,e,n){return ze(t,e,"read from private field"),n?n.call(t):e.get(t)},je=function(t){function e(e,n,i){var s;void 0===n&&(n={}),void 0===i&&(i=!0);var a=e.gl,o={type:a.UNSIGNED_BYTE,format:a.RGBA,internalFormat:n.format||a.RGBA,wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE,generateMipmaps:!0,minFilter:a.LINEAR,magFilter:a.LINEAR,premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,level:0},h=Object.assign({},o,n);return(s=t.call(this,e,h)||this).needsUpdate=!1,s.textureUnit=0,function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)}((0,r.Z)(s),Ze,{}),s.needsUpdate=!1,s.textureUnit=0,s.image=s.options.image,s.width=s.options.width,s.height=s.options.height,Ve((0,r.Z)(s),Ze).version=-1,s.needsUpdate=Boolean(i),s.needsUpdate&&s.update(),s}(0,s.Z)(e,t);var n=e.prototype;return n.setData=function(t,e,n){void 0===e&&(e=this.width),void 0===n&&(n=this.height),this.image=t,this.width=e,this.height=n,this.needsUpdate=!0},n.setOptions=function(t){this.options=Object.assign(this.options,t),this.width=this.options.width,this.height=this.options.height,this.needsUpdate=!0},n.fromSrc=function(t){var e=this;return new Promise((function(n,i){var r=new Image;r.onload=function(){e.setData(r,r.width,r.height),n(e)},r.onerror=function(t){i(t)},r.crossOrigin="*",r.src=t}))},n.update=function(t){void 0===t&&(t=0);var e=!(this.image===Ve(this,Ze).image&&!this.needsUpdate);(e||this.rendererState.textureUnits[t]!==this.id||this.rendererState.activeTextureUnit!==t)&&(this.rendererState.setActiveTexture(t),this.bind(t)),e&&(this.needsUpdate=!1,this.options.wrapS!==Ve(this,Ze).wrapS&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.options.wrapS),Ve(this,Ze).wrapS=this.options.wrapS),this.options.wrapT!==Ve(this,Ze).wrapT&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.options.wrapT),Ve(this,Ze).wrapT=this.options.wrapT),this.options.minFilter!==Ve(this,Ze).minFilter&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.options.minFilter),Ve(this,Ze).minFilter=this.options.minFilter),this.options.magFilter!==Ve(this,Ze).magFilter&&(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.options.magFilter),Ve(this,Ze).magFilter=this.options.magFilter),this.options.flipY!==this.rendererState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.options.flipY),this.rendererState.flipY=this.options.flipY),this.options.premultiplyAlpha!==this.rendererState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),this.rendererState.premultiplyAlpha=this.options.premultiplyAlpha),this.options.unpackAlignment!==this.rendererState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.options.unpackAlignment),this.rendererState.unpackAlignment=this.options.unpackAlignment),this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),ArrayBuffer.isView(this.image)?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,this.image):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.options.internalFormat,this.options.format,this.options.type,this.image),this.options.generateMipmaps&&(this.renderer.isWebGL2||M(this.image.width)&&M(this.image.height)?this.gl.generateMipmap(this.gl.TEXTURE_2D):(this.options.generateMipmaps=!1,this.options.wrapS=this.gl.CLAMP_TO_EDGE,this.options.wrapT=this.options.wrapS,this.options.minFilter=this.gl.LINEAR))):this.width>0?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array(4)),Ve(this,Ze).image=this.image,Ve(this,Ze).version+=1)},n.bind=function(t){void 0===t&&(t=this.textureUnit),this.rendererState.textureUnits[this.rendererState.activeTextureUnit]!==this.id&&(this.textureUnit=t,this.rendererState.textureUnits[this.textureUnit]=this.id,this.gl.bindTexture(this.gl.TEXTURE_2D,this.handle))},n.unbind=function(){this.gl.activeTexture(this.gl.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.gl.TEXTURE_2D,null),delete this.rendererState.textureUnits[this.textureUnit]},n.destroy=function(){this.unbind(),t.prototype.destroy.call(this)},n.removeStats=function(){var t,e,n,i;n={version:-1},ze(t=this,e=Ze,"write to private field"),i?i.call(t,n):e.set(t,n)},n.createHandle=function(){return this.gl.createTexture()},n.deleteHandle=function(){this.handle&&this.gl.deleteTexture(this.handle)},n.toString=function(){return"Texture("+this.id+","+this.width+"x"+this.height+")"},e}(Pe);Ze=new WeakMap;var He,Xe,qe,Ye,Ke,Je=function(t){function e(e,n){var i;return void 0===n&&(n={}),(i=t.call(this,e,Object.assign({},n,{image:n.data,premultiplyAlpha:!0,flipY:!1,unpackAlignment:1}))||this).needsUpdate=!0,i}return(0,s.Z)(e,t),e}(je),$e=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},Qe=function(t,e,n){return $e(t,e,"read from private field"),n?n.call(t):e.get(t)},tn=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},en=function(t,e,n,i){return $e(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},nn=function(t){function e(e,n){var i;void 0===n&&(n={}),i=t.call(this,e,Object.assign({color:1,depth:!0,depthTexture:!1,stencil:!1},n))||this,tn((0,r.Z)(i),He,void 0),tn((0,r.Z)(i),Xe,void 0),tn((0,r.Z)(i),qe,void 0),tn((0,r.Z)(i),Ye,void 0),tn((0,r.Z)(i),Ke,void 0),en((0,r.Z)(i),Xe,new Map),en((0,r.Z)(i),He,new Map),i.depth=Boolean(n.depth),i.drawBuffers=[],i.drawBuffersChanged=!1,i.width=i.options.width,i.height=i.options.height,i.viewport=new bt(0,0,i.width,i.height),i.name=i.options.name;var s=i.options.attachments||[];if(0===s.length){for(var a=0;a<i.options.color;a++){var o=Object.assign({wrapS:i.gl.CLAMP_TO_EDGE,wrapT:i.gl.CLAMP_TO_EDGE,minFilter:i.gl.LINEAR,magFilter:i.gl.LINEAR,type:i.gl.UNSIGNED_BYTE,format:i.gl.RGBA,flipY:!1,generateMipmaps:!1},n),h=void 0;h=o.data?new Je(e,o):new je(e,W(o,["data","name","attachments","depthTexture"])),s.push([i.gl.COLOR_ATTACHMENT0+a,h])}if(n.depthTexture&&(e.isWebGL2||!e.isWebGL2&&e.gl.getExtension("WEBGL_depth_texture"))){var l=new je(e,{width:i.width,height:i.height,minFilter:i.gl.NEAREST,magFilter:i.gl.NEAREST,format:i.gl.DEPTH_COMPONENT,internalFormat:e.isWebGL2?i.gl.DEPTH_COMPONENT16:i.gl.DEPTH_COMPONENT,type:i.gl.UNSIGNED_INT});s.push([i.gl.DEPTH_ATTACHMENT,l])}else{var u=n,c=u.depth,f=u.stencil;if(c&&!f){var d=new We(e,{format:i.gl.DEPTH_COMPONENT16,width:i.width,height:i.height});s.push([i.gl.DEPTH_ATTACHMENT,d])}else if(f&&!c){var m=new We(e,{format:i.gl.STENCIL_INDEX8,width:i.width,height:i.height});s.push([i.gl.STENCIL_ATTACHMENT,m])}else if(c&&f){var p=new We(e,{format:i.gl.DEPTH_STENCIL,width:i.width,height:i.height});s.push([i.gl.DEPTH_STENCIL_ATTACHMENT,p])}}}return i.create(s),i}(0,s.Z)(e,t);var n=e.prototype;return n.create=function(t){var e=this;en(this,qe,[]),en(this,Ye,1),en(this,Ke,0);for(var n,r=(0,i.Z)(t);!(n=r()).done;){var s=n.value,a=s[0],o=s[1];o instanceof We?Qe(this,Xe).set(a,o):o instanceof je&&(Qe(this,He).set(a,o),this.drawBuffers.push(a));var h=a-this.gl.COLOR_ATTACHMENT0;Qe(this,qe)[h]=[0,0,0,0]}if(this.options.color>1)if(this.renderer.isWebGL2)this.gl.drawBuffers(this.drawBuffers);else{var l=this.renderer.extension("WEBGL_draw_buffers");if(!l||!l.drawBuffersWEBGL)throw new Error("Please open the corresponding extension [WEBGL_draw_buffers](https://developer.mozilla.org/en-US/docs/Web/API/WEBGL_draw_buffers#browser_compatibility) and check whether the browser supports it");l.drawBuffersWEBGL(this.drawBuffers)}this.drawBuffersChanged=!0,this.bind(),Qe(this,Xe).forEach((function(t,n){e.gl.framebufferRenderbuffer(e.gl.FRAMEBUFFER,n,e.gl.RENDERBUFFER,t.handle)})),Qe(this,He).forEach((function(t,n){e.gl.framebufferTexture2D(e.gl.FRAMEBUFFER,n,e.gl.TEXTURE_2D,t.handle,0)})),this.unbind();var u=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(u!==this.gl.FRAMEBUFFER_COMPLETE)switch(u){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case this.gl.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}return this.handle},n.clear=function(){this.bind();var t=0;if(this.clearColors[0]){var e=this.clearColors[0];this.gl.clearColor(e[0],e[1],e[2],e[3]),t|=this.gl.COLOR_BUFFER_BIT}U(Qe(this,Ye))&&(this.gl.clearDepth(Qe(this,Ye)),t|=this.gl.DEPTH_BUFFER_BIT),U(Qe(this,Ke))&&(this.gl.clearStencil(Qe(this,Ke)),t|=this.gl.STENCIL_BUFFER_BIT),this.gl.clear(t),this.unbind()},n.getTexture=function(t){return Qe(this,He).get(t)},n.resize=function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,Qe(this,He).forEach((function(n){n.width===t&&n.height===e||(n.width=t,n.height=e,n.needsUpdate=!0,n.update())})),Qe(this,Xe).forEach((function(n){n.resize(t,e)})),this.viewport.set(0,0,t,e))},n.bind=function(t){void 0===t&&(t=this.gl.FRAMEBUFFER),this.gl.bindFramebuffer(t,this.handle)},n.unbind=function(t){void 0===t&&(t=this.gl.FRAMEBUFFER),this.gl.bindFramebuffer(t,null)},n.removeStats=function(){},n.destroy=function(){Qe(this,He).forEach((function(t){t.destroy()})),Qe(this,Xe).forEach((function(t){t.destroy()})),this.deleteHandle()},n.createHandle=function(){return this.gl.createFramebuffer()},n.deleteHandle=function(){this.handle&&this.gl.deleteFramebuffer(this.handle)},n.toString=function(){return"RenderTarget("+this.id+","+this.width+"x"+this.height+")"},(0,a.Z)(e,[{key:"texture",get:function(){return Qe(this,He).values().next().value}},{key:"clearColors",get:function(){return Qe(this,qe)},set:function(t){en(this,qe,t)}},{key:"clearDepth",get:function(){return Qe(this,Ye)},set:function(t){en(this,Ye,t)}},{key:"clearStencil",get:function(){return Qe(this,Ke)},set:function(t){en(this,Ke,t)}}]),e}(Pe);function rn(t,e,n,i,r,s,a,o,h,l,u,c,f,d,m,p){void 0===r&&(r=1),void 0===s&&(s=1),void 0===a&&(a=0),void 0===o&&(o=1),void 0===h&&(h=1),void 0===l&&(l=0),void 0===u&&(u=1),void 0===c&&(c=2),void 0===f&&(f=1),void 0===d&&(d=-1),void 0===m&&(m=0),void 0===p&&(p=0);for(var g=m,v=r/2,y=s/2,b=a/2,x=Math.floor(o),w=Math.floor(h),E=x+1,M=w+1,T=r/x,A=s/w,S=0;S<M;S++)for(var C=S*A-y,R=0;R<E;R++)if(t[3*m+l]=(R*T-v)*f,t[3*m+u]=C*d,t[3*m+c]=b,e[3*m+l]=0,e[3*m+u]=0,e[3*m+c]=a>=0?1:-1,n[2*m]=R/x,n[2*m+1]=1-S/w,m++,S!==w&&R!==x){var _=g+R+E*S,k=g+R+E*(S+1),L=g+R+1+E*(S+1),F=g+R+1+E*S;i[6*p]=_,i[6*p+1]=k,i[6*p+2]=F,i[6*p+3]=k,i[6*p+4]=L,i[6*p+5]=F,p++}}He=new WeakMap,Xe=new WeakMap,qe=new WeakMap,Ye=new WeakMap,Ke=new WeakMap;var sn,an,on=function(t){function e(e,n){var i=void 0===n?{}:n,r=i.width,s=void 0===r?1:r,a=i.height,o=void 0===a?1:a,h=i.widthSegments,l=void 0===h?1:h,u=i.heightSegments,c=void 0===u?1:u,f=i.attributes,d=void 0===f?{}:f,m=Math.floor(l),p=Math.floor(c),g=(m+1)*(p+1),v=m*p*6,y=new Float32Array(3*g),b=new Float32Array(3*g),x=new Float32Array(2*g),w=g>65536?new Uint32Array(v):new Uint16Array(v);return rn(y,b,x,w,s,o,0,l,c),t.call(this,e,Object.assign({},d,{position:{size:3,data:y},normal:{size:3,data:b},uv:{size:2,data:x},index:{data:w}}))||this}return(0,s.Z)(e,t),e}(jt),hn=function(t){function e(e,n){var i=void 0===n?{}:n,r=i.width,s=void 0===r?1:r,a=i.height,o=void 0===a?1:a,h=i.depth,l=void 0===h?1:h,u=i.widthSegments,c=void 0===u?1:u,f=i.heightSegments,d=void 0===f?1:f,m=i.depthSegments,p=void 0===m?1:m,g=i.attributes,v=void 0===g?{}:g,y=Math.floor(c),b=Math.floor(d),x=Math.floor(p),w=y+1,E=b+1,M=x+1,T=w*E*2+w*M*2+E*M*2,A=6*(y*b*2+y*x*2+b*x*2),S=new Float32Array(3*T),C=new Float32Array(3*T),R=new Float32Array(2*T),_=T>65536?new Uint32Array(A):new Uint16Array(A),k=0,L=0,F=M*E,N=w*M,I=w*E,U=x*b,O=y*x,P=y*b;return rn(S,C,R,_,l,o,s,p,d,2,1,0,-1,-1,k,L),rn(S,C,R,_,l,o,-s,p,d,2,1,0,1,-1,k+=F,L+=U),rn(S,C,R,_,s,l,o,p,c,0,2,1,1,1,k+=F,L+=U),rn(S,C,R,_,s,l,-o,p,c,0,2,1,1,-1,k+=N,L+=O),rn(S,C,R,_,s,o,-l,c,d,0,1,2,-1,-1,k+=N,L+=O),rn(S,C,R,_,s,o,l,c,d,0,1,2,1,-1,k+=I,L+=P),t.call(this,e,Object.assign({},v,{position:{size:3,data:S},normal:{size:3,data:C},uv:{size:2,data:R},index:{data:_}}))||this}return(0,s.Z)(e,t),e}(jt),ln=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},un=function(t,e,n){return ln(t,e,"read from private field"),n?n.call(t):e.get(t)},cn=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},fn=function(t,e,n,i){return ln(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},dn=function(t){var e=t.match(/#define[\s*]SHADER_NAME[\s*]([\w-]+)[\s*]/);return e?e[1]:"unnamed"},mn={};function pn(t){void 0===t&&(t="id"),mn[t]=mn[t]||1;var e=mn[t];return mn[t]+=1,"".concat(t,"-").concat(e)}var gn=function(t,e){switch(e){case t.VERTEX_SHADER:return"vertex-shader";case t.FRAGMENT_SHADER:return"fragment-shader";default:return"unknown"}};var vn=function(t){function e(e,n,i,s){var a;void 0===s&&(s={});var o=function(t,e){switch(e){case"fragment":return t.FRAGMENT_SHADER;case"vertex":return t.VERTEX_SHADER;default:return}}(e.gl,i);return a=t.call(this,e,{name:dn(n)||pn(gn(e,o))})||this,cn((0,r.Z)(a),sn,void 0),cn((0,r.Z)(a),an,void 0),console.assert("string"==typeof n,"Shader: GLSL source code must be a JavaScript string"),fn((0,r.Z)(a),an,s),fn((0,r.Z)(a),sn,o),a.sourceCode=a.injectShaderModule(n,s||{}).replace(/\n\n+/gm,"\n\n"),a.createShader(a.sourceCode),a}(0,s.Z)(e,t);var n=e.prototype;return n.injectShaderModule=function(t,e){var n=this;void 0===e&&(e={});return t.replace(/^[\t ]*#glsl_include +<([\w.]+)>/gm,(function(t,i){var r=e[i];if(void 0===r)throw new Error("Cannot resolve #include <".concat(i,">"));return r=r.replace(/#include </g,"#glsl_include <"),n.injectShaderModule(r,e)}))},n.createShader=function(t){void 0===t&&(t=this.source);var e=t.replace(/#include </g,"#glsl_include <");if(e=this.injectShaderModule(e,un(this,an)||{}).replace(/\n\n+/gm,"\n\n"),this.gl.shaderSource(this.handle,e),this.gl.compileShader(this.handle),!this.gl.getShaderParameter(this.handle,this.gl.COMPILE_STATUS)){var n=this.gl.getShaderInfoLog(this.handle)||"";throw this.gl.deleteShader(this.handle),new Error(this.toString()+"\n"+n+"\n"+function(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(e))}},n.getSource=function(){return this.gl.getShaderSource(this.handle)},n.setSource=function(t){var e=dn(t);e&&(this.name=pn(e)),this.createShader(t)},n.removeStats=function(){},n.deleteHandle=function(){this.gl.deleteShader(this.handle)},n.toString=function(){return gn(this.gl,this.shaderType)+":"+this.id},(0,a.Z)(e,[{key:"source",get:function(){return this.sourceCode}},{key:"shaderType",get:function(){return un(this,sn)}}]),e}(Pe);sn=new WeakMap,an=new WeakMap;var yn,bn,xn,wn,En,Mn,Tn,An,Sn,Cn=function(t){function e(e,n,i){return t.call(this,e,n,"vertex",i)||this}return(0,s.Z)(e,t),e.prototype.createHandle=function(){return this.gl.createShader(this.gl.VERTEX_SHADER)},e}(vn),Rn=function(t){function e(e,n,i){return t.call(this,e,n,"fragment",i)||this}return(0,s.Z)(e,t),e.prototype.createHandle=function(){return this.gl.createShader(this.gl.FRAGMENT_SHADER)},e}(vn),_n=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},kn=function(t,e,n){return _n(t,e,"read from private field"),n?n.call(t):e.get(t)},Ln=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Fn=function(t,e,n,i){return _n(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},Nn=function(t,e,n){return _n(t,e,"access private method"),n},In={};function Un(t,e,n,i){var r=(i=i.length?function(t){var e=t.length,n=t[0].length;if(void 0===n)return t;var i=e*n,r=In[i];r||(In[i]=r=new Float32Array(i));for(var s=0;s<e;s++)r.set(t[s],s*n);return r}(i):i).length;switch(e){case WebGLRenderingContext.FLOAT:return r?t.uniform1fv(n,i):t.uniform1f(n,i);case WebGLRenderingContext.FLOAT_VEC2:return t.uniform2fv(n,i);case WebGLRenderingContext.FLOAT_VEC3:return t.uniform3fv(n,i);case WebGLRenderingContext.FLOAT_VEC4:return t.uniform4fv(n,i);case WebGLRenderingContext.BOOL:case WebGLRenderingContext.INT:case WebGLRenderingContext.SAMPLER_2D:case WebGLRenderingContext.SAMPLER_CUBE:return r?t.uniform1iv(n,i):t.uniform1i(n,i);case WebGLRenderingContext.BOOL_VEC2:case WebGLRenderingContext.INT_VEC2:return t.uniform2iv(n,i);case WebGLRenderingContext.BOOL_VEC3:case WebGLRenderingContext.INT_VEC3:return t.uniform3iv(n,i);case WebGLRenderingContext.BOOL_VEC4:case WebGLRenderingContext.INT_VEC4:return t.uniform4iv(n,i);case WebGLRenderingContext.FLOAT_MAT2:return t.uniformMatrix2fv(n,!1,i);case WebGLRenderingContext.FLOAT_MAT3:return t.uniformMatrix3fv(n,!1,i);case WebGLRenderingContext.FLOAT_MAT4:return t.uniformMatrix4fv(n,!1,i)}}var On=function(t){function e(e,n){var i;void 0===n&&(n={}),i=t.call(this,e,n)||this,Ln((0,r.Z)(i),Mn),Ln((0,r.Z)(i),An),Ln((0,r.Z)(i),yn,void 0),Ln((0,r.Z)(i),bn,void 0),Ln((0,r.Z)(i),xn,void 0),Ln((0,r.Z)(i),wn,void 0),Ln((0,r.Z)(i),En,void 0);var s=n,a=s.id,o=s.vertexShader,h=s.fragmentShader,l=s.uniforms,u=void 0===l?{}:l,c=s.transparent,f=void 0!==c&&c,d=s.defines,m=void 0===d?[]:d,g=s.includes,v=void 0===g?{}:g,y=s.cullFace,b=s.frontFace,x=void 0===b?e.gl.CCW:b,w=s.depthTest,E=void 0===w||w,M=s.depthWrite,T=void 0===M||M,A=s.depthFunc,S=void 0===A?e.gl.LESS:A,C=s.blendFunc,R=s.blendEquation;i.id=a||G("program");var _=[].concat((Object.assign({},n,u),[].map((function(t){return"#define ".concat(t)}))),m).map((function(t){return t.startsWith("#define ")?t:"#define ".concat(t)}));if(!o||!h)throw new Error("Program: "+i.id+"\uff1amust provide vertexShader and fragmentShader");if(Fn((0,r.Z)(i),xn,"string"==typeof o?new Cn(e,p(o,_),v):o),Fn((0,r.Z)(i),wn,"string"==typeof h?new Rn(e,p(h,_),v):h),i.gl.attachShader(i.handle,kn((0,r.Z)(i),xn).handle),i.gl.attachShader(i.handle,kn((0,r.Z)(i),wn).handle),i.gl.linkProgram(i.handle),i.gl.validateProgram(i.handle),!i.gl.getProgramParameter(i.handle,i.gl.LINK_STATUS))throw new Error("Program:".concat(i.id,": Error linking ").concat(i.gl.getProgramInfoLog(i.handle)));return i.uniforms=u,Fn((0,r.Z)(i),En,{cullFace:y,frontFace:x,depthTest:E,depthWrite:T,depthFunc:S,blendFunc:C,blendEquation:R}),Fn((0,r.Z)(i),yn,new Map),Fn((0,r.Z)(i),bn,new Map),Nn((0,r.Z)(i),Mn,Tn).call((0,r.Z)(i),u),Nn((0,r.Z)(i),An,Sn).call((0,r.Z)(i)),f&&!(null==C?void 0:C.src)&&(i.renderer.premultipliedAlpha?kn((0,r.Z)(i),En).blendFunc=Object.assign({},C,{src:i.gl.ONE,dst:i.gl.ONE_MINUS_SRC_ALPHA}):kn((0,r.Z)(i),En).blendFunc=Object.assign({},C,{src:i.gl.SRC_ALPHA,dst:i.gl.ONE_MINUS_SRC_ALPHA})),i}(0,s.Z)(e,t);var n=e.prototype;return n.use=function(){var t=this,e=this.rendererState.currentProgramId===this.id,n=-1;e||(this.gl.useProgram(this.handle),this.rendererState.currentProgramId=this.id),kn(this,yn).forEach((function(e,i){var r=i.name,s=t.uniforms[r];if(s)if(s&&(N(s.value)||P(s.value)))console.warn("Program:".concat(t.id,": Uniform ").concat(r," is missing a value parameter"));else{var a=null==s?void 0:s.value;if(a instanceof je)return n+=1,s.value.update(n),Un(t.gl,i.type,e.location,n);if((a instanceof xt||a instanceof ct||a instanceof It)&&(a=s.value.toArray()),a&&a.length>0&&a[0]instanceof je){for(var o=[],h=0;h<s.value.length;h++){var l=a[h];n+=1,l.update(n),o.push(n)}return Un(t.gl,i.type,e.location,o)}Un(t.gl,i.type,e.location,a)}else console.warn("Program:".concat(t.id,": Active uniform ").concat(r," has not been supplied"))})),this.applyState()},n.setStates=function(t,e){void 0===e&&(e=!0),e?(Fn(this,En,Object.assign({},kn(this,En),W(t,["blendFunc","blendEquation"]))),t.blendFunc&&(kn(this,En).blendFunc=Object.assign({},kn(this,En).blendFunc,t.blendFunc)),t.blendEquation&&(kn(this,En).blendEquation=Object.assign({},kn(this,En).blendEquation,t.blendEquation))):Fn(this,En,t)},n.applyState=function(){this.rendererState.apply(kn(this,En))},n.setUniform=function(t,e){this.uniforms[t]&&(this.uniforms[t].value=e)},n.bind=function(){this.gl.useProgram(this.handle)},n.unbind=function(){this.gl.useProgram(null)},n.createHandle=function(){return this.gl.createProgram()},n.deleteHandle=function(){this.gl.deleteProgram(this.handle)},n.destroy=function(){this.unbind(),this.deleteHandle()},(0,a.Z)(e,[{key:"uniformLocations",get:function(){return kn(this,yn)}},{key:"attributeLocations",get:function(){return kn(this,bn)}},{key:"vertexShader",get:function(){return kn(this,xn)}},{key:"fragmentShader",get:function(){return kn(this,wn)}}]),e}(Pe);yn=new WeakMap,bn=new WeakMap,xn=new WeakMap,wn=new WeakMap,En=new WeakMap,Mn=new WeakSet,Tn=function(t){var e;void 0===t&&(t={});for(var n=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_UNIFORMS),i=0;i<n;i++){var r=this.gl.getActiveUniform(this.handle,i);if(!r)break;var s=r.name,a=s.match(/(\w+)/g),o={location:this.gl.getUniformLocation(this.handle,s),type:r.type,name:a[0],isStruct:!1};3===a.length?(o.isStructArray=!0,o.structIndex=Number(a[1]),o.structProperty=a[2]):2===a.length&&isNaN(Number(a[1]))&&(o.isStruct=!0,o.structProperty=a[1]);var h=null==(e=t[s])?void 0:e.value;N(h)||P(h)||(o.value=t[s].value),this.uniforms[s]=o,kn(this,yn).set(r,o)}},An=new WeakSet,Sn=function(){for(var t=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_ATTRIBUTES),e=[],n=0;n<t;n++){var i=this.gl.getActiveAttrib(this.handle,n);if(!i)break;var r=this.gl.getAttribLocation(this.handle,i.name);e[r]=i.name,kn(this,bn).set(i,r)}this.attributeOrder=e.join("")};var Pn,Dn=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},Bn=function(t,e,n){return Dn(t,e,"read from private field"),n?n.call(t):e.get(t)},Gn=function(t){function e(e,n){var i;void 0===n&&(n={});var s=e.gl,a={type:s.UNSIGNED_BYTE,format:s.RGBA,internalFormat:n.format||s.RGBA,wrapS:s.CLAMP_TO_EDGE,wrapT:s.CLAMP_TO_EDGE,wrapR:s.CLAMP_TO_EDGE,generateMipmaps:!0,minFilter:s.LINEAR,magFilter:s.LINEAR,premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,level:0,depth:0},o=Object.assign({},a,n);return(i=t.call(this,e,o,!1)||this).needsUpdate=!1,i.textureUnit=0,function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)}((0,r.Z)(i),Pn,{}),i.needsUpdate=!0,i.depth=i.options.depth,Bn((0,r.Z)(i),Pn).version=-1,i.update(),i}(0,s.Z)(e,t);var n=e.prototype;return n.setData=function(t,e,n,i){void 0===e&&(e=this.width),void 0===n&&(n=this.height),void 0===i&&(i=this.depth),this.image=t,this.width=e,this.height=n,this.depth=i,this.needsUpdate=!0},n.setOptions=function(t){this.options=Object.assign(this.options,t),this.width=this.options.width,this.height=this.options.height,this.depth=this.options.depth,this.needsUpdate=!0},n.update=function(t){void 0===t&&(t=0);var e=!(this.image===Bn(this,Pn).image&&!this.needsUpdate);(e||this.rendererState.textureUnits[t]!==this.id||this.rendererState.activeTextureUnit!==t)&&(this.rendererState.setActiveTexture(t),this.bind(t)),e&&(this.needsUpdate=!1,this.options.wrapS!==Bn(this,Pn).wrapS&&(this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_S,this.options.wrapS),Bn(this,Pn).wrapS=this.options.wrapS),this.options.wrapT!==Bn(this,Pn).wrapT&&(this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_T,this.options.wrapT),Bn(this,Pn).wrapT=this.options.wrapT),this.options.wrapR!==Bn(this,Pn).wrapR&&(this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_WRAP_R,this.options.wrapR),Bn(this,Pn).wrapR=this.options.wrapR),this.options.minFilter!==Bn(this,Pn).minFilter&&(this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MIN_FILTER,this.options.minFilter),Bn(this,Pn).minFilter=this.options.minFilter),this.options.magFilter!==Bn(this,Pn).magFilter&&(this.gl.texParameteri(this.gl.TEXTURE_3D,this.gl.TEXTURE_MAG_FILTER,this.options.magFilter),Bn(this,Pn).magFilter=this.options.magFilter),this.options.flipY!==this.rendererState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.options.flipY),this.rendererState.flipY=this.options.flipY),this.options.premultiplyAlpha!==this.rendererState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),this.rendererState.premultiplyAlpha=this.options.premultiplyAlpha),this.options.unpackAlignment!==this.rendererState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.options.unpackAlignment),this.rendererState.unpackAlignment=this.options.unpackAlignment),this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),ArrayBuffer.isView(this.image),this.gl.texImage3D(this.gl.TEXTURE_3D,0,this.options.internalFormat,this.width,this.height,this.depth,0,this.options.format,this.options.type,this.image),this.options.generateMipmaps&&(this.renderer.isWebGL2||M(this.image.width)&&M(this.image.height)?this.gl.generateMipmap(this.gl.TEXTURE_3D):(this.options.generateMipmaps=!1,this.options.wrapS=this.gl.CLAMP_TO_EDGE,this.options.wrapT=this.options.wrapS,this.options.minFilter=this.gl.LINEAR))):this.width>0?this.gl.texImage3D(this.gl.TEXTURE_3D,0,this.options.internalFormat,this.width,this.height,this.depth,0,this.options.format,this.options.type,null):this.gl.texImage3D(this.gl.TEXTURE_3D,0,this.gl.RGBA,1,1,this.depth,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array(4)),Bn(this,Pn).image=this.image,Bn(this,Pn).version+=1)},n.bind=function(t){void 0===t&&(t=this.textureUnit),this.rendererState.textureUnits[this.rendererState.activeTextureUnit]!==this.id&&(this.textureUnit=t,this.rendererState.textureUnits[this.textureUnit]=this.id,this.gl.bindTexture(this.gl.TEXTURE_3D,this.handle))},n.unbind=function(){this.gl.activeTexture(this.gl.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.gl.TEXTURE_3D,null),delete this.rendererState.textureUnits[this.textureUnit]},n.removeStats=function(){var t,e,n,i;n={version:-1},Dn(t=this,e=Pn,"write to private field"),i?i.call(t,n):e.set(t,n)},n.destroy=function(){this.unbind(),t.prototype.destroy.call(this)},n.toString=function(){return"Texture3D("+this.id+","+this.width+"x"+this.height+")"},(0,a.Z)(e,[{key:"gl",get:function(){return this.renderer.gl}}]),e}(je);Pn=new WeakMap;var Wn,Zn,zn,Vn,jn,Hn,Xn=function(t,e,n){if(!e.has(t))throw TypeError("Cannot "+n)},qn=function(t,e,n){return Xn(t,e,"read from private field"),n?n.call(t):e.get(t)},Yn=function(t,e,n){if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Kn=function(t,e,n,i){return Xn(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n},Jn=new Mt,$n=new yt,Qn=new yt,ti=function(t){function e(e){var n,i=void 0===e?{}:e,s=i.near,a=void 0===s?.1:s,o=i.far,h=void 0===o?100:o,l=i.fov,u=void 0===l?45:l,c=i.aspect,f=void 0===c?1:c,d=i.bounds,m=i.zoom,p=void 0===m?1:m;n=t.call(this)||this,Yn((0,r.Z)(n),Wn,void 0),Yn((0,r.Z)(n),Zn,void 0),Yn((0,r.Z)(n),zn,void 0),Yn((0,r.Z)(n),Vn,void 0),Yn((0,r.Z)(n),jn,void 0),Yn((0,r.Z)(n),Hn,void 0),n.cameraType="perspective",n.projectionMatrix=new Ut,n.viewMatrix=new Mt,n.projectionViewMatrix=new Ut,n.worldPosition=new yt,n.frustum=new Mt,Kn((0,r.Z)(n),Wn,a),Kn((0,r.Z)(n),Zn,h),Kn((0,r.Z)(n),zn,u),Kn((0,r.Z)(n),Vn,f),Kn((0,r.Z)(n),Hn,d),Kn((0,r.Z)(n),jn,p);var g=d||{},v=g.left,y=g.right,b=g.top,x=g.bottom;return n.cameraType=v||y?"orthographic":"perspective","orthographic"===n.cameraType?n.orthographic(v,y,b,x,a,h,p):n.perspective(u,f,a,h),n}(0,s.Z)(e,t);var n=e.prototype;return n.perspective=function(t,e,n,i){void 0===t&&(t=this.fov),void 0===e&&(e=this.aspect),void 0===n&&(n=this.near),void 0===i&&(i=this.far),Kn(this,zn,t),Kn(this,Vn,e),Kn(this,Wn,n),Kn(this,Zn,i),this.projectionMatrix.fromPerspective(t,e,n,i),this.cameraType="perspective"},n.orthographic=function(t,e,n,i,r,s,a){void 0===r&&(r=this.near),void 0===s&&(s=this.far),void 0===a&&(a=1),Kn(this,Hn,{left:t,right:e,top:n,bottom:i}),this.near=r,this.far=s,this.projectionMatrix.orthographic(t/a,e/a,n/a,i/a,r,s),this.cameraType="orthographic",this.projectionMatrix.frustum(this.frustum,qn(this,Hn).left,qn(this,Hn).right,qn(this,Hn).top,qn(this,Hn).bottom,qn(this,Wn),qn(this,Zn))},n.lookAt=function(e){return t.prototype.lookAt.call(this,e,!0),this},n.updateMatrixWorld=function(){return t.prototype.updateMatrixWorld.call(this),this.viewMatrix.invert(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this},n.frustumIntersectsMesh=function(t,e){if(void 0===e&&(e=t.worldMatrix),!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;var n=$n;n.copy(t.geometry.bounds.center),n.applyMatrix4(e);var i=t.geometry.bounds.radius*e.getMaxScaleOnAxis();return this.frustumIntersectsSphere(n,i)},n.frustumIntersectsSphere=function(t,e){for(var n=Qn,i=0;i<6;i++){var r=this.frustum[i];if(n.copy(r).dot(t)+r.constant<-e)return!1}return!0},n.project=function(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this},n.unproject=function(t){return t.applyMatrix4(Jn.invert(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this},n.updateProjectionMatrix=function(){throw new Error("Camera subclass must define virtual methods")},(0,a.Z)(e,[{key:"near",get:function(){return qn(this,Wn)},set:function(t){Kn(this,Wn,t),this.updateProjectionMatrix()}},{key:"far",get:function(){return qn(this,Zn)},set:function(t){Kn(this,Zn,t),this.updateProjectionMatrix()}},{key:"fov",get:function(){return qn(this,zn)},set:function(t){Kn(this,zn,t),this.updateProjectionMatrix()}},{key:"aspect",get:function(){return qn(this,Vn)},set:function(t){Kn(this,Vn,t),this.updateProjectionMatrix()}},{key:"zoom",get:function(){return qn(this,jn)},set:function(t){Kn(this,jn,t),this.updateProjectionMatrix()}},{key:"bounds",get:function(){return qn(this,Hn)},set:function(t){Kn(this,Hn,t),this.updateProjectionMatrix()}}]),e}(Ot);Wn=new WeakMap,Zn=new WeakMap,zn=new WeakMap,Vn=new WeakMap,jn=new WeakMap,Hn=new WeakMap;var ei=function(t){function e(e,n,i,r){return t.call(this,{fov:e,aspect:n,near:i,far:r})||this}return(0,s.Z)(e,t),e.prototype.updateProjectionMatrix=function(){this.projectionMatrix.fromPerspective(this.fov,this.aspect,this.near,this.far)},e}(ti),ni=function(t){function e(e,n,i,r,s,a,o){return void 0===o&&(o=1),t.call(this,{bounds:{left:e,right:n,top:i,bottom:r},near:s,far:a,zoom:o})||this}return(0,s.Z)(e,t),e.prototype.updateProjectionMatrix=function(){var t=this.bounds,e=t.left,n=t.right,i=t.top,r=t.bottom,s=this.zoom;this.projectionMatrix.orthographic(e/s,n/s,i/s,r/s,this.near,this.far)},e}(ti)},4631:(t,e,n)=>{n.d(e,{E:()=>m});var i=n(3752),r=n(9649),s=n(4947);const a=n.p+"assets/images/lut-237c8bbe432f273b62b7cb78e97cf490.png",o=n.p+"assets/images/sunset-diffuse-RGBM-07e34e095bbcd1e6bd98a0848bf366a9.png",h=n.p+"assets/images/sunset-specular-RGBM-8cc1b3dce731aaccef0b0625020e73dc.png";var l=n(7266),u={5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array,"image/jpeg":Uint8Array,"image/png":Uint8Array},c={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},f={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},d={translation:"position",rotation:"quaternion",scale:"scale"};var m=function(){function t(){}return t.load=function(){var t=(0,s.Z)((0,r.Z)().mark((function t(e,n){var i,s;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.split("/").slice(0,-1).join("/")+"/",t.next=3,this.parseDesc(n);case 3:return s=t.sent,t.next=6,this.parse(e,s,i);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),t.parse=function(){var t=(0,s.Z)((0,r.Z)().mark((function t(e,n,i){var s,a,o,h,l,u,c,f,d,m,p,g;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(void 0===n.asset||n.asset.version[0]<2)&&console.warn("Only GLTF >=2.0 supported. Attempting to parse."),t.next=3,this.loadBuffers(n,i);case 3:for(s=t.sent,e.bindVertexArray(null),a=this.parseBufferViews(e,n,s),o=this.parseImages(e,n,i,a),h=this.parseTextures(e,n,o),l=this.parseMaterials(e,n,h),u=this.parseSkins(e,n,a),c=this.parseMeshes(e,n,a,l,u),f=this.parseNodes(e,n,c,u),this.populateSkins(u,f),d=this.parseAnimations(e,n,f,a),m=this.parseScenes(n,f),p=m[n.scene],g=f.length;g>=0;g--)f[g]||f.splice(g,1);return t.abrupt("return",{json:n,buffers:s,bufferViews:a,images:o,textures:h,materials:l,meshes:c,nodes:f,animations:d,scenes:m,scene:p});case 18:case"end":return t.stop()}}),t,this)})));return function(e,n,i){return t.apply(this,arguments)}}(),t.parseDesc=function(){var t=(0,s.Z)((0,r.Z)().mark((function t(e){var n=this;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.match(/\.glb/)){t.next=6;break}return t.next=3,fetch(e).then((function(t){return t.json()}));case 3:case 8:return t.abrupt("return",t.sent);case 6:return t.next=8,fetch(e).then((function(t){return t.arrayBuffer()})).then((function(t){return n.unpackGLB(t)}));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.unpackGLB=function(t){var e=new Uint32Array(t,0,3);if(1179937895!==e[0])throw new Error("Invalid glTF asset.");if(2!==e[1])throw new Error('Unsupported glTF binary version, "'+e[1]+'".');var n=new Uint32Array(t,12,2),i=n[0];if(1313821514!==n[1])throw new Error("Unexpected GLB layout.");var r=(new TextDecoder).decode(t.slice(20,20+i)),s=JSON.parse(r);if(20+i===t.byteLength)return s;var a=new Uint32Array(t,20+i,2);if(5130562!==a[1])throw new Error("Unexpected GLB layout.");var o=20+i+8,h=a[0],l=t.slice(o,o+h);return s.buffers[0].binary=l,s},t.resolveURI=function(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)},t.loadBuffers=function(){var t=(0,s.Z)((0,r.Z)().mark((function t(e,n){var i=this;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.buffers){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,Promise.all(e.buffers.map((function(t){if(t.binary)return t.binary;var e=i.resolveURI(t.uri,n);return fetch(e).then((function(t){return t.arrayBuffer()}))})));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),t.parseBufferViews=function(t,e,n){if(!e.bufferViews)return null;var i=e.bufferViews.map((function(t){return Object.assign({},t)}));return e.meshes&&e.meshes.forEach((function(n){n.primitives.forEach((function(n){var r=n.attributes,s=n.indices;for(var a in r)i[e.accessors[r[a]].bufferView].isAttribute=!0;void 0!==s&&(i[e.accessors[s].bufferView].isAttribute=!0,i[e.accessors[s].bufferView].target=t.gl.ELEMENT_ARRAY_BUFFER)}))})),e.accessors.forEach((function(t){var e=t.bufferView,n=t.componentType;i[e].componentType=n})),e.images&&e.images.forEach((function(t){t.uri;var e=t.bufferView,n=t.mimeType;void 0!==e&&(i[e].mimeType=n)})),i.forEach((function(e,r){var s=e.buffer,a=e.byteOffset,o=void 0===a?0:a,h=e.byteLength,l=(e.byteStride,e.target),c=(void 0===l&&t.gl.ARRAY_BUFFER,e.name,e.extensions,e.extras,e.componentType),f=e.mimeType,d=(e.isAttribute,u[c||f]),m=d.BYTES_PER_ELEMENT,p=new d(n[s],o,h/m);i[r].data=p,i[r].originalBuffer=n[s]})),i},t.parseImages=function(t,e,n,i){var r=this;return e.images?e.images.map((function(t){var e=t.uri,s=t.bufferView,a=t.mimeType,o=t.name,h=new Image;if(h.name=o,e)h.src=r.resolveURI(e,n);else if(void 0!==s){var l=i[s].data,u=new Blob([l],{type:a});h.src=URL.createObjectURL(u)}return h.ready=new Promise((function(t){h.onload=function(){return t()}})),h})):null},t.parseTextures=function(t,e,n){return e.textures?e.textures.map((function(i){var r=i.sampler,s=i.source,a=i.name,o=(i.extensions,i.extras,{flipY:!1,generateMipmaps:!0,wrapS:t.gl.REPEAT,wrapT:t.gl.REPEAT,minFilter:t.gl.NEAREST_MIPMAP_LINEAR}),h=void 0!==r?e.samplers[r]:null;h&&["magFilter","minFilter","wrapS","wrapT"].forEach((function(t){h[t]&&(o[t]=h[t])}));var u=new l.Texture(t,o);u.name=a;var c=n[s];return c.ready.then((function(){u.setData(c,c.width,c.height)})),u})):null},t.parseMaterials=function(t,e,n){return e.materials?e.materials.map((function(t){var e=t.name,i=(t.extensions,t.extras,t.pbrMetallicRoughness),r=void 0===i?{}:i,s=t.normalTexture,a=t.occlusionTexture,o=t.emissiveTexture,h=t.emissiveFactor,l=void 0===h?[0,0,0]:h,u=t.alphaMode,c=void 0===u?"OPAQUE":u,f=t.alphaCutoff,d=void 0===f?.5:f,m=t.doubleSided,p=void 0!==m&&m,g=r,v=g.baseColorFactor,y=void 0===v?[1,1,1,1]:v,b=g.baseColorTexture,x=g.metallicFactor,w=void 0===x?1:x,E=g.roughnessFactor,M=void 0===E?1:E,T=g.metallicRoughnessTexture;return b&&(b.texture=n[b.index]),s&&(s.texture=n[s.index]),T&&(T.texture=n[T.index]),a&&(a.texture=n[a.index]),o&&(o.texture=n[o.index]),{name:e,baseColorFactor:y,baseColorTexture:b,metallicFactor:w,roughnessFactor:M,metallicRoughnessTexture:T,normalTexture:s,occlusionTexture:a,emissiveTexture:o,emissiveFactor:l,alphaMode:c,alphaCutoff:d,doubleSided:p}})):null},t.parseSkins=function(t,e,n){var i=this;return e.skins?e.skins.map((function(t){var r=t.inverseBindMatrices,s=t.skeleton,a=t.joints;return{inverseBindMatrices:i.parseAccessor(r,e,n),skeleton:s,joints:a}})):null},t.parseMeshes=function(t,e,n,i,r){var s=this;return e.meshes?e.meshes.map((function(r,a){var o=r.primitives,h=r.weights,u=r.name,c=(r.extensions,r.extras,0);return e.nodes&&e.nodes.forEach((function(t){var e=t.mesh,n=t.skin;e===a&&(c++,void 0!==n&&n)})),{primitives:o=s.parsePrimitives(t,o,e,n,i,c).map((function(e){var n=e.geometry,i=e.program,r=e.mode,s=new l.Mesh(t,{geometry:n,program:i,mode:r});return s.name=u,s.geometry.isInstanced&&(s.numInstances=c,s.frustumCulled=!1),s})),weights:h,name:u}})):null},t.parsePrimitives=function(t,e,n,i,r,s){var u=this;return e.map((function(e){var c=e.attributes,d=e.indices,m=e.material,p=e.mode,g=void 0===p?4:p,v=(e.targets,e.extensions,e.extras,new l.Geometry(t));for(var y in c)v.addAttribute(f[y],new l.BufferAttribute(t,u.parseAccessor(c[y],n,i)));void 0!==d&&v.setIndex(new l.BufferAttribute(t,u.parseAccessor(d,n,i))),s>1&&v.addAttribute("instanceMatrix",new l.BufferAttribute(t,{divisor:1,size:16,data:new Float32Array(16*s)}));var b={};void 0!==m&&(b=r[m]);var x=function(t,e,n,i){var r=[];e.attributes.get("uv")&&r.push("UV"),e.attributes.get("normal")&&r.push("NORMAL"),e.isInstanced&&r.push("INSTANCED"),n.boneTexture&&r.push("SKINNING"),"MASK"===n.alphaMode&&r.push("ALPHA_MASK"),n.baseColorTexture&&r.push("COLOR_MAP"),n.normalTexture&&r.push("NORMAL_MAP"),n.metallicRoughnessTexture&&r.push("RM_MAP"),n.occlusionTexture&&r.push("OCC_MAP"),n.emissiveTexture&&r.push("EMISSIVE_MAP");var s={wrapS:t.gl.CLAMP_TO_EDGE,wrapT:t.gl.CLAMP_TO_EDGE,format:t.gl.RGBA,internalFormat:t.gl.RGBA,generateMipmaps:!0,minFilter:t.gl.NEAREST_MIPMAP_LINEAR,magFilter:t.gl.LINEAR,premultiplyAlpha:!1,unpackAlignment:4,flipY:!0},u=new l.Texture(t,s),c=new l.Texture(t,s),f=new l.Texture(t,s);return u.fromSrc(a),c.fromSrc(o),f.fromSrc(h),new l.Program(t,{vertexShader:"#version 300 es\n#define GLSLIFY 1\n#define attribute in\n#define varying out\n#define texture2D texture\n\n#defines\n\nattribute vec3 position;\n\n#ifdef UV\nattribute vec2 uv;\n#else\nconst vec2 uv = vec2(0);\n#endif\n\n#ifdef NORMAL\nattribute vec3 normal;\n#else\nconst vec3 normal = vec3(0);\n#endif\n\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;\n#endif\n\n#ifdef SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nuniform mat3 normalMatrix;\n\n#ifdef SKINNING\nuniform sampler2D boneTexture;\nuniform int boneTextureSize;\n#endif\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vMPos;\nvarying vec4 vMVPos;\n\n#ifdef SKINNING\n    mat4 getBoneMatrix(const in float i) {\n        float j = i * 4.0;\n        float x = mod(j, float(boneTextureSize));\n        float y = floor(j / float(boneTextureSize));\n\n        float dx = 1.0 / float(boneTextureSize);\n        float dy = 1.0 / float(boneTextureSize);\n\n        y = dy * (y + 0.5);\n\n        vec4 v1 = texture2D(boneTexture, vec2(dx * (x + 0.5), y));\n        vec4 v2 = texture2D(boneTexture, vec2(dx * (x + 1.5), y));\n        vec4 v3 = texture2D(boneTexture, vec2(dx * (x + 2.5), y));\n        vec4 v4 = texture2D(boneTexture, vec2(dx * (x + 3.5), y));\n\n        return mat4(v1, v2, v3, v4);\n    }\n\n    void skin(inout vec4 pos, inout vec3 nml) {\n        mat4 boneMatX = getBoneMatrix(skinIndex.x);\n        mat4 boneMatY = getBoneMatrix(skinIndex.y);\n        mat4 boneMatZ = getBoneMatrix(skinIndex.z);\n        mat4 boneMatW = getBoneMatrix(skinIndex.w);\n\n        // update normal\n        mat4 skinMatrix = mat4(0.0);\n        skinMatrix += skinWeight.x * boneMatX;\n        skinMatrix += skinWeight.y * boneMatY;\n        skinMatrix += skinWeight.z * boneMatZ;\n        skinMatrix += skinWeight.w * boneMatW;\n        nml = vec4(skinMatrix * vec4(nml, 0.0)).xyz;\n\n        // Update position\n        vec4 transformed = vec4(0.0);\n        transformed += boneMatX * pos * skinWeight.x;\n        transformed += boneMatY * pos * skinWeight.y;\n        transformed += boneMatZ * pos * skinWeight.z;\n        transformed += boneMatW * pos * skinWeight.w;\n        pos = transformed;\n    }\n#endif\n\nvoid main() {\n    vec4 pos = vec4(position, 1);\n    vec3 nml = normal;\n\n    #ifdef SKINNING\n    skin(pos, nml);\n    #endif\n\n    #ifdef INSTANCED\n    pos = instanceMatrix * pos;\n\n    mat3 m = mat3(instanceMatrix);\n    nml /= vec3(dot(m[0], m[0]), dot(m[1], m[1]), dot(m[2], m[2]));\n    nml = m * nml;\n    #endif\n\n    vUv = uv;\n    vNormal = normalize(nml);\n\n    vec4 mPos = modelMatrix * pos;\n    vMPos = mPos.xyz / mPos.w;\n    vMVPos = modelViewMatrix * pos;\n\n    gl_Position = projectionMatrix * vMVPos;\n}\n",fragmentShader:"#version 300 es\nprecision highp float;\n#define GLSLIFY 1\n#define varying in\n#define texture2D texture\n#define gl_FragColor FragColor\nout vec4 FragColor;\n\n#defines\n\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nuniform vec4 uBaseColorFactor;\nuniform sampler2D tBaseColor;\n\nuniform sampler2D tRM;\nuniform float uRoughness;\nuniform float uMetallic;\n\nuniform sampler2D tNormal;\nuniform float uNormalScale;\n\nuniform sampler2D tEmissive;\nuniform vec3 uEmissive;\n\nuniform sampler2D tOcclusion;\n\nuniform sampler2D tLUT;\nuniform sampler2D tEnvDiffuse;\nuniform sampler2D tEnvSpecular;\nuniform float uEnvDiffuse;\nuniform float uEnvSpecular;\n\nuniform vec3 uLightDirection;\nuniform vec3 uLightColor;\n\nuniform float uAlpha;\nuniform float uAlphaCutoff;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vMPos;\nvarying vec4 vMVPos;\n\nconst float PI = 3.14159265359;\nconst float RECIPROCAL_PI = 0.31830988618;\nconst float RECIPROCAL_PI2 = 0.15915494;\nconst float LN2 = 0.6931472;\n\nconst float ENV_LODS = 6.0;\n\nvec4 SRGBtoLinear(vec4 srgb) {\n    vec3 linOut = pow(srgb.xyz, vec3(2.2));\n    return vec4(linOut, srgb.w);\n}\n\nvec4 RGBMToLinear(in vec4 value) {\n    float maxRange = 6.0;\n    return vec4(value.xyz * value.w * maxRange, 1.0);\n}\n\nvec3 linearToSRGB(vec3 color) {\n    return pow(color, vec3(1.0 / 2.2));\n}\n\nvec3 getNormal() {\n    #ifdef NORMAL_MAP\n    vec3 pos_dx = dFdx(vMPos.xyz);\n    vec3 pos_dy = dFdy(vMPos.xyz);\n    vec2 tex_dx = dFdx(vUv);\n    vec2 tex_dy = dFdy(vUv);\n\n    // Tangent, Bitangent\n    vec3 t = normalize(pos_dx * tex_dy.t - pos_dy * tex_dx.t);\n    vec3 b = normalize(-pos_dx * tex_dy.s + pos_dy * tex_dx.s);\n    mat3 tbn = mat3(t, b, normalize(vNormal));\n\n    vec3 n = texture2D(tNormal, vUv).rgb * 2.0 - 1.0;\n    n.xy *= uNormalScale;\n    vec3 normal = normalize(tbn * n);\n\n    // Get world normal from view normal (normalMatrix * normal)\n    // return normalize((vec4(normal, 0.0) * viewMatrix).xyz);\n    return normalize(normal);\n    #else\n    return normalize(vNormal);\n    #endif\n}\n\nvec3 specularReflection(vec3 specularEnvR0, vec3 specularEnvR90, float VdH) {\n    return specularEnvR0 + (specularEnvR90 - specularEnvR0) * pow(clamp(1.0 - VdH, 0.0, 1.0), 5.0);\n}\n\nfloat geometricOcclusion(float NdL, float NdV, float roughness) {\n    float r = roughness;\n\n    float attenuationL = 2.0 * NdL / (NdL + sqrt(r * r + (1.0 - r * r) * (NdL * NdL)));\n    float attenuationV = 2.0 * NdV / (NdV + sqrt(r * r + (1.0 - r * r) * (NdV * NdV)));\n    return attenuationL * attenuationV;\n}\n\nfloat microfacetDistribution(float roughness, float NdH) {\n    float roughnessSq = roughness * roughness;\n    float f = (NdH * roughnessSq - NdH) * NdH + 1.0;\n    return roughnessSq / (PI * f * f);\n}\n\nvec2 cartesianToPolar(vec3 n) {\n    vec2 uv;\n    uv.x = atan(n.z, n.x) * RECIPROCAL_PI2 + 0.5;\n    uv.y = asin(n.y) * RECIPROCAL_PI + 0.5;\n    return uv;\n}\n\nvoid getIBLContribution(inout vec3 diffuse, inout vec3 specular, float NdV, float roughness, vec3 n, vec3 reflection, vec3 diffuseColor, vec3 specularColor) {\n    vec3 brdf = SRGBtoLinear(texture2D(tLUT, vec2(NdV, roughness))).rgb;\n\n    vec3 diffuseLight = RGBMToLinear(texture2D(tEnvDiffuse, cartesianToPolar(n))).rgb;\n    diffuseLight = mix(vec3(1), diffuseLight, uEnvDiffuse);\n\n    // Sample 2 levels and mix between to get smoother degradation\n    float blend = roughness * ENV_LODS;\n    float level0 = floor(blend);\n    float level1 = min(ENV_LODS, level0 + 1.0);\n    blend -= level0;\n\n    // Sample the specular env map atlas depending on the roughness value\n    vec2 uvSpec = cartesianToPolar(reflection);\n    uvSpec.y /= 2.0;\n\n    vec2 uv0 = uvSpec;\n    vec2 uv1 = uvSpec;\n\n    uv0 /= pow(2.0, level0);\n    uv0.y += 1.0 - exp(-LN2 * level0);\n\n    uv1 /= pow(2.0, level1);\n    uv1.y += 1.0 - exp(-LN2 * level1);\n\n    vec3 specular0 = RGBMToLinear(texture2D(tEnvSpecular, uv0)).rgb;\n    vec3 specular1 = RGBMToLinear(texture2D(tEnvSpecular, uv1)).rgb;\n    vec3 specularLight = mix(specular0, specular1, blend);\n\n    diffuse = diffuseLight * diffuseColor;\n\n    // Bit of extra reflection for smooth materials\n    float reflectivity = pow((1.0 - roughness), 2.0) * 0.05;\n    specular = specularLight * (specularColor * brdf.x + brdf.y + reflectivity);\n    specular *= uEnvSpecular;\n}\n\nvoid main() {\n    vec4 baseColor = uBaseColorFactor;\n    #ifdef COLOR_MAP\n    baseColor *= SRGBtoLinear(texture2D(tBaseColor, vUv));\n    #endif\n\n    // Get base alpha\n    float alpha = baseColor.a;\n\n    #ifdef ALPHA_MASK\n    if (alpha < uAlphaCutoff) discard;\n    #endif\n\n    // RM map packed as gb = [nothing, roughness, metallic, nothing]\n    vec4 rmSample = vec4(1);\n    #ifdef RM_MAP\n    rmSample *= texture2D(tRM, vUv);\n    #endif\n    float roughness = clamp(rmSample.g * uRoughness, 0.04, 1.0);\n    float metallic = clamp(rmSample.b * uMetallic, 0.04, 1.0);\n\n    vec3 f0 = vec3(0.04);\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallic);\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n    vec3 specularEnvR0 = specularColor;\n    vec3 specularEnvR90 = vec3(clamp(max(max(specularColor.r, specularColor.g), specularColor.b) * 25.0, 0.0, 1.0));\n\n    vec3 N = getNormal();\n    vec3 V = normalize(cameraPosition - vMPos);\n    vec3 L = normalize(uLightDirection);\n    vec3 H = normalize(L + V);\n    vec3 reflection = normalize(reflect(-V, N));\n\n    float NdL = clamp(dot(N, L), 0.001, 1.0);\n    float NdV = clamp(abs(dot(N, V)), 0.001, 1.0);\n    float NdH = clamp(dot(N, H), 0.0, 1.0);\n    float LdH = clamp(dot(L, H), 0.0, 1.0);\n    float VdH = clamp(dot(V, H), 0.0, 1.0);\n\n    vec3 F = specularReflection(specularEnvR0, specularEnvR90, VdH);\n    float G = geometricOcclusion(NdL, NdV, roughness);\n    float D = microfacetDistribution(roughness, NdH);\n\n    vec3 diffuseContrib = (1.0 - F) * (diffuseColor / PI);\n    vec3 specContrib = F * G * D / (4.0 * NdL * NdV);\n\n    // Shading based off lights\n    vec3 color = NdL * uLightColor * (diffuseContrib + specContrib);\n\n    // Add lights spec to alpha for reflections on transparent surfaces (glass)\n    alpha = max(alpha, max(max(specContrib.r, specContrib.g), specContrib.b));\n\n    // Calculate IBL lighting\n    vec3 diffuseIBL;\n    vec3 specularIBL;\n    getIBLContribution(diffuseIBL, specularIBL, NdV, roughness, N, reflection, diffuseColor, specularColor);\n\n    // Add IBL on top of color\n    color += diffuseIBL + specularIBL;\n\n    // Add IBL spec to alpha for reflections on transparent surfaces (glass)\n    alpha = max(alpha, max(max(specularIBL.r, specularIBL.g), specularIBL.b));\n\n    #ifdef OCC_MAP\n    // TODO: figure out how to apply occlusion\n    // color *= SRGBtoLinear(texture2D(tOcclusion, vUv)).rgb;\n    #endif\n\n    #ifdef EMISSIVE_MAP\n    vec3 emissive = SRGBtoLinear(texture2D(tEmissive, vUv)).rgb * uEmissive;\n    color += emissive;\n    #endif\n\n    // Convert to sRGB to display\n    gl_FragColor.rgb = linearToSRGB(color);\n\n    // Apply uAlpha uniform at the end to overwrite any specular additions on transparent surfaces\n    gl_FragColor.a = alpha * uAlpha;\n}\n",uniforms:{uBaseColorFactor:{value:(new l.Vector4).fromArray(n.baseColorFactor||[1,1,1,1])},tBaseColor:{value:n.baseColorTexture?n.baseColorTexture.texture:null},tRM:{value:n.metallicRoughnessTexture?n.metallicRoughnessTexture.texture:null},uRoughness:{value:void 0!==n.roughnessFactor?n.roughnessFactor:1},uMetallic:{value:void 0!==n.metallicFactor?n.metallicFactor:1},tNormal:{value:n.normalTexture?n.normalTexture.texture:null},uNormalScale:{value:n.normalTexture&&n.normalTexture.scale||1},tOcclusion:{value:n.occlusionTexture?n.occlusionTexture.texture:null},tEmissive:{value:n.emissiveTexture?n.emissiveTexture.texture:null},uEmissive:{value:(new l.Vector3).fromArray(n.emissiveFactor||[0,0,0])},tLUT:{value:u},tEnvDiffuse:{value:c},tEnvSpecular:{value:f},uEnvDiffuse:{value:.5},uEnvSpecular:{value:.5},uLightDirection:{value:new l.Vector3(0,1,1)},uLightColor:{value:new l.Vector3(2.5)},uAlpha:{value:1},uAlphaCutoff:{value:n.alphaCutoff}},defines:r,transparent:"BLEND"===n.alphaMode,cullFace:n.doubleSided?void 0:t.gl.BACK})}(t,v,b);return{geometry:v,program:x,mode:g}}))},t.parseAccessor=function(t,e,n){var i=e.accessors[t],r=i.bufferView,s=i.byteOffset,a=void 0===s?0:s,o=i.componentType,h=i.normalized,l=void 0!==h&&h,f=i.count,d=i.type,m=i.min,p=i.max,g=(i.sparse,n[r]),v=g.data,y=g.originalBuffer,b=g.byteOffset,x=void 0===b?0:b,w=g.byteStride,E=void 0===w?0:w,M=(g.target,c[d]),T=u[o],A=v.BYTES_PER_ELEMENT;return{data:!!E&&E/A!==M?v:new T(y,a+x,f*M),size:M,type:o,normalized:l,stride:E,offset:a,count:f,min:m,max:p}},t.parseNodes=function(t,e,n,i){if(!e.nodes)return null;var r=e.nodes.map((function(t){t.camera,t.children,t.skin;var e=t.matrix,i=t.mesh,r=t.rotation,s=t.scale,a=t.translation,o=(t.weights,t.name),h=(t.extensions,t.extras,new l.Object3D);o&&(h.name=o),e?(h.localMatrix.copy((new l.ProjectionMatrix).fromArray(e)),h.decompose()):(r&&h.quaternion.copy((new l.Quaternion).fromArray(r)),s&&h.scale.copy((new l.Vector3).fromArray(s)),a&&h.position.copy((new l.Vector3).fromArray(a)),h.updateMatrix());var u=!1,c=!0;if(void 0!==i&&n[i].primitives.forEach((function(t){t.geometry.isInstanced&&(u=!0,t.instanceCount?c=!1:t.instanceCount=0,h.matrix.toArray(t.geometry.attributes.instanceMatrix.data,16*t.instanceCount),t.instanceCount++,t.instanceCount===t.numInstances&&(delete t.numInstances,delete t.instanceCount,t.geometry.attributes.instanceMatrix.needsUpdate=!0)),u?c&&t.setParent(h):t.setParent(h)})),u){if(!c)return null;h.localMatrix=(new l.ProjectionMatrix).fromArray(l.Matrix4.identity.toArray()),h.decompose()}return h}));return e.nodes.forEach((function(t,e){var n=t.children;(void 0===n?[]:n).forEach((function(t){r[t]&&r[t].setParent(r[e])}))})),r},t.populateSkins=function(t,e){t&&t.forEach((function(t){t.joints=t.joints.map((function(n,r){var s=e[n];return s.bindInverse=(0,i.Z)(l.Matrix4,t.inverseBindMatrices.data.slice(16*r,16*(r+1))),s})),t.skeleton&&(t.skeleton=e[t.skeleton])}))},t.parseAnimations=function(t,e,n,i){var r=this;return e.animations?e.animations.map((function(t){var s=t.channels,a=t.samplers,o=t.name;s.map((function(t){var s=t.sampler,o=t.target,h=a[s],l=h.input,u=h.interpolation,c=void 0===u?"LINEAR":u,f=h.output,m=o.node,p=o.path;return{node:n[m],transform:d[p],interpolation:c,times:r.parseAccessor(l,e,i).data,values:r.parseAccessor(f,e,i).data}}));return{name:o,animation:{}}})):null},t.parseScenes=function(t,e){return t.scenes?t.scenes.map((function(t){var n=t.nodes,i=void 0===n?[]:n;t.name,t.extensions,t.extras;return i.reduce((function(t,n){return e[n]&&t.push(e[n]),t}),[])})):null},t}()},396:(t,e,n)=>{n.d(e,{Z:()=>U});var i={};n.r(i),n.d(i,{CameraSync:()=>L,MAX_MERCATOR_LATITUDE:()=>T,MeshLayer:()=>F,altitudeFromMercatorZ:()=>w,circumferenceAtLatitude:()=>p,earthCircumference:()=>d,earthRadius:()=>f,fromLngLat:()=>A,getTileCenter:()=>C,halfEarthCircumference:()=>m,latFromMercatorY:()=>x,lngFromMercatorX:()=>b,mercatorScale:()=>E,mercatorXfromLng:()=>g,mercatorYfromLat:()=>v,mercatorZfromAltitude:()=>y,meterInMercatorCoordinateUnits:()=>M,toLngLat:()=>S});var r=n(79),s=n(8220),a=n(6403),o=n(7266),h=n(6426),l=n.n(h),u=n(8788),c=o.utils.clamp,f=6371008.8,d=2*Math.PI*f,m=d/2;function p(t){return d*Math.cos(t*Math.PI/180)}function g(t){return(180+t)/360}function v(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function y(t,e){return t/p(e)}function b(t){return 360*t-180}function x(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}function w(t,e){return t*p(x(e))}function E(t){return 1/Math.cos(t*Math.PI/180)}function M(t){return 1/d*E(x(t))}var T=85.051129;function A(t,e){void 0===e&&(e=0);var n=c(t.lat,-T,T);return{x:g(t.lng),y:v(n),z:y(e,n)}}function S(t){return{lng:b(t.x),lat:x(t.y)}}function C(t,e,n){var i=Math.pow(2,n);return{x:t*d/i-m,y:-(e*d/i-m)}}var R=o.utils.degToRad,_=o.utils.radToDeg,k=o.utils.clamp;(0,o.highPrecision)(!0);var L=function(){function t(t,e,n){this.worldMatrix=new o.Matrix4,this.mercatorMatrix=new o.Matrix4,this.labelPlaneMatrix=new o.Matrix4,this.glCoordMatrix=new o.Matrix4;var i=t.transform,r=i.width,s=i.height,a=_(Math.atan(3/4)),h=1e21;this.map=t,this.scene=n,this.scene.matrixAutoUpdate=!1,this.scene.worldMatrixNeedsUpdate=!0,this.camera="orthographic"===e?new o.OrthographicCamera(-r/2,r/2,s/2,-s/2,.1,h):new o.PerspectiveCamera(a,r/s,.1,h),this.camera.matrixAutoUpdate=!1,this.camera.position.z=600,this.setup()}var e=t.prototype;return e.setup=function(){var t=this.map.transform,e=t.width,n=t.height,i=R(this.map.transform.maxPitch);this.camera.aspect=e/n,this.halfFov=this.map.transform.fov/2,this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*n,this.acuteAngle=Math.PI/2-i,this.update()},e.update=function(){var t=this.map.transform,e=t.width,n=t.height,i=t.worldSize,r=t.elevation,s=t._camera,a=t._horizonShift,h=this.map.getCenter(),l=this.map.getPitch(),u=R(l),c=this.map.getBearing(),f=this.map.transform._fov,d=f/2,m=Math.cos(Math.PI/2-u),p=Math.PI/2+u;this.cameraToCenterDistance=.5/Math.tan(d)*n;var g,v=this.map.transform.project(h),b=(new o.Matrix4).fromRotationZ(Math.PI),x=(new o.Matrix4).fromScale(new o.Vector3(-i,i,i)),w=(new o.Matrix4).fromTranslation(new o.Vector3(-v.x,v.y,0)),E=n/50,M=Math.max(E*m,E),T=f*(.5+this.map.transform.centerOffset.y/n),A=Math.sin(T)*this.cameraToCenterDistance/Math.sin(k(Math.PI-p-T,.01,Math.PI-.01)),S=y(1,h.lat)*i||1;if(function(t,e){t=t.split("."),e=e.split(".");for(var n=Math.max(t.length,e.length);t.length<n;)t.push("0");for(;e.length<n;)e.push("0");for(var i=0;i<n;i++){var r=parseInt(t[i]),s=parseInt(e[i]);if(r>s)return 1;if(r<s)return-1}return 0}(this.map.version,"2.0.0")>=0){var C=r?r.getMinElevationBelowMSL()*S:0,_=(s.position[2]*i-C)/Math.cos(u),L=m*(A=Math.sin(T)*_/Math.sin(o.utils.clamp(Math.PI-p-T,.01,Math.PI-.01)))+_,F=_*(1/a);g=Math.min(1.01*L,F)}else{g=1.01*(m*A+this.cameraToCenterDistance)}this.mercatorMatrix=(new o.Matrix4).scale(new o.Vector3(i,i,i/S));var N=(new o.Matrix4).fromTranslation(new o.Vector3(0,0,this.cameraToCenterDistance));this.labelPlaneMatrix=new o.Matrix4;var I=new o.Matrix4;I.scale(new o.Vector3(1,-1,1)),I.translate(new o.Vector3(-1,-1,0)),I.scale(new o.Vector3(2/e,2/n,1)),this.glCoordMatrix=I,this.camera.aspect=e/n,this.cameraTranslateZ=this.cameraToCenterDistance,this.camera instanceof o.OrthographicCamera?this.camera.projectionMatrix.orthographic(-e/2,e/2,n/2,-n/2,M,g):this.camera.projectionMatrix.perspective(f,e/n,M,g);var U=(new o.Matrix4).premultiply(N).premultiply((new o.Matrix4).fromRotationX(u)).premultiply((new o.Matrix4).fromRotationZ(-R(c)));r&&(U.elements[14]=s.position[2]*i),this.camera.worldMatrix.copy(U),this.camera.updateMatrixWorld(),this.scene&&(this.scene.localMatrix=(new o.ProjectionMatrix).premultiply(b).premultiply(x).premultiply(w))},t}(),F=function(){function t(t,e){this.id=t,this.type="custom",this.renderingMode=(null==e?void 0:e.renderingMode)||"2d",this.updateCamera=this.updateCamera.bind(this)}var e=t.prototype;return e.updateCamera=function(){this.sync.update()},e.projectToWorld=function(t){var e=A({lng:t[0],lat:t[1]},t[2]);return[e.x,e.y,e.z]},e.onAdd=function(t,e){this.map=t,this.renderer=new o.Renderer(e,{autoClear:!1}),this.scene=new o.Scene,this.sync=new L(t,"perspective",this.scene),t.on("move",this.updateCamera),t.on("resize",this.updateCamera),this.updateCamera()},e.addMesh=function(t){t&&!this.meshes.has(null==t?void 0:t.id)&&(this.meshes.set(null==t?void 0:t.id,t),this.scene.add(t))},e.removeMesh=function(t){t&&this.meshes.has(null==t?void 0:t.id)&&(this.scene.remove(t),this.meshes.delete(null==t?void 0:t.id))},e.onRemove=function(){for(var t=this.meshes.entries(),e=0;e<this.meshes.size;e++){var n=t.next().value,i=n[0],r=n[1];this.scene.remove(r),this.meshes.delete(i)}this.map.on("move",this.updateCamera),this.map.on("resize",this.updateCamera)},e.render=function(){this.scene.worldMatrixNeedsUpdate=!0,this.renderer.render({scene:this.scene,camera:this.camera}),this.renderer.resetState()},(0,u.Z)(t,[{key:"camera",get:function(){return this.sync.camera}}]),t}(),N=n(3419),I=n(4631);const U=Object.assign({React:r},r,{useBaseUrl:a.Z,ve:o},o,{observe:N.N7,unobserve:N.p_,GLTFLoader:I.E,leva:s,Leva:s.Leva,LevaPanel:s.LevaPanel,mapboxgl:l(),mbve:i})},3419:(t,e,n)=>{n.d(e,{N7:()=>a,p_:()=>o});var i=n(9146),r=new Map;var s=new i.Z((function(t){t.forEach((function(t){var e,n=t.target;null==(e=r.get(n))||e.forEach((function(t){return t(n)}))}))}));function a(t,e){r.has(t)||(r.set(t,new Set),s.observe(t)),r.get(t).add(e)}function o(t,e){r.has(t)&&(r.get(t).delete(e),r.get(t).size||(s.unobserve(t),r.delete(t)))}},4823:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>b,contentTitle:()=>v,default:()=>E,frontMatter:()=>g,metadata:()=>y,toc:()=>x});var i=n(7583),r=n(2475),s=n(79),a=n(8570),o=n(3731),h=n(9649),l=n(4947),u=n(8220),c=n(4631),f=n(7266);function d(t){var e=(0,s.useRef)(null),i=(0,u.useCreateStore)(),r=function(){var t=(0,l.Z)((0,h.Z)().mark((function t(){var i,r,s,a,o,u,d,m;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.e(238).then(n.bind(n,238));case 2:return i=t.sent,t.next=5,Promise.all([n.e(238),n.e(1839)]).then(n.t.bind(n,1839,23));case 5:return r=t.sent,s=r.GroupGLLayer,t.next=9,Promise.all([n.e(238),n.e(4452)]).then(n.bind(n,4452));case 9:return a=t.sent,o=a.VeLayer,u=new i.Map(e.current,{zoom:17,center:[13.429362937522342,52.518205849377495],pitch:70,baseLayer:new i.TileLayer("base",{urlTemplate:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",subdomains:["a","b","c","d"],attribution:'&copy; <a href="http://osm.org">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/">CARTO</a>'})}),d=new o("mesh",{forceRenderOnMoving:!0,forceRenderOnRotating:!0,requestWebGl2:!0}),m=function(t){var e=d.altitudeToVector3(t[2],t[2]).x;return d.coordinateToVector3([t[0],t[1]],e)},d.prepareToDraw=function(t,e){for(var n=this.getVeRenderer(),i=m([13.429362937522342,52.518205849377495,80.74258167487969]),r=[[13.429362937522342,52.518205849377495],[102.51084435117338,24.846755709924764],[114.46396935117377,39.232415634606724]],s=[],a=0,o=r.length;a<o;a++){var u=m(r[a]);s.push(u.x,u.y,u.z)}console.time("start");for(var p=1/0,g=1/0,v=-1/0,y=-1/0,b=1/0,x=1/0,w=0,E=s.length;w<E;w+=3){var M=s[w],T=s[w+1],A=s[w+2];p=Math.min(p,M),g=Math.min(g,T),b=Math.min(b,A),v=Math.max(v,M),y=Math.max(y,T),x=Math.max(x,A)}x===1/0&&b!==1/0&&(x=b),b===1/0&&x!==1/0&&(b=x);for(var S=[(p+v)/2,(g+y)/2,(b+x)/2],C=0,R=s.length;C<R;C+=3)s[C]=s[C]-S[0],s[C+1]=s[C+1]-S[1],s[C+2]=s[C+2]-S[2];console.timeEnd("start");var _=new f.Geometry(n,{position:{size:3,data:new Float32Array(s)}}),k=new f.Program(n,{vertexShader:"\n      attribute vec2 uv;\n      attribute vec3 position;\n      uniform vec3 cameraPosition;\n      uniform mat4 viewMatrix;\n      uniform mat4 modelMatrix;\n      uniform mat4 modelViewMatrix;\n      uniform mat4 projectionMatrix;\n\n      varying vec2 vUv;\n\n      void main() {\n          vUv = uv;\n\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n          gl_PointSize = 10.0;\n      }\n      ",fragmentShader:"\n      precision highp float;\n\n      uniform float uTime;\n      varying vec2 vUv;\n\n      void main() {\n          gl_FragColor.rgb = 0.5 + 0.3 * sin(vUv.yxx + uTime) + vec3(0.2, 0.0, 0.1);\n          gl_FragColor.a = 1.0;\n      }\n      ",uniforms:{uTime:{value:.5}},depthTest:!0}),L=new f.Mesh(n,{geometry:_,program:k});L.position.set(S[0],S[1],S[2]);var F=function(){var t=(0,l.Z)((0,h.Z)().mark((function t(e){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===e&&(e="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb"),t.next=3,c.E.load(n,e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();F().then((function(t){e.children.forEach((function(t){return t.setParent(null)}));var n=t.scene||t.scenes[0];n[0].position.set(i.x,i.y,i.z),n[0].quaternion.fromAxisAngle(new f.Vector3(0,1,0),180*Math.PI/180);n[0].scale.set(1,1,1),d.addMesh(n),d.addMesh(L),setTimeout((function(){d._getRenderer()&&d._getRenderer().setToRedraw()}),3e3)}))},new s("group",[d],{sceneConfig:{postProcess:{enable:!0,antialias:{enable:!0}}}}).addTo(u),t.abrupt("return",u);case 19:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,s.useEffect)((function(){var t=r();return function(){t.then((function(t){t.remove()}))}}),[]),s.createElement("div",{className:"live-wrap"},s.createElement("div",{className:"leva-wrap"},s.createElement(u.Leva,{collapsed:!0,fill:!0}),s.createElement(u.LevaPanel,{collapsed:!0,store:i,fill:!0})),s.createElement("div",{className:"scene-canvas",ref:e}))}var m=n(4385),p=["components"],g={id:"maptalks-gltf",title:"Draw GLTF with maptalks"},v=void 0,y={unversionedId:"playground/maptalks-gltf",id:"playground/maptalks-gltf",title:"Draw GLTF with maptalks",description:"\u7ed3\u5408 maptalks \u6e32\u67d3 GLTF\uff0c\u8fd9\u4e2a\u53ea\u662f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b9e\u73b0\u65b9\u6848\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u5728\u9879\u76ee\u4e2d\uff0cmaptalks \u6709\u5b8c\u5907\u7684 GLTF \u6e32\u67d3",source:"@site/docs/playground/maptalks-gltf.mdx",sourceDirName:"playground",slug:"/playground/maptalks-gltf",permalink:"/vis-engine/docs/playground/maptalks-gltf",draft:!1,editUrl:"https://github.com/sakitam-gis/vis-engine/edit/master/documents/docs/docs/playground/maptalks-gltf.mdx",tags:[],version:"current",lastUpdatedBy:"sakitam-fdd",lastUpdatedAt:1678692004,formattedLastUpdatedAt:"Mar 13, 2023",frontMatter:{id:"maptalks-gltf",title:"Draw GLTF with maptalks"},sidebar:"docs",previous:{title:"Draw GLTF with mapbox-gl",permalink:"/vis-engine/docs/playground/mapbox-gltf"}},b={},x=[{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:3}],w={toc:x};function E(t){var e=t.components,n=(0,r.Z)(t,p);return(0,a.kt)("wrapper",(0,i.Z)({},w,n,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"\u7ed3\u5408 ",(0,a.kt)("a",{parentName:"p",href:"https://maptalks.com"},"maptalks")," \u6e32\u67d3 GLTF\uff0c\u8fd9\u4e2a\u53ea\u662f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b9e\u73b0\u65b9\u6848\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u5728\u9879\u76ee\u4e2d\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"maptalks")," \u6709\u5b8c\u5907\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"GLTF")," \u6e32\u67d3\n\u65b9\u6848\u548c\u63d2\u4ef6\u3002"),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"maptalks \u56e0\u4e3a\u90e8\u5206\u53d8\u91cf\u5728",(0,a.kt)("inlineCode",{parentName:"p"},"SSG")," \u6a21\u5f0f\u4e0b\u4f1a\u51fa\u95ee\u9898\uff0c\u6240\u4ee5\u6ca1\u6709\u4f7f\u7528 live block\u3002")),(0,a.kt)("h3",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),(0,a.kt)(m.Z,{mdxType:"BrowserOnly"},(function(){return(0,a.kt)(d,{mdxType:"Draw"})})),(0,a.kt)(o.Z,{language:"jsx",mdxType:"CodeBlock"},"import React, { useRef, useEffect } from 'react';\nimport { Leva, useCreateStore, LevaPanel } from 'leva';\n\nimport { GLTFLoader } from './GLTFLoader';\n\nimport { Mesh, Program, Geometry, Vector3 } from '@sakitam-gis/vis-engine';\n\nexport default function DrawModel(props) {\n  const refDom = useRef(null);\n\n  const store = useCreateStore();\n\n  const init = async () => {\n    const maptalks = await import('maptalks');\n    const { GroupGLLayer } = await import('@maptalks/gl');\n    // \u4f7f\u7528 '@sakitam-gis/maptalks-ve' \u5de5\u4f5c\u7a7a\u95f4\u7684\u5305\uff0cdocusaurus build \u4f1a\u5931\u8d25`Module not find`\uff0c\u6682\u65f6\u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\n    const { VeLayer } = await import('../../../adapters/maptalks');\n    const map = new maptalks.Map(refDom.current, {\n      zoom: 17,\n      center: [13.429362937522342, 52.518205849377495],\n      pitch: 70,\n      baseLayer: new maptalks.TileLayer('base', {\n        urlTemplate: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',\n        subdomains: ['a', 'b', 'c', 'd'],\n        attribution:\n          '&copy; <a href=\"http://osm.org\">OpenStreetMap</a> contributors, &copy; <a href=\"https://carto.com/\">CARTO</a>',\n      }),\n    });\n\n    const layer = new VeLayer('mesh', {\n      forceRenderOnMoving: true,\n      forceRenderOnRotating: true,\n      requestWebGl2: true,\n    });\n\n    const projectToWorld = (coord) => {\n      const z = layer.altitudeToVector3(coord[2], coord[2]).x;\n      return layer.coordinateToVector3([coord[0], coord[1]], z);\n    };\n\n    layer.prepareToDraw = function (gl, scene) {\n      const renderer = this.getVeRenderer();\n\n      const coords = [13.429362937522342, 52.518205849377495, 80.74258167487969];\n      const center = projectToWorld(coords);\n\n      const coordinates = [\n        [13.429362937522342, 52.518205849377495],\n        [102.51084435117338, 24.846755709924764],\n        [114.46396935117377, 39.232415634606724],\n      ];\n      const position = [];\n\n      for (let i = 0, len = coordinates.length; i < len; i++) {\n        const p = projectToWorld(coordinates[i]);\n        position.push(p.x, p.y, p.z);\n      }\n\n      console.time('start');\n      let minX = Infinity,\n        minY = Infinity,\n        maxX = -Infinity,\n        maxY = -Infinity,\n        minZ = Infinity,\n        maxZ = Infinity;\n      for (let i = 0, len = position.length; i < len; i += 3) {\n        const x = position[i];\n        const y = position[i + 1];\n        const z = position[i + 2];\n        minX = Math.min(minX, x);\n        minY = Math.min(minY, y);\n        minZ = Math.min(minZ, z);\n        maxX = Math.max(maxX, x);\n        maxY = Math.max(maxY, y);\n        maxZ = Math.max(maxZ, z);\n      }\n\n      if (maxZ === Infinity && minZ !== Infinity) {\n        maxZ = minZ;\n      }\n      if (minZ === Infinity && maxZ !== Infinity) {\n        minZ = maxZ;\n      }\n\n      const c = [(minX + maxX) / 2, (minY + maxY) / 2, (minZ + maxZ) / 2];\n\n      let i = 0;\n      const len = position.length;\n      for (; i < len; i += 3) {\n        position[i] = position[i] - c[0];\n        position[i + 1] = position[i + 1] - c[1];\n        position[i + 2] = position[i + 2] - c[2];\n      }\n\n      console.timeEnd('start');\n\n      const geometry = new Geometry(renderer, {\n        position: {\n          size: 3,\n          data: new Float32Array(position),\n        },\n      });\n\n      const program = new Program(renderer, {\n        vertexShader: `\n      attribute vec2 uv;\n      attribute vec3 position;\n      uniform vec3 cameraPosition;\n      uniform mat4 viewMatrix;\n      uniform mat4 modelMatrix;\n      uniform mat4 modelViewMatrix;\n      uniform mat4 projectionMatrix;\n\n      varying vec2 vUv;\n\n      void main() {\n          vUv = uv;\n\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n          gl_PointSize = 10.0;\n      }\n      `,\n        fragmentShader: `\n      precision highp float;\n\n      uniform float uTime;\n      varying vec2 vUv;\n\n      void main() {\n          gl_FragColor.rgb = 0.5 + 0.3 * sin(vUv.yxx + uTime) + vec3(0.2, 0.0, 0.1);\n          gl_FragColor.a = 1.0;\n      }\n      `,\n        uniforms: {\n          uTime: { value: 0.5 },\n        },\n        depthTest: true,\n      });\n\n      const mesh = new Mesh(renderer, {\n        geometry,\n        program,\n      });\n\n      mesh.position.set(c[0], c[1], c[2]);\n\n      const loadGLTF = async (\n        file = 'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb',\n      ) => await GLTFLoader.load(renderer, file);\n\n      loadGLTF().then((gltfObject) => {\n        scene.children.forEach((child) => child.setParent(null));\n\n        const s = gltfObject.scene || gltfObject.scenes[0];\n\n        s[0].position.set(center.x, center.y, center.z);\n        s[0].quaternion.fromAxisAngle(new Vector3(0, 1, 0), (180 * Math.PI) / 180);\n        const scale = 1;\n        s[0].scale.set(scale, scale, scale);\n        layer.addMesh(s);\n        layer.addMesh(mesh);\n        // \u56e0\u4e3a\u6709\u5f02\u6b65\u8d44\u6e90\uff0c\u4f46\u662f GLTFLoader \u672a\u505a\u5904\u7406\n        setTimeout(() => {\n          // @ts-ignore\n          if (layer._getRenderer()) {\n            // @ts-ignore\n            layer._getRenderer().setToRedraw();\n          }\n        }, 3000);\n      });\n    };\n\n    const sceneConfig = {\n      postProcess: {\n        enable: true,\n        antialias: { enable: true },\n      },\n    };\n    const groupLayer = new GroupGLLayer('group', [layer], { sceneConfig });\n    groupLayer.addTo(map);\n    // console.log(sceneConfig);\n    // layer.addTo(map);\n\n    return map;\n  };\n\n  useEffect(() => {\n    const map = init();\n\n    return () => {\n      map.then(m => {\n        m.remove();\n      });\n    };\n  }, []);\n\n  return (\n    <div className=\"live-wrap\">\n      <div className=\"leva-wrap\">\n        <Leva collapsed fill></Leva>\n        <LevaPanel collapsed store={store} fill></LevaPanel>\n      </div>\n      <div className=\"scene-canvas\" ref={refDom}></div>\n    </div>\n  );\n}\n"))}E.isMDXComponent=!0}}]);