"use strict";(self.webpackChunkvis_engine_docs=self.webpackChunkvis_engine_docs||[]).push([[4452],{4452:(e,t,r)=>{r.r(t),r.d(t,{VeLayer:()=>R,VeRenderer:()=>C});var n,i,a,s,o,c=r(4036),h=r(8187),d=r(238),l=r(7266),u=function(e,t,r){if(!t.has(e))throw TypeError("Cannot "+r)},v=function(e,t,r){return u(e,t,"read from private field"),r?r.call(e):t.get(e)},f=function(e,t,r){if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},g=function(e,t,r,n){return u(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r},p=function(e,t,r){return u(e,t,"access private method"),r};function y(e){return e.getGLRes?e.getGLRes():e.getGLZoom()}function w(e,t,r,n){return e.coordToPointAtRes?e.coordToPointAtRes(t,r,n):e.coordinateToPoint(t,r,n)}(0,l.highPrecision)(!0);var m=new d.Coordinate(0,0),x=new d.Point(0,0),C=function(e){function t(){var t;return t=e.apply(this,arguments)||this,f((0,c.Z)(t),i),f((0,c.Z)(t),s),f((0,c.Z)(t),n,void 0),t}(0,h.Z)(t,e);var r=t.prototype;return r.getPrepareParams=function(){return[this.scene,this.camera]},r.getDrawParams=function(){return[this.scene,this.camera]},r._drawLayer=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.prototype._drawLayer.apply(this,r)},r.hitDetect=function(){return!1},r.createCanvas=function(){e.prototype.createCanvas.call(this),this.createContext()},r.createContext=function(){var e;if(this.canvas.gl&&this.canvas.gl.wrap)this.gl=this.canvas.gl.wrap();else{var t=this.layer,r=t.options.glOptions||{alpha:!0,depth:!0,antialias:!0,stencil:!0};r.preserveDrawingBuffer=!0,this.gl=this.gl||l.utils.getContext(this.canvas,r,null==(e=t.options)?void 0:e.requestWebGl2)}p(this,i,a).call(this),this.layer.onCanvasCreate(this.context,this.scene,this.camera)},r.onCanvasCreate=function(){e.prototype.onCanvasCreate.call(this)},r.resizeCanvas=function(e){if(this.canvas){var t,r=this.getMap();t=e||r.getSize();var n=r.getDevicePixelRatio?r.getDevicePixelRatio():d.Browser.retina?2:1,i=this.canvas,a=d.Util.calCanvasSize(t,n),s=a.width,o=a.height,c=a.cssWidth,h=a.cssHeight;if(!this.layer._canvas||i.style.width===c&&i.style.height===h||(i.style.width=c,i.style.height=h),i.width===s&&i.height===o)return this;i.width=s,i.height=o,this.context.setSize(i.width,i.height)}},r.clearCanvas=function(){this.canvas&&this.context.clear()},r.prepareCanvas=function(){return this.canvas?this.clearCanvas():this.createCanvas(),this.layer.fire("renderstart",{context:this.context}),null},r.renderScene=function(e){if(this.scene.worldMatrixNeedsUpdate=!0,p(this,s,o).call(this),e&&e.renderTarget){var t=e.renderTarget.fbo,r=t.width,i=t.height;v(this,n)?v(this,n).resize(r,i):(g(this,n,new l.RenderTarget(this.context,{width:r,height:i,depth:!1})),this.context.render({camera:this.camera,scene:this.scene,target:v(this,n)})),v(this,n).swapHandle(e.renderTarget.getFramebuffer(e.renderTarget.fbo)),this.context.render({camera:this.camera,scene:this.scene,target:v(this,n)}),v(this,n).restoreHandle()}else this.context.render({camera:this.camera,scene:this.scene});this.completeRender()},r.remove=function(){delete this._drawContext,v(this,n)&&(v(this,n).destroy(),g(this,n,void 0)),e.prototype.remove.call(this)},t}(d.renderer.CanvasLayerRenderer);n=new WeakMap,i=new WeakSet,a=function(){this.matrix4=new l.Matrix4;var e=new l.Renderer(this.gl,{autoClear:!1});e.setSize(this.canvas.width,this.canvas.height),this.context=e,this.context.state.setClearColor({r:0,g:0,b:0,a:0}),this.scene=new l.Scene;var t=this.layer.getMap(),r=t.getFov()*Math.PI/180;this.camera=new l.PerspectiveCamera(r,t.width/t.height,t.cameraNear,t.cameraFar),this.camera.matrixAutoUpdate=!1,p(this,s,o).call(this)},s=new WeakSet,o=function(){var e=this.getMap(),t=this.camera;t.localMatrix.fromArray(e.cameraWorldMatrix),t.projectionMatrix.fromArray(e.projMatrix),t.worldMatrixNeedsUpdate=!0,t.updateMatrixWorld()};var R=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this)._needsUpdate=!0,n.type="VeLayer",n}(0,h.Z)(t,e);var r=t.prototype;return r.prepareToDraw=function(){throw Error("must define virtual methods")},r.isRendering=function(){var e=this.getMap();return!!e&&(e.isInteracting()||e.isAnimating())},r.draw=function(e,t,r,n,i,a){this.renderScene(a,this)},r.drawOnInteracting=function(e,t,r,n,i,a,s){this.renderScene(s,this)},r.coordinateToVector3=function(e,t,r){void 0===t&&(t=0);var n=this.getMap();if(!n)return null;var i=Array.isArray(e);i?(m.x=e[0],m.y=e[1]):e instanceof d.Coordinate||(e=new d.Coordinate(e));var a=y(n),s=w(n,i?m:e,a,x);return r&&(r.x=s.x,r.y=s.y,r.z=t),new l.Vector3(s.x,s.y,t)},r.coordinatiesToGLFloatArray=function(e,t){var r=this.getMap();if(!r)return null;for(var n=y(r),i=e.length,a=new Float32Array(2*i),s=new Float32Array(3*i),o=0;o<i;o++){var c=e[o],h=Array.isArray(c);h?(m.x=c[0],m.y=c[1]):c instanceof d.Coordinate||(c=new d.Coordinate(c));var l=w(r,h?m:c,n,x);l.x-=t.x,l.y-=t.y;var u=2*o;a[u]=l.x,a[u+1]=l.y;var v=3*o;s[v]=l.x,s[v+1]=l.y,s[v+2]=0}return{positions:s,positons2d:a}},r.coordinatiesToGLArray=function(e,t){var r=this.getMap();if(!r)return null;for(var n=y(r),i=e.length,a=new Array(i),s=0;s<i;s++){var o=e[s],c=Array.isArray(o);c?(m.x=o[0],m.y=o[1]):o instanceof d.Coordinate||(o=new d.Coordinate(o));var h=w(r,c?m:o,n,x);h.x-=t.x,h.y-=t.y,a[s]=[h.x,h.y]}return a},r.distanceToVector3=function(e,t,r){if(0===e&&0===t||!d.Util.isNumber(e)||!d.Util.isNumber(t))return new l.Vector3(0,0,0);var n=this.getMap(),i=y(n),a=r||n.getCenter();a instanceof d.Coordinate||(a=new d.Coordinate(a));var s=n.locate(a,e,t),o=w(n,a,i),c=w(n,s,i),h=Math.abs(c.x-o.x)*d.Util.sign(e),u=Math.abs(c.y-o.y)*d.Util.sign(t);return new l.Vector3(h,u,0)},r.altitudeToVector3=function(e,t,r,n){if(0===e||!d.Util.isNumber(e))return new l.Vector3(0,0,0);var i=this.getMap();if(i.altitudeToPoint){var a=y(i),s=i.altitudeToPoint(e,a);return e<0&&s>0&&(s=-s),n?(n.x=s,n.y=s,n.z=0,n):new l.Vector3(s,s,0)}return this.distanceToVector3(e,e,r)},r.getObjects=function(){var e=this.getScene();if(!e)return[];for(var t=[],r=0,n=e.children.length;r<n;r++){var i=e.children[r];i&&t.push(i)}return t},r.clear=function(){return this.clearObject()},r.clearObject=function(){var e=this.getScene();if(!e)return this;for(var t=e.children.length-1;t>=0;t--){var r=e.children[t];r&&e.remove(r)}return this},r.getCamera=function(){var e=this._getRenderer();return e?e.camera:null},r.getScene=function(){var e=this._getRenderer();return e?e.scene:null},r.renderScene=function(e,t){var r=this._getRenderer();return r&&(r.clearCanvas(),r.renderScene(e),t||r.setToRedraw()),this},r.getVeRenderer=function(){var e=this._getRenderer();return e?e.context:null},r.addMesh=function(e,t){if(void 0===t&&(t=!0),!e)return this;Array.isArray(e)||(e=[e]);var r=this.getScene();if(e.forEach((function(e){null==r||r.add(e)})),t){var n=this._getRenderer();n&&n.setToRedraw()}return this},r.removeMesh=function(e,t){if(void 0===t&&(t=!0),!e)return this;Array.isArray(e)||(e=[e]);var r=this.getScene();if(e.forEach((function(e){null==r||r.remove(e)})),t){var n=this._getRenderer();n&&n.setToRedraw()}return this},r.onAdd=function(){return e.prototype.onAdd.call(this),this.map||this.getMap()?(this._needsUpdate=!0,this):this},r.onRemove=function(){return e.prototype.onRemove.call(this),this.map||this.getMap()?(this.clear(),this):this},t}(d.CanvasLayer);R.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:void 0,forceRenderOnZooming:!0}),R.registerRenderer("gl",C)}}]);